+++
title = "ğŸ“Clojure Collections and Sequences"
lastmod = 2022-10-12T11:40:12+09:00
tags = ["WIKI"]
draft = false
+++

-   up: [ğŸ“‚Clojure Core]({{< relref "20220112142936.md" >}})
-   refs:
    -   [ğŸ“Clojure Functional Programming]({{< relref "20220116094551.md" >}})


## Overview {#3b8782}

Clojureã®ä¸–ç•Œã§ã¯å…¨ã¦ã®é›†åˆå‹ãƒ‡ãƒ¼ã‚¿ã¯ã‚·ãƒ¼ã‚±ãƒ³ã‚¹.

Clojureã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚„é«˜éšé–¢æ•°ã‚’å·§ã¿ã«æ‰±ã†ã“ã¨ãŒã§ãã‚‹ã¨ãƒ¢ãƒ†ã‚‹ã¨ã‹. ã“ã†ã„ã†ã®ã¯çŸ¥ã£ã¦ã„ã‚‹ã‹çŸ¥ã‚‰ãªã„ã‹ãªã®ã§ã‚¤ãƒ‡ã‚£ã‚ªãƒ ã‚’è¦šãˆã¦ãƒ¢ãƒ†ã‚ˆã†([ğŸ“Clojure Idioms]({{< relref "20220302101805.md" >}})).


## Clojure: Collections {#310e6c}

Clojureã®Collectionã¯immutableã§persistent.

---

-   refs
    -   [ğŸ“immutable]({{< relref "20220305075933.md#fbc351d5-b1d2-4dcd-95cd-9d5021f88565" >}})
    -   [ğŸ“persistent]({{< relref "20220305075933.md#7e585ab7-a40f-4a1e-aeaa-812eb632f2ff" >}})
    -   [ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«æ™‚ä»£ã®è¨€èªã¨ã—ã¦ã®Clojure - Qiita](https://qiita.com/kawasima/items/c695e2f4ee079a6debf5)


### æœ€ã‚‚æ ¸ã¨ãªã‚‹3ã¤ã®é–¢æ•° {#207ea7}

-   first
-   rest
-   cons


### Clojure Collectionæ“ä½œ {#c18572}

ã‚ˆãä½¿ã†ã‚‚ã®ã‚’åˆ—æŒ™.

-   conj: ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®çµåˆ. ä»–ã®è¨€èªã§ã¯push, concat, appendã¨ã‹.


## Clojure Sequences(clojure.core.sequence) {#648d4030-475a-4dca-a0d9-5a6defcae18a}

refs: [Clojure - Clojureã‚’å­¦ã¼ã† - ã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³](https://japan-clojurians.github.io/clojure-site-ja/guides/learn/sequential_colls)

ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å‹ ã«ã¯4ç¨®é¡ã®é‡è¦ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ãŒã‚ã‚‹.

-   list: ()
-   vector: []
-   map: {}
-   set: #{}

[ğŸ”–List]({{< relref "20220310124045.md#aaef8de1-331f-431a-a5f4-39063b81f73d" >}})


### Clojure: into {#aec02797-3c3f-407e-95df-67073fa71b54}

into ã¯ç¬¬ä¸€å¼•æ•°ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«, ç¬¬äºŒå¼•æ•°ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®è¦ç´ å…¨ã¦ã‚’, å…ƒã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ã¨ã£ã¦è‡ªç„¶ãªå½¢ã§è¿½åŠ  (conj) ã—ã¦ãã‚Œã‚‹é–¢æ•°.

(into %1 %2) ã¯,

(reduce conj %1 %2) ã¤ã¾ã‚Š %1 ã« %2 ã®è¦ç´ ã‚’é †ã« conj ã—ãŸã‚‚ã®ã¨åŒç­‰.

(conj (conj %1 %2ã®æœ€åˆã®è¦ç´ ) %2ã®äºŒç•ªç›®ã®è¦ç´ )ã¨åŒç­‰.


### ğŸ’¡Clojure contains?ã®ç½  {#15121a4d-3f9f-4294-a7ec-b025373adfc3}

ã“ã®å€¤ãŒãƒªã‚¹ãƒˆã«å«ã¾ã‚Œã‚‹ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹ã¨ã, Clojureã®contains?ãŒã¤ã‹ãˆãªã„ã®ã§ç´›ã‚‰ã‚ã—ã„ã¨ã„ã†è©±é¡Œ.

[contains? - clojure.core](https://clojuredocs.org/clojure.core/contains_q)

ã“ã‚Œã¯Mapã«keyãŒå«ã¾ã‚Œã‚‹ã‹ã‚’åˆ¤å®šã™ã‚‹é–¢æ•°ã§ãƒªã‚¹ãƒˆã«å¯¾ã—ã¦ã¤ã‹ã£ã¦ã‚‚æœŸå¾…é€šã‚Šã®çµæœã«ãªã‚‰ãªã„...

ã“ã®å ´åˆ, someã ã£ãŸã‚ŠJavaã®.contains methodã‚’ã¤ã‹ã†.

```clojure
(defn in?
  "true if coll contains elm"
  [coll elm]
  (some #(= elm %) coll))

(.contains [100 101 102] 101)
```

ref. [data structures - Test whether a list contains a specific value in Clojure - Stack Overflow](https://stackoverflow.com/questions/3249334/test-whether-a-list-contains-a-specific-value-in-clojure)

---

æ–‡å­—åˆ—ã¯ã“ã£ã¡. [æ–‡å­—åˆ—ã‚’å«ã‚€ã‹ï¼Ÿ: clojure.core/includes?]({{< relref "20220428163355.md#ecab6dfc-90f5-4deb-b675-5a14420c8803" >}})


### ğŸ’¡Clojureã§Sliding window Algorithm {#55f4d3e9-7dad-4832-a284-a3f204207903}

[Sliding Window Algorithm]({{< relref "20220830152735.md#b07ffa38-60b1-4ae2-b130-d924e59f8ccb" >}})ã‚’Clojureã§implã™ã‚‹æ–¹æ³•.

-   [clojure - Sliding window over seq - Stack Overflow](https://stackoverflow.com/questions/1427894/sliding-window-over-seq)


### ğŸ’¡Clojureã§FIFOã‚­ãƒ¥ãƒ¼ã‚’æ‰±ã† {#c9d8db5f-1b0c-4cd7-ba8e-cdb54b9170df}

Clojure.lang.PersistentQueueã¨ã„ã†éš ã—æ©Ÿèƒ½ã‹ã‚ã‚‹ã‚‰ã—ã„.

Clojure.lang.PersistentQueue/EMPTYãŒç©ºã‚­ãƒ¥ãƒ¼ã‚’ç¤ºã™.

conj/pop/peekã§æ“ä½œ. é–²è¦§ã¯seqã§å¤‰æ›ã™ã‚‹.

---

æœ‰é™ã®ã‚­ãƒ¥ãƒ¼ãªã‚‰ä»¥ä¸‹ã®å®Ÿè£…ã§ã„ã‘ã‚‹.

```clojure
(defn push [v i n]
  (if (>= (count v) n) (conj (subvec v 1 n) i) (conj v i) ))
```

ref. [queue - Fixed length stack structure in Clojure - Stack Overflow](https://stackoverflow.com/questions/13353463/fixed-length-stack-structure-in-clojure)

---

Clojure 1.9ã§è¿½åŠ ã•ã‚ŒãŸswap-vals!ã‚’ã¤ã‹ã†ã®ã‚‚ã‚ˆã„.

ref.

```clojure
(defn push! [a v] swap! a (conj v))
(defn pop! [a] (-> a
                 (swap-vals! pop)
                 first
                 peek))

(def queue (atom clojure.lang.PersistentQueue/EMPTY))
(def stack (atom []))
```

-   refs.
    -   <https://twitter.com/ericnormand/status/1046822354729537536>
    -   [Using Clojure's swap-vals! in Lock-Free Algorithms](https://matthewdowney.github.io/clojures-swap-vals-in-lock-free-algorithms.html)

---

-   [ğŸ”–queue]({{< relref "20220310124045.md#c7e19204-6111-4559-8978-cd93049cf076" >}})
-   [Queues in Clojure â€“ Michael Zavarella â€“ I don't edit anything I write](https://admay.github.io/queues-in-clojure/)
-   [ã‚¹ã‚¿ãƒƒã‚¯ã¨ã‚­ãƒ¥ãƒ¼ - tnoda-clojure](https://tnoda-clojure.tumblr.com/post/25798318986/stack-and-queue-in-clojure)


### ğŸ’¡å¤§ããªã‚µã‚¤ã‚ºã®vectorã¯lastã‚ˆã‚Špeek {#1968ea}

å¤§ããªã‚µã‚¤ã‚ºã®vectorã¯lastã‚ˆã‚ŠpeekãŒæ¨å¥¨ã•ã‚Œã¦ã„ã‚‹. lastã‚‚peekã‚‚ã©ã¡ã‚‰ã‚‚æœ«å°¾ã®è¦ç´ ã‚’å–ã‚Šå‡ºã™.

;; Prefer clojure.core/peek over \`last\` for potentially large vectors.

ref. <https://clojuredocs.org/clojure.core/last>


### ğŸ’¡listã®ãƒãƒ¼ã‚¸ {#030780}

listã«å¯¾ã—ã¦mergeã‚’ã™ã‚‹ã¨æœŸå¾…é€šã‚Šã«ãªã‚‰ãªã„ç½ ãŒã‚ã‚‹.

```clojure
(merge '(1 2 3) '(4 5 6))
;; => ((4 5 6) 1 2 3)
```

ã“ã®å ´åˆ, **concat** ã‚’åˆ©ç”¨ã™ã‚‹. æˆ»ã‚Šå€¤ã¯Lazu Seqã«ãªã‚‹ã“ã¨ã«æ³¨æ„(input ãŒvectorã§ã‚‚seq).

concatã¯LazySeqã‚’è¿”ã™ã‚‚ã®ã®, çµåˆã®é€”ä¸­ã§ä¸­èº«ã‚’è©•ä¾¡ã™ã‚‹ã“ã¨ã«æ³¨æ„. ã¨ãã«é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’è©•ä¾¡ã›ãšã«çµåˆã—ãŸã„ã¨ãã¯[lazy-cat](#df1fc0ec-ae88-4597-929f-184653193516)ã‚’ã¤ã‹ã†ã“ã¨.


### ğŸ’¡listã®ç©ºåˆæœŸåŒ– {#d3a518}

()ã‚’ãã®ã¾ã¾æ›¸ãã¨è©•ä¾¡ã•ã‚Œã¦ã—ã¾ã†ãŸã‚, quote(' ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚ªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³)ã‚’()ã®å‰ã«ã¤ã‘ã‚‹.

ã™ãªã‚ã¡, **\`()** ã§ã‚ã‚‹.


### ğŸ’¡consã¨conjã®é•ã„ {#521b37}

conjã¯ãƒªã‚¹ãƒˆã«ä½¿ã†å ´åˆã¨ãƒ™ã‚¯ã‚¿ã«ä½¿ã†å ´åˆã§æŒ¿å…¥ãŒå‰å¾Œç•°ãªã‚‹.

ãã‚Œã¯åŠ¹ç‡æ€§ã‚’è€ƒæ…®ã—ãŸè¨­è¨ˆã‚‰ã—ã„. conjã¯åŠ¹ç‡çš„ã«æŒ¿å…¥ã™ã‚‹ãŸã‚ã«ãƒªã‚¹ãƒˆãªã‚‰ã°å‰ã¸, ãƒ™ã‚¯ã‚¿ãªã‚‰å¾Œã‚ã¸è¿½åŠ ã™ã‚‹.

-   refs.
    -   [consã¨conjã®é•ã„ - ayato-p](https://scrapbox.io/ayato-p/cons%E3%81%A8conj%E3%81%AE%E9%81%95%E3%81%84)
    -   [collections - Clojure: cons (seq) vs. conj (list) - Stack Overflow](https://stackoverflow.com/questions/3008411/clojure-cons-seq-vs-conj-list)


## Clojure Map(clojure.core.map) {#30a935ff-4448-43a2-8ec7-8c37e18b6ca5}

-   assoc: (key, value)ã®è¿½åŠ 
-   dissoc: (key, value)ã®å‰Šé™¤
-   update: (key)ã®æŒ‡ã™(value)ã«å¼•æ•°ã§ä¸ãˆã‚‰ã‚ŒãŸé–¢æ•°ã‚’é©ç”¨ã—ã¦ç½®ãæ›ãˆã‚‹.
-   merge: (key, value)ã®é›†åˆã®è¿½åŠ 

assocã¯å€¤ã‚’æ›´æ–°ã—ã¦Mapã‚’è¿”ã™, updateã¯å€¤ã«é–¢æ•°ã‚’é©ç”¨ã—ã¦Mapã«æŸç¸›ã™ã‚‹. ã“ã®é–¢ä¿‚ã¯, [atomã§ã®reset! ã¨swap!ã®é•ã„]({{< relref "20220116191927.md#88423db9-b606-48ce-9a62-e6b3149d0514" >}}) ã«ä¼¼ã¦ã„ã‚‹.

mapã¯é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚, doall ãªã©ã®è©•ä¾¡ã¯åˆ¥é€”å¿…è¦.

ã—ã‹ã—doallã‚’ä¸€é€£ã®map/filter/reduceä¸­ã«æŒŸã‚€ã¨å‡¦ç†é€Ÿåº¦ãŒè½ã¡ã‚‹ãŸã‚å¿…è¦ãªã¨ãã®ã¿åˆ©ç”¨ã™ã‚‹. ã¾ãŸã¯é€æ¬¡å‡¦ç†ã§ã‚ã‚‹doseqã‚’æ¤œè¨ã™ã‚‹.

é€”ä¸­ã§ä¸­èº«ãŒå¿…è¦ã¨ã„ã†ã®ã¯ãã‚‚ãã‚‚mapã‚’å‘½ä»¤å½¢ã®foræ–‡ã®ãƒãƒªã§ä½¿ã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„.

-   cf. [Clojureã®ç¹°ã‚Šè¿”ã—: map vs doseq]({{< relref "20220116083656.md#cb2449fb-2bed-4b5d-8633-5ce00723f7fa" >}})
-   ref. [Clojure: é…å»¶è©•ä¾¡/é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹](#4f51982f-85bd-4e92-a85e-12cf66360653)


## Clojure: ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª(map/filter/reduce) {#30a69008-36ac-46c0-b1ea-8217090d150c}

Clojureã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿æ“ä½œ[é«˜éšé–¢æ•°]({{< relref "20220305080412.md#b9dd6690-c1b1-4efa-8ffb-e1affbbc9674" >}})(map/filter/reduce)ä»–ã®ã¾ã¨ã‚.

åŸºæœ¬çš„ã«ã¯ï¼”ã¤ã«åˆ†é¡ã§ãã‚‹(ref. [ğŸ’¡ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°Clojureã‚ˆã‚Šé«˜éšé–¢æ•°ï¼”åˆ†é¡]({{< relref "20220305080412.md#5ff23b1c-c200-4688-963c-0f9745827a4e" >}})).

æœ‰é™ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ã¯ãƒªã‚¹ãƒˆå†…åŒ…è¡¨è¨˜ã‚‚ã‚ã‚‹(ref. [ğŸ’¡Clojureã®ç¹°ã‚Šè¿”ã—: map vs doseq(for)]({{< relref "20220116083656.md#cb2449fb-2bed-4b5d-8633-5ce00723f7fa" >}})).

ã„ã‚ã„ã‚ã‚ã‚‹ãŒæ‰‹ã‚’å‹•ã‹ã—ã¦è¦šãˆãŸã»ã†ãŒã„ã„. åŸºæœ¬çš„ãªæ©Ÿèƒ½ã¯ä»–ã®è¨€èªã§ã‚‚ã‚ã‚‹ã®ã§ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚’è¦šãˆã‚‹ã®ã¿.æ‰‹ç¶šãçš„ãªãƒ‘ãƒ©ãƒ€ã‚¤ãƒ ã‹ã‚‰è„±å‡ºã™ã‚‹ãŸã‚ã«ã‚‚èº«ã«ç€ã‘ãŸã„ã¨ã“ã‚.

ref. [ğŸ“Clojure Tips]({{< relref "20220302101805.md" >}})

ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«ã¯ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã‚‚ã„ã‚ã„ã‚ã‚ã‚‹ã®ã§ãã®éƒ½åº¦è¦šãˆã‚ˆã†.

ref. [ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®åˆ†é›¢ã¨åˆæµãƒ†ã‚¯ãƒ‹ãƒƒã‚¯]({{< relref "20220302101805.md#f3e035f4-a23e-435d-a1e3-903e33dc9d49" >}})

---

reduceã‚’é€²åŒ–ã•ã›ãŸ[ğŸ“Clojure Transducer]({{< relref "20220331203002.md" >}}).


### Clojure: é«˜éšé–¢æ•° Basics {#b1bf27}

-   mapã¯ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«é–¢æ•°ã‚’é©ç”¨ã—ã¦ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’è¿”ã™.
-   filterã¯ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®è¦ç´ ã®ãã‚Œãã‚Œã«predicateã‚’é©ç”¨ã—ã¦trueã®è¦ç´ ã®ã¿ã‚’å–ã‚Šå‡ºã™.
-   reduce ã¯ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’accuumurateã—ã¦å˜ä¸€ã®æˆ»ã‚Šå€¤ã‚’è¿”ã™.
-   forã¯ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’é †ç•ªé€šã‚Šã«é€šã‚Šã«å–ã‚Šå‡ºã™.
    -   æ‰‹ç¶šãçš„ã«å‡¦ç†ã—ãŸã„å ´åˆã«ä½¿ã†.
    -   pythonã®foreach, zipçš„ãª.
-   flattenã¯å…¥ã‚Œå­æ§‹é€ ã®é…åˆ—ã‚’å˜ä¸€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«å¤‰æ›ã™ã‚‹.


### Clojure map {#a667056d-aa33-4e16-8689-ed4de0d46e8b}

mapã¯ [é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹](#4f51982f-85bd-4e92-a85e-12cf66360653) ã‚’æ§‹ç¯‰ã—, [dorun/doall]({{< relref "20220116083656.md#dea9ae38-ea8d-476e-a04e-0149bf17766a" >}}) ãªã©ã§å¼·åˆ¶è©•ä¾¡ã—ã¦ã¯ã˜ã‚ã¦ãƒªã‚¹ãƒˆãŒé †æ¬¡å®Ÿè¡Œã•ã‚Œã‚‹.

[ğŸ”–map]({{< relref "20220305080412.md#e41acc92-e157-46c9-b156-6db4692cbf75" >}})


### clojure pmap {#0179abc5-0b84-49fb-9b4d-50e01e561e3a}

pmapã¯é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’æ§‹ç¯‰ã™ã‚‹ã‚‚ã®ã®, doallã§è©•ä¾¡ã™ã‚‹ã¨ãƒªã‚¹ãƒˆãŒãƒ‘ãƒ©ãƒ¬ãƒ«ã«ä¸¦åˆ—å®Ÿè¡Œã•ã‚Œã¦çµæœãŒãƒªã‚¹ãƒˆã§è¿”ã•ã‚Œã‚‹(Java Futureã‚’å†…éƒ¨ã§åˆ©ç”¨).

ref. [pmap - clojure.core | ClojureDocs](https://clojuredocs.org/clojure.core/pmap)

ä»¥ä¸‹ã®ï¼’ã¤ã§ã¯å®Ÿè¡Œæ™‚é–“ã«4å€ã®å·®ãŒç”Ÿã¾ã‚Œã‚‹.

```clojure
(defn long-running-job [n]
    (Thread/sleep 3000)
    (+ n 10))

(doall (map long-running-job (range 4)))
(doall (pmap long-running-job (range 4)))
```

-   refs.
    -   [ğŸ’¡Lazy Sequence + pmap + doallã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãŒå¼·ã„]({{< relref "20220426214300.md#ec1f1d43-00b8-4eaa-9bb7-751fbb843c9d" >}})


### clojure: filter {#2f67d978-d850-4251-9ea4-c75f95f2991e}

ä¸ãˆã‚‰ã‚ŒãŸã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰æ¡ä»¶ã«åˆã†ã‚‚ã®æŠœãå‡ºã™.

```clojure
(filter pred coll)
```

filterç³»ã¯æ´¾ç”Ÿé–¢æ•°ãŒã„ã‚ã„ã‚ã‚ã‚‹.

-   **remove** ã¯ filterã®é€†ã§æ¡ä»¶ãŒtrueã«ãªã‚‹ã‚‚ã®ã‚’å–ã‚Šé™¤ã.
-   **keep** ã¯ fã§è©•ä¾¡ã—ãŸçµæœãŒnilã§ãªã„ã‚‚ã®ã‚’æ®‹ã™.

---

tag: [ğŸ·filter]({{< relref "20220305080412.md#c2281cde-6c21-4b81-af21-f90118117836" >}})


### Clojure: reduce {#0b9df4a0-30ce-4e72-bcb5-c0d8f959ba0e}

Clojureã«ãŠã‘ã‚‹[ğŸ”–reduce]({{< relref "20220305080412.md#7fcda7c4-8879-4272-9e5a-8c10bc9339b2" >}})ã¾ã¨ã‚. Clojureã«ã¯[ğŸ“Clojure Transducer]({{< relref "20220331203002.md" >}})ã¨ã„ã†reduceã‚’æ‹¡å¼µã—ãŸä»•çµ„ã¿ãŒã‚ã‚‹.


#### reduceã«æ¸¡ã™ã‚«ã‚¹ã‚¿ãƒ é–¢æ•° {#874168}

è‡ªä½œã®é–¢æ•°ã‚’æ¸¡ã™æ™‚ã¯, å¼•æ•°ã«æ³¨æ„. å¿…ãš2ã¤æ¸¡ã™å¿…è¦ãŒã‚ã‚‹.

```clojure
(fn [acc x]
  (accoc acc :hoge x))
```

1ã¤ç›®ãŒé›†ç´„çµæœã®å¤‰æ•°. 2ã¤ç›®ãŒä»Šå›å‡¦ç†ã™ã‚‹å¤‰æ•°.

ã„ã¤ã‚‚å¿˜ã‚Œã‚‹ & ãƒãƒƒãƒˆã§è¦‹ã¤ã‹ã‚‰ãªã„..


#### reduced: reduceã‚’é€”ä¸­ã§æ‰“ã¡åˆ‡ã‚‹ {#0b66f7}

æ¡ä»¶ã«ãƒãƒƒãƒã—ãŸã‚‰reduceã‚’é€”ä¸­ã§æ‰“ã¡åˆ‡ã‚‹helperé–¢æ•°ã¨ã—ã¦reducedãŒã‚ã‚‹. loop/recurã§æ›¸ã„ã¦ã„ãŸå‡¦ç†ã‚‚reduceã§æ›¸ãã‚„ã™ããªã‚‹.

[reduced - clojure.core | ClojureDocs](https://clojuredocs.org/clojure.core/reduced)

```clojure
(defn limit [x y]
  (let [sum (+ x y)]
    (if (> sum 10) (reduced sum) sum)))

(reduce limit 0 (range 10))
;; => 15
```


## Clojure: é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹/ç„¡é™ã‚·ãƒ¼ã‚±ãƒ³ã‚¹(Laziness Sequence) {#4f51982f-85bd-4e92-a85e-12cf66360653}

Clojureã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®å¤šãã¯é…å»¶è©•ä¾¡ã•ã‚Œã‚‹. ã™ãªã‚€ã¡é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã§ã‚ã‚‹.

-   rangeã§, é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®æ•°åˆ—ã‚’ä½œæˆã§ãã‚‹.
-   repeatã§, é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®ã‚·ãƒ³ãƒœãƒ«ã®ç¹°ã‚Šè¿”ã—ãŒä½œæˆã§ãã‚‹.
-   repeatedlyã§, æŒ‡å®šå›æ•°ã ã‘ç„¡åé–¢æ•°ã‚’é©ç”¨ã—ãŸã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ä½œæˆã§ãã‚‹.
-   iterateã§, é–¢æ•°é©ç”¨ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ä½œæˆã§ãã‚‹. æ•°å­¦ã®æ¼¸åŒ–å¼.

ref. [Clojure: é…å»¶è©•ä¾¡(Laziness Evaluation)]({{< relref "20220116094551.md#00cc3f1b-f4fc-4420-9404-bb9a75d1c172" >}})


### é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®çµåˆ(lazy-cat) {#df1fc0ec-ae88-4597-929f-184653193516}

[lazy-cat - clojure.core | ClojureDocs - Community-Powered Clojure Documentation and Examples](https://clojuredocs.org/clojure.core/lazy-cat)

concatã¯LazySeqã‚’è¿”ã™ã‚‚ã®ã®çµåˆã®é€”ä¸­ã§ä¸­èº«ã‚’è©•ä¾¡ã™ã‚‹ã“ã¨ã«æ³¨æ„. ã¨ãã«é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’è©•ä¾¡ã›ãšã«çµåˆã—ãŸã„ã¨ãã¯lazy-catã‚’ã¤ã‹ã†.

ã“ã‚Œã¯concatã®ãƒã‚¯ãƒ­ã§ã‚ã‚Šã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯ä»¥ä¸‹ã«éããªã„.

> (lazy-cat xs ys zs) `=` (concat (lazy-seq xs) (lazy-seq ys) (lazy-seq zs))


### ã‚·ãƒ¼ã‚±ãƒ³ã‚¹è¨ˆç®—ã®å¼·åˆ¶è©•ä¾¡(doall/dorun) {#bd102f}

é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®å®Ÿç¾ã«ã¯ doall, dorunã‚’åˆ©ç”¨ã™ã‚‹.

-   refs.
    -   [Clojureã®ç¹°ã‚Šè¿”ã—: map vs doseq]({{< relref "20220116083656.md#cb2449fb-2bed-4b5d-8633-5ce00723f7fa" >}})
    -   [Lazy Evaluation: é…å»¶è©•ä¾¡]({{< relref "20220305075933.md#16d2809f-4277-42c4-aa72-f55a873b5feb" >}})


### take-while: ã‚ã‚‹æ¡ä»¶ã‚’æº€ãŸã™ã¾ã§å‡¦ç†ã‚’ç¶šã‘ã‚‹ {#6c16ff4d-a89e-4bb0-9f4f-40b00cee351c}

reduceã®ç™ºå±•ã§, predã‚’æº€ãŸã™ã¾ã§ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‹ã‚‰è¦ç´ ã‚’å–å¾—ã™ã‚‹.

ãŸã¨ãˆã°å…ˆé ­ã‹ã‚‰ã‚½ãƒ¼ãƒˆã•ã‚ŒãŸçŠ¶æ…‹ã§timestampã‚’æ¡ä»¶ã«ã—ã¦å–å¾—ã™ã‚‹ãªã‚‰ã°, filterã‚ˆã‚Šã‚‚åŠ¹ç‡çš„ã§ã‚ã‚‹. ã¾ã—ã¦ã‚„laze-seqãªã©ã¯filterã‚ˆã‚Šã‚‚ãªãŠã•ã‚‰ã‚ˆã„.

[take-while - clojure.core | ClojureDocs](https://clojuredocs.org/clojure.core/take-while)

é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’æ‰±ã†ä¸Šã§ã®é‡è¦ãªé–¢æ•°.


### ğŸ’¡Clojureè¨­è¨ˆæ€æƒ³ã¨ã—ã¦ã®é…å»¶è©•ä¾¡æˆ¦ç•¥ {#c502f03c-2230-4414-9798-a410901702d5}

ãªãœClojureã®ä¸–ç•Œã§ã¯å…¨ã¦ãŒé…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãªã®ã‹?

å€¤ãŒå¿…è¦ã«ãªã‚‹ã¾ã§ãã®è©•ä¾¡ã‚’é…ã‚‰ã›ã‚‹

ã¨ã„ã†[ğŸ”–Clojure Way]({{< relref "20220116161735.md" >}})ãŒãŒã‚ã‚‹.

-   refs.
    -   [lazy-seq in Clojure (ç¿»è¨³ by Takanori Ishibashi)](https://11takanori.medium.com/lazy-seq-in-clojure-%E7%BF%BB%E8%A8%B3-8fba0ebcb6af)


### ğŸ’¡Clojureã§ã¯é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ä½¿ã„ã“ãªã™ã“ã¨ãŒã‚­ãƒ¢ {#3f0dac85-2361-448a-9d8b-6dcbc379b864}

ref. [Clojureã®ä¸–ç•Œã¨å®Ÿéš›ã®Webé–‹ç™º](https://www.slideshare.net/tsutomuyano/clojureweb)

ã“ã“ã§èªã‚‰ã‚Œã¦ã„ã‚‹æœ¬è³ªã‚’ç†è§£ã—ãŸã„.

-   å…¨ã¦ã®ãƒªã‚¹ãƒˆå‡¦ç†é–¢æ•°ã®å¤§åŠã¯é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ã¤ãã‚‹.
    -   map/filter/reduce/constantly
    -   iterate/repeat
-   é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã¯è¦ç´ ã‚’å–å¾—ã™ã‚‹ã¨å®Ÿä½“åŒ–ã™ã‚‹.
-   å…¨ã¦ã¯é…å»¶å®Ÿè¡Œã•ã‚Œã‚‹.
    -   RDBã¸ã¡ã‚‡ã£ã¨ãšã¤ã‚¯ã‚¨ãƒªã‚’æŠ•ã’ã¦æœ€çµ‚çš„ã«å…¨éƒ¨å–ã‚‹é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹.
    -   å¤–éƒ¨APIã‹ã‚‰offset/limitã‚’ä½¿ã£ã¦é©å®œãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹é…å»¶ã‚·ãƒ¼ã‚±ãƒ³ã‚¹.

[ğŸ”–Clojure Way]({{< relref "20220116161735.md" >}})


## Clojure: ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãƒˆãƒ”ãƒƒã‚¯ã‚¹ {#275107}


### ğŸ’¡Clojureã«ãŠã‘ã‚‹Sequenceã¨Collectionã®é•ã„ {#dc0529}

Clojureã§ã¯Collectionã¨Sequenceã¯ç•°ãªã‚‹æ¦‚å¿µ.

-   collection: ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®æŠ½è±¡.
-   sequence: collectionã®ä¸­ã§ãƒ‡ãƒ¼ã‚¿ã‚’é †æ¬¡ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½(ã‚·ãƒ¼ã‚«ãƒ–ãƒ«)ãªã‚‚ã®.

Sequenceã¯Collectionã®ç‰¹æ®Šãªå½¢æ…‹ã§ã‚ã‚Šã€Collectionã‚’è¡¨ç¾ã™ã‚‹æ–¹æ³•ã®1ã¤.

å®Ÿè£…ãƒ¬ãƒ™ãƒ«ã§ã¯ coll?ã§çœŸãŒå¤‰ãˆã‚Œã°collection, seq?ã§çœŸãŒå¤‰ãˆã‚Œã°sequence.

collectionã¯IPersistentCollectionã¨ã„ã†ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã‚‚ã®.
IPersistentCollectionã¯5ã¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆcount, cons, empty, equiv, seqï¼‰ã‹ã‚‰ãªã‚‹.

sequenceã¯ISeqã¨ã„ã†ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã‚‚ã®.
ISeqã¯(first, next, more, cons)ã‹ã‚‰ãªã‚‹.

---

-   ref: Clojureã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®æŠ½è±¡åŒ–ã‚’ç†è§£ã—ã¦ç‹¬è‡ªã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å®Ÿè£…ã™ã‚‹
    -   [Part 1: Collectionã¨ã¯ä½•ã‹ - æœ¬å½“ã¯æ€–ã„HPC](https://freak-da.hatenablog.com/entry/2015/08/05/222224)
    -   [Part 2: Sequenceã¨ã¯ä½•ã‹ - æœ¬å½“ã¯æ€–ã„HPC](https://freak-da.hatenablog.com/entry/2015/08/11/180047)


### ğŸ’¡Clojureãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®æ“ä½œé–¢æ•°ã®åˆ†é¡ {#582983e0-0ed8-419e-aa14-c9b227ad42f9}

Clojureã®é–¢æ•°ã¯å¤§ããåˆ†ã‘ã¦ï¼’ã¤ã®ç¨®é¡ã«åˆ†ã‘ã‚‰ã‚Œã‚‹.

-   ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®æ“ä½œã®é–¢æ•°(conj, disj, assoc, dissoc...)
-   ã‚·ãƒ¼ã‚±ãƒ³ã‚¹æ“ä½œã®é–¢æ•°(cons, map, filter, reduce..)

ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ“ä½œã™ã‚‹é–¢æ•°ã¯é–¢æ•°ã®æ¬¡ã«ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å—ã‘ã‚‹.
ä¸€æ–¹ã‚·ãƒ¼ã‚±ãƒ³ã‚¹æ“ä½œã¯é–¢æ•°è©•ä¾¡å¼ã®æœ€å¾Œã«ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å—ã‘ã‚‹.

[Clojure: Threading Macros]({{< relref "20220116083656.md#508f51c6-37cb-4b61-9bce-91075f1f067e" >}}) ã«ã‚‚ 2ç¨®é¡ã‚ã‚‹ã®ã‚‚ã“ã‚ŒãŒé–¢ä¿‚ã—ã¦ã„ã‚‹.

ref: [Clojure - Frequently Asked Questions](https://clojure.org/guides/faq#seqs_vs_colls)


### Associative vs Sequencialã¨ã„ã†æ¦‚å¿µã®å¯¾ç«‹ {#524f01}

T.B.D.


### ã‚·ãƒ¼ã‚«ãƒ–ãƒ«ã¨ã¯ {#23df03}

T.B.D. ã‚ã¨ã§æ·±å €.


## ğŸ”—References {#3b90d2}


### externals {#0bf849}

-   [Clojureã®sequenceé–¢ä¿‚ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®ã¾ã¨ã‚ Â· GitHub](https://gist.github.com/syou6162/3648601)
-   [Clojure Data Structures Tutorial with Code Examples](https://ericnormand.me/guide/clojure-collections)
    -   ã‘ã£ã“ã†ãŒã£ã¤ã‚Šã¨ã—ãŸClojureãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¾ã¨ã‚
