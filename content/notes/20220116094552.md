+++
title = "ğŸ“Clojure: åˆ†é…æŸç¸› - Destructuring"
lastmod = 2022-10-10T21:12:09+09:00
tags = ["WIKI", "Clojure"]
draft = false
+++

-   up: [ğŸ“Clojure Functional Programming]({{< relref "20220116094551.md" >}})


## Clojureåˆ†é…æŸç¸› Overview {#42ce87}

Clojureã§ã¯åˆ†é…æŸç¸›ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹.

-   ã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«ã¨ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ãƒ†ã‚£ãƒ–ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ï¼’ã¤ã®ç¨®é¡ãŒã‚ã‚‹.
    -   Sequencial Destructuring: Vectoræ§‹é€ ã‚’åˆ†è§£
    -   Associative Destructuring: Mapæ§‹é€ ã‚’åˆ†è§£
-   vectorã®ä¸­ã«vectorã‚„mapã‚’æ›¸ã„ã¦è¡¨ç¾ã™ã‚‹.
    -   [[][]]
    -   [{}{}]
-   åˆ†é…æŸç¸›ã—ãŸããªã„å¤‰æ•°ã¯vectorãªã‚‰:as,  mapãªã‚‰:or ã§è¡¨ç¾ã™ã‚‹.
-   :keysã‚’ã¤ã‹ã†ã¨ï¼Œmapã‚’ã†ã‘ã¨ã£ãŸã‚‰ãã®å€¤ã‚’ã‚·ãƒ³ãƒœãƒ«ã«ãƒã‚¤ãƒ³ãƒ‰ã§ãã‚‹.


## Clojure Basic Techniques {#627b0d}


### ä¸€æ™‚å¤‰æ•°(let)ã‚’åˆ†è§£ã™ã‚‹ãŸã‚ã«åˆ†é…æŸç¸›ã‚’ã¤ã‹ã† {#9f8653}

é€šå¸¸ã¯ **let** ã®ä¸­ã§ä½¿ã‚ã‚Œã‚‹.

```clojure
(def my-vector [:a :b :c :d])

(let [[a b c d] my-vector]
  (println a b c d))
;; => :a :b :c :d
```


### é–¢æ•°ã®å¼•æ•°ã§åˆ†é…æŸç¸›ã‚’ã¤ã‹ã† {#f85980}

é€šå¸¸ã¯ [[][]]ã‚„[{}{}]ã®ã‚ˆã†ã«æ›¸ã„ã¦å³ã‹ã‚‰å·¦ã«parseã™ã‚‹ãŒ, é–¢æ•°ã®å¼•æ•°ã¨ã—ã¦[[][]]ã‚’çœç•¥ã—ã¦[[]]ã¨ã‹ã‘ã‚‹.

é€šå¸¸ã®binding.

```clojure
(defn foo [a b]
    (println a b))

(defn foo [a b & {:keys [x y]}]
  (println a b x y))
(foo "A" "B" :x "X" :y "Y")  ;; => A B X Y
```

ä½™åˆ†ãªã‚‚ã®ã¯ã²ã¨ã¤ã«ã¾ã¨ã‚ã‚‹binding.

```clojure
(defn foo [a b & args]
    (println a b args))
(foo :a :b :x :y :z) ;; => :a :b (:x :y :z)

(defn foo [& {:as m}]
  (println m))
(foo :x "X" :y "Y") ;; => {:y Y, :x X}
```

keysã§å¿…è¦ãªã‚‚ã®ã ã‘å–ã‚Šã¤ã¤æ®‹ã‚Šã‚‚å–ã‚‹ã‚ˆãã°ã‚Šãƒ‘ã‚¿ãƒ¼ãƒ³.

```clojure
(defn foo [a b & {:keys [x y] :as m}]
  (println a b x y m))
(foo "A" "B" :x "X" :y "Y")
;; => A B X Y {:y Y, :x X}
```

ã“ã®è¨˜æ³•(keywordå¼•æ•°ã«mapã‚’æŒ‡å®š)ã¯Clojure 1.11ã‹ã‚‰ã®ã‚µãƒãƒ¼ãƒˆãªã®ã‹ãªï¼Ÿ

[Clojure - Keyword argument functions now also accept maps](https://clojure.org/news/2021/03/18/apis-serving-people-and-programs)

ã“ã®æ›¸ãæ–¹ã¯ã¤ã‹ãˆãã†.

```clojure
(defn some-handler [{:keys [db,,,,] :as req}]
,,)
```

å¥¥ãŒæ·±ã„...

see also: [é–¢æ•°ã®å¼•æ•°ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’æŒ‡å®šã™ã‚‹ã«ã¯ï¼Ÿ](#18999971-4a76-4a34-be2d-57c97b0fafdb)


### Mapã®keywordä»¥å¤–ã®ãƒãƒ©ã—æ–¹(:strs/:syms) {#591963}

:keysãŒã‚ã¾ã‚Šã«ã‚‚ç™»å ´æ©Ÿä¼šãŒãŠãŠã„æ°—ãŒã™ã‚‹ãŒ, åˆ†é…æŸç¸›ã¯keywordä»¥å¤–ã«ã‚‚æ–‡å­—åˆ—ã‚„ã‚·ãƒ³ãƒœãƒ«ã§åˆ©ç”¨å¯èƒ½.

æ–‡å­—åˆ—ã¯ **:strs**, ã‚·ãƒ³ãƒœãƒ«ã¯ **:syms** ã§ãã‚Œãã‚Œåˆ†è§£ã™ã‚‹.


## âœ…Clojure Destructureing Tips {#e08dde84-e7a1-43a5-b505-68a3b84c661b}

åˆ†é…æŸç¸›ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’Clojureã§ä½¿ã„ã“ãªã›ã‚‹ã¨ãƒ¢ãƒ†ã‚‹ã¨ã‹èª°ã‹ãŒè¨€ã£ã¦ãŸ.

[ğŸ“Clojure Tips]({{< relref "20220302101805.md" >}})


### âœ…ãƒã‚¹ãƒˆã—ãŸMapã‚’åˆ†é…æŸç¸›ã§ãƒãƒ©ã›ã‚‹ã‹? {#68a968}

æ®ºã‚Œã¾ã™!

```clojure
(def my-nested-hashmap {:a "A" :b "B" :c "C" :d "D"
                        :q {:x "X" :y "Y" :z "Z"}})

(let [{:keys [a b] {:keys [x y]} :q} my-nested-hashmap]
  (println a b x y))
```

ã—ã‹ã—è‹¥å¹²ã®èª­ã¿ã«ãã•ãŒã‚ã‚‹ã®ã§ç„¡ç†ãªã„ã»ã†ãŒã„ã„ã‹ã‚‚.


### âœ…é–¢æ•°ã®å¼•æ•°ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’æŒ‡å®šã™ã‚‹ã«ã¯ï¼Ÿ {#18999971-4a76-4a34-be2d-57c97b0fafdb}

ã„ã‚ã‚†ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã¨ã„ã†ã‚‚ã®ã ãŒ, ä½ç½®å¼•æ•°ã«å€¤ã‚’è¨­å®šã™ã‚‹æ–¹æ³•ã¯è¦‹å½“ãŸã‚‰ãªã„(è¦‹ã¤ã‘ã‚‰ã‚Œã¦ãªã„ã ã‘ã‹ã‚‚).

ä»£ã‚ã‚Šã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°ã¨ [ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¼•æ•°]({{< relref "20220305075933.md#4c510cea-aa58-487e-b766-8a164dd1351f" >}}) ã®æ–‡æ³•ã®çµ„ã¿åˆã‚ã›ã§ã§ãã‚‹.

[åˆ†é…æŸç¸›(Destructuring)]({{< relref "20220116094552.md" >}}) ã® **or** ã‚’æ´»ç”¨ã™ã‚‹.

```clojure
(defn myfunc
  [arg & {:keys [opt1 opt2] :or {opt1 "default1" opt2 "default2"}}]
  (format "arg=[%s] opt1=[%s] opt2=[%s]" arg opt1 opt2))

(myfunc "argument" {:opt1 "option1"})
;; => "arg=[argument] opt1=[option1] opt2=[default2]"
```


### def inside let: åˆ†é…æŸç¸›ã§ãƒãƒ©ã—ãŸå€¤ã‚’bind {#53a0f8}

é¢ç™½ã„letã¨defã®çµ„ã¿åˆã‚ã›ãªã®ã§ãƒ¡ãƒ¢.

ref. <https://github.com/ptaoussanis/sente>

```clojure
(let [{:keys [chsk ch-recv send-fn state]}
      (sente/make-channel-socket-client!
       "/chsk" ; Note the same path as before
       ?csrf-token
       {:type :auto ; e/o #{:auto :ajax :ws}
       })]

  (def chsk       chsk)
  (def ch-chsk    ch-recv) ; ChannelSocket's receive channel
  (def chsk-send! send-fn) ; ChannelSocket's send API fn
  (def chsk-state state)   ; Watchable, read-only atom
  )
```

ã“ã“ã§ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯, make-channel-socket-client!ã®æˆ»ã‚Šå€¤ã®Mapã‚’åˆ†é…æŸç¸›ã§ãƒãƒ©ã—ãŸä¸Šã§, defã‚’ä½¿ã£ã¦namespaceã«bindã—ã¦ã„ã‚‹. letã¯ãƒ¬ã‚­ã‚·ã‚«ãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã ãŒ, defã®ã‚¹ã‚³ãƒ¼ãƒ—ã¯namespaceã«ãªã‚‹.


## <span class="org-todo todo _">ğŸ”—</span> Rerefences {#dd6865}

-   [Clojureã®åˆ†é…æŸç¸›ã¾ã¨ã‚ - Qiita](https://qiita.com/hatappo/items/41f9b3c7495095508a76)
-   [Clojure Destructuring Tutorial and Cheat Sheet Â· GitHub](https://gist.github.com/john2x/e1dca953548bfdfb9844)
