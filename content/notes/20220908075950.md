+++
title = "📝損切りと利益確定"
lastmod = 2022-11-05T14:28:48+09:00
tags = ["WIKI"]
draft = false
+++

-   up: [🔖トレード戦略]({{< relref "20220716193728.md" >}})


## Overview {#3b8782}

損切りと利益確定は似ているので同じメモにまとめる.

-   [📝損切り](#60c125bf-cbe4-4433-8d31-d0d6e9b2627f)
-   [📝利益確定](#2799bab5-4198-4496-82eb-341aa527aa75)

---

-   refs.
    -   [📝ディレクショナル戦略]({{< relref "20220918070939.md" >}})
    -   [逆指値注文]({{< relref "20220918092649.md#05a70858-8c84-4813-ad32-eaac12a782ad" >}})


## 📝損切り {#60c125bf-cbe4-4433-8d31-d0d6e9b2627f}

ポジションが含み損になっているときに損失を確定させること.

しばしばストップロス注文と同じ意味で使われるものの, 厳密にはStop Ordersの一部がStop Lossと呼ばれる関係. 文脈による.

[逆指値注文]({{< relref "20220918092649.md#05a70858-8c84-4813-ad32-eaac12a782ad" >}})を駆使する.

投資用語であるものの, 投資以外にも応用がきく概念のため, 知識をつなげていく.


### 損失確定のための逆指値注文 {#145cae}

ある価格に現在価格が達したらそれ以上の損失をしないために注文を予約しておく.

成行注文ならば即座に注文が執行される.

指値注文ならば, これ以上損失を出さない値を指定することが出来る.


## 📝利益確定 {#2799bab5-4198-4496-82eb-341aa527aa75}

Take Profit, TP, 利益確定, 利確, 利食いと略される.

ポジションが含み益になっているときに決済して利益を確定させる.


### 利益確保としての逆指値注文 {#2f77ea}

利益確定を指値で出すケースは, 利益を確保するという用途に使える.

価格が上昇しているときに, ある値を超えたらそれをトリガーに指値をいれる. すると上昇を続けたあとに下がってきた場合でも, 指値をいれてあるところまで下がったら利確する. つまり利益の下限を設定することができる.

-   links.
    -   [逆指値の利用例2：利益確保 ](https://www.matsui.co.jp/service/special-order/useful/stoploss/02_take-profit.html)


### 利益確定(成行)注文と利益確定(指値)注文の違い {#d54f4c}

通常は指値の決済のほうが手数料的には得だが, 手数料を多く払ってでも即時決済して利益を確保したいときには成行を利用する.


## 損切関連用語 {#0a410a}


### スリッページ {#85eab48f-f42a-404d-88f4-cd91f397fa94}

スリップ, 滑るともいう.

指値注文のレートと実際の約定のレートの間にズレが生じること.


### ロスカット {#c07c6726-347d-4e47-b313-00344b1957da}

自分で損失を確定させるのがストップロスなのに対して, システムが強制的に発動する決済がロスカット. [逆指値注文]({{< relref "20220918092649.md#05a70858-8c84-4813-ad32-eaac12a782ad" >}})で発動されるストップロス.

俗に市場から退場とセットで使われる.


### マージンコール {#62f091}

緊急事態システム停止.


### 精算(Liquidation) {#8daaeb8f-1006-4ff7-8739-be60d2e1b265}

Liquidation. ロスカットボリュームともいう.

Liquidateだと動詞になり, 精算する.

取引所全体でロスカットされたポジションを合算した数値. 通常不利な損切で強いられた時のネガティブな意味で使われる. 破産による精算, など.


## 損切りに関わる特殊注文 {#ecc0b05b-b3f2-444d-9e74-10630c83f15b}

英語ではStop Ordersというトピックで検索.

-   [Stop Order Definition](https://www.investopedia.com/terms/s/stoporder.asp)


### ストップロス注文 {#9f7c6ffd-4069-4a65-ad4e-e8e1ca3ac9ae}

Stop Loss Order, SLと略される.

トリガー価格に達すると自動的に成行注文が発注される.

ストップ成行とも. 成行注文のため即時決済される. もう危険というときにすぐに損切りしたいときにつかう.

一般的な逆指値注文はストップロスの意味, つまりある条件をトリガーにした成行注文で使われることがおおい(逆指値なのに成行というのは直感に反する... )


### ストップリミット注文 {#b46d5510-e230-4d6e-adea-270a6c4c6cd4}

[指値注文]({{< relref "20220918092649.md#231316af-61ce-4187-b40f-b28bce732ffe" >}})と[ストップロス注文](#9f7c6ffd-4069-4a65-ad4e-e8e1ca3ac9ae)を組み合わせたもの. ストップリミット注文でトリガー価格に達すると自動的にリミット価格を指定した指値注文とストップ価格を指定した逆指値成行注文の２つが同時に発注される.

ref. [ストップリミット注文とは? | Binance Academy](https://academy.binance.com/ja/articles/what-is-a-stop-limit-order)

損切り時の下限を事前に設定するときに使う. だんだん価格が下がってきたら, ある程度下がったところで下限を設定する意を込めて利益の下限を指値注文する. そのまま仮に価格が下がり続けたならば, ストップリミットでいれた価格で決済が走る.

ここまで下がったら自動で決済という意味で指値で下限をいれておき, 急落で指値が刺さらないときの緊急用で成行を待ち構えて価格を監視するイメージ.

一般的にはストップ値とリミット値は価格差をつける. ストップ値はリミット値よりも有利な値で設定する. どちらも損失を防ぐことが目的だが, ストップ値はリミット値より有利なものの, 市場急落時の指値はそもそも約定しないケースがあり, その場合に最悪の損失となる. その最悪のケースを防ぐための２重の防御壁がリミット値による成行決済.

損切りのときに成行注文よりもスリッページするが指値注文はしないという点と, 市場急変時に指値注文がそもそも約定シない可能性がある２点を解決するのがストップリミットのキモであり弁証法的解決法.


### ドテン注文 {#98ee0850-e269-4a60-be5b-b208231a223a}

英語ではストップエントリ注文, Stop-Entry Order.

買い(売り)ポジション決済すると同時に売り(買い)ポジションを持つこと, つまり保有するポジションをひっくり返すこと.

**途転** という古風な名前があるようで江戸時代由来な雰囲気がある.

-   [ドテン注文とは？｜ヒロセ通商](https://hirose-fx.co.jp/category/order/020.html)


### トレーリングストップ注文 {#f647f4b3-2b1b-493a-9ecf-e8f444b9c5c6}

トレール注文, Trailing Stop-Loss Order, トレールストップ注文とも.

[逆指値注文]({{< relref "20220918092649.md#05a70858-8c84-4813-ad32-eaac12a782ad" >}})の派生で, トリガーとなる価格を自動修正していく. トレール幅（価格）を設定すると, 市場価格に連動し設定した幅分の不利な値動きをした際に取引が成立.

価格というのはたいていロスカット(手仕舞い)の値, 最低限の利益を確保するための手仕舞いだったり損切りだったり.

逆指値注文修正という名称がわかりすいかも. ストップロス注文を一度いれたあとに状況に応じて値を編集していく.

Youtubeに解説動画がたくさんある.

-   [#5 5ＭＴ４でトレーリングストップ注文を入れる方法 - YouTube](https://www.youtube.com/watch?v=bzh1DXkMJr8)
-   [シンプルで最強の利益確定法、トレイリングストップ【トレードの極意】-134限目- - YouTube](https://www.youtube.com/watch?v=tfLlhh4LkBY)

---

-   [💡トレーリングストップによる利確](#bca30c29-77ec-4ae9-8075-95d82a5fb499)


### ナンピン注文 {#afc2db0d-7353-49e2-9b3f-93e54300de6a}

買った株式や投資信託などが下落した場合に, 買い付けコスト(=損益分岐点)を引き下げることを目的に, さらに買い付けること.

ナン(難)=損を平均することからの難平(ナンピン)が由来.


## 💡損切りラインの設定基準 {#e322f5}


### プロテクティブストップ {#17f4e9}

ref. [脱初心者。BOTで利益を上げるための読み物｜kapipara｜note](https://note.com/kapipara180/n/n94d162561a64)

-   パーセントリトレースメント
    -   仕掛け値から一定のパーセント上昇下落した位置にストップ値
-   ボラティリティストップ
    -   市場のノイズの外にストップ値
    -   ATRの数倍をストップの位置として使うのが一般的.
-   チャネルブレイクアウトストップ
    -   あらかじめ決めた足の最大, 最小値をストップ値
-   移動平均線ストップ
    -   あらかじめ決めた足の平均線をストップ値


### 💡トレンド時の損切りラインは2ATR {#a8a2422a-1795-4739-a382-aae9afb50016}

-   [A Logical Method of Stop Placement](https://www.investopedia.com/articles/trading/06/stopplacement.asp)

タートルズのトレード手法としてロスカットラインは2ATRがよいという指針がある. 目安であり, 正解とは限らない.

上昇トレンドは上がったり下がったりしながらあがっていく, 直線的にあがっていくことは少ない(ノイズ). ノイズの外側にロスカットラインを設定するのがよい. ノイズを計測するための目安が2ATR.

---

-   ref.
    -   [チャネルブレイクアウト]({{< relref "20220918070939.md#f9358a31-b3b7-4553-bc27-6042aeaabe89" >}})
    -   [ATR]({{< relref "20220714213106.md#b90e8a26-ea2a-4770-aad6-cf717075f9fb" >}})


## 📍損切りパターンまとめ {#890fd8ec-de0b-4d1b-a679-04cc5836a9fa}

既存の損切り手法をまとめる. 自分で考えるよりもまずは先人の知恵を学び, 車輪の再発明を防ぎたい.


### ✅最良価格指定による指値注文で成行のように注文する(テイク注文) {#1fb3c88b-bca7-4748-b0a9-ede0e3192d78}

[価格優先の原則]({{< relref "20220918092649.md#fc6ecde3-992c-4c37-a919-7f8f2b2ebdaf" >}})というものがある. 板情報におけるマッチングアルゴリズム.

成行注文は反対方向のとマッチングされるため, 確実にマッチングさせるには指値の場合は反対側の[最良価格]({{< relref "20220918092153.md#4ea430bf-b0e3-47e3-85d7-51f6e2f888b7" >}})を指定する(もちろん市場は動くのでこれも確実ではない).

派生パターンとして, 買い指値の場合のbest bid/売り指値の場合のbest askを指定すると, これは板における先頭に自分の注文を並べる行為で, 最も優先してマッチングされる可能性がある.

または, [mid rate]({{< relref "20220918092153.md#d22e321c-5e72-4453-95da-a31a7d3b193d" >}})(best bid/askの平均)でもいい.

---

see also. [指値注文の4分類]({{< relref "20220918092649.md#ff6e49f1-2841-4c47-a14d-52fe042ff3bb" >}})


### 💡ストップリミットによる損切 {#bc9ca5}

成行注文で損切りよりも指値注文で損切りするほうが損失が少ないものの, 市場急変でそもそも指値による損切りが失敗することがある.

この指値と成行の両方の個性を活かす弁証法的解決方法としての[ストップリミット注文](#b46d5510-e230-4d6e-adea-270a6c4c6cd4)のようなロジックがいいと思った.


### 💡2ATRによる損切り {#a47fbc}

[ATR]({{< relref "20220714213106.md#b90e8a26-ea2a-4770-aad6-cf717075f9fb" >}})を損切りの指標にする.

2ATRで損切というのは, [ドンチャン・ブレイクアウト]({{< relref "20220717083642.md#12d5e557-375e-4445-b2ac-8a50fce77486" >}})で有名なタートルズの投資手法に由来して有名であるものの, 科学的根拠は不明.


### 💡トレーリングストップによる利確 {#bca30c29-77ec-4ae9-8075-95d82a5fb499}

トレンドフォローにおける[トレーリングストップ](#f647f4b3-2b1b-493a-9ecf-e8f444b9c5c6)を実装する.

-   [BitflyerFXの自動売買BOTにトレイリングストップを実装してみよう！](https://ryota-trade.com/?p=3019)
-   [BTCFXでパラボリックSARを使って加速するトレイリングストップを作ろう！](https://ryota-trade.com/?p=3659)
-   [pybottersとasyncioでinago flyer!｜pe｜note](https://note.com/clever_dahlia308/n/n2841ee8a9043)


## 利確損切Topics {#475065}

-   [take指値(スリッページを考慮した成行)]({{< relref "20220603152138.md#9aee5533-ab84-47db-9c35-7badf01cfaae" >}})


### 💡上手く損切りするか vs そもそも損切をしないか {#c0d636}

稼ぐためのビッグイシューは損切. 仕込みでもなく手仕舞いでもない. botで如何にして損失を防ぐかが稼ぐかにつながるのは一般的に言えること.

２つのサブイシューに分解できる.

-   損切り執行をうまくやる.
-   そもそも損切りが発生しないようにする.

うまく損切りを執行するよりそもそも損切りが発生しないようにしたほうが稼げるとか. なぜならばバックテストで上手く損切りできても実際のトレードでは上手く行かないことがおおい.

ref. [3年間、仮想通貨自動売買BOTを作って思うこと。｜愚者の戦略｜note](https://note.com/memoran_yukiblog/n/nccb5a874005c)


### 💡低リスクは成行注文, 慣れてきたら指値注文 {#43e8e6}

成行注文をすると素早く確実に約定することができるが, 不利な条件での約定となる. 一方, 指値注文のほうが有利や約定となるものの, そもそも約定が成立しない可能性かある.

この２つのトレードオフで指値と成行のどちらをつかうかを決める.


### ⚖損切りを執行時の指値注文と成行注文の比較 {#01699ae7-24d5-4dd3-92fe-83756cde573a}

セオリーとして以下のようなpros/consがある.

-   成行注文は必ず損切ができるものの, 指値よりも損失が大きくなる.
-   指値注文は成行注文よりも損失を少なくすることが出来るが, 指値をうまく指定しないとそもそも約定しない.

したがって初心者だったりうまい戦略がなければとりあえず成行で, 慣れてきたら指値というのもセオリー的アドバイス.

そしてイシューはどこで損切を判断して指値をどう指定するか, となる. 損切タイミングは[⚖損切りを執行するトリガーとなるストップ値比較](#1e5355db-6bc3-45be-8e0f-e556d9655e87)で議論することにして, ここでは指値をどうするかを考える.

---

買い指値の場合はbest askを指定すれば成行注文と同じことができる(成行とは最もマッチングしやすい気配値を選択する). ただし, これが上昇トレンドの場合はbest bidを指定しても刺さることはおおい. なぜならば, に注文中にbidが上昇してask相当に到達るので. 逆に下降トレンドだと刺さりにくい.

したがって, トレンド中の利確ならば, 指値は必ずしも最良価格ではなくその手前の有利な値でも刺さる. 損切は刺さらない.


### ⚖損切りを執行するトリガーとなるストップ値比較 {#1e5355db-6bc3-45be-8e0f-e556d9655e87}

例えば上昇トレンド時の買いポジションで売り注文のトリガー監視では, 以下の選択肢がある.

-   最良買い気配(best bid)
-   最良売り気配(best ask)
-   現在価格(最終約定価格)
-   市場価格(bid+askの平均)

成行注文で損切をする際に, 売り成行き(sell)はbest bidで約定するのでスピードを重視するならばbest bidを監視する.

---

一方, 一時的なスプレッドの拡大によって一時的にストップ値に引っかかって注文が走ってしまうリスクがある. これを避けるためにあえてbest bidではなくbest askを見る方法もある.

これの利点はスプレッドの一時的な拡大による損切を避けられる一方, 実際の損切でより不利な条件で約定する(askをトリガーにしてそれよりもspread分不利なbidが約定価格).

ref. [BID判定買（ASK判定売）逆指値注文とは？｜ヒロセ通商](https://hirose-fx.co.jp/category/order/025.html)

---

Web画面だったりアプリ画面では現在価格から評価損益を計算しているように見える(観測値, 元情報は現在探している). したがって直感的なわかりやすさの点では現在価格をみるのもよい. 明確なトレンド判断が出来ない場合は上下の上下の可能性はあり, したがって間を取った最終約定価格をみることは合理に叶う. もしくはbid/ask
中間値(current priceに対する market priceという, cf. [市場価格]({{< relref "20220918092153.md#b03f06f9-b52d-451d-ab43-ed538da82891" >}})).


## 🔗References {#3b90d2}


### Study & Papers {#ec90e2}

科学的根拠に基づいた損切りラインはあるのか?という話題.

-   [損切というリスク管理について - 辰巳健一(2018)](https://www.jsri.or.jp/publish/research/pdf/102/102_05.pdf)
    -   先行研究や投資の世界の評価の高い書籍での損切の議論は少ない.
    -   おれの考えた最強のうんぬんを分類してみた, という内容.
-   [The Science Behind Stop-Loss & Target Gain - Learn When to Exit a Position — Neuravest](https://neuravest.net/stop-loss-and-target-gain/)
-   [A Machine Learning Approach to Target Gain & Stop Loss - Learn When to Exit a Position](https://www.linkedin.com/pulse/machine-learning-approach-target-gain-stop-loss-learn-erez-katz?trk=pulse-article_more-articles_related-content-card)
    -   ATRベースの損切と強化学習による違うアプローチの紹介.
-   [When do stop-loss rules stop losses? - ScienceDirect](https://www.sciencedirect.com/science/article/abs/pii/S138641811300030X)
    -   <https://alo.mit.edu/wp-content/uploads/2015/06/1-s2.0-S138641811300030X-main.pdf>
-   [JRFM | Free Full-Text | Take Profit and Stop Loss Trading Strategies Comparison in Combination with an MACD Trading System | HTML](https://www.mdpi.com/1911-8074/11/3/56/htm)
