+++
title = "ğŸ“Clojure: ãƒ­ã‚®ãƒ³ã‚°(Logging)"
lastmod = 2022-08-19T14:18:08+09:00
tags = ["WIKI"]
draft = false
+++

-   up: [ğŸ“Clojure Product Development]({{< relref "20220211142329.md" >}})
-   tags. [ğŸ”–Logging]({{< relref "20220816070935.md" >}})


## Clojure Logging Overview {#0c579b}

Javaã®è³‡ç”£ã‚’ä½¿ã†ã‹å¦ã‹ãŒæ¡ç”¨ã®ãƒã‚¤ãƒ³ãƒˆã‹ãªï¼ŸJavaã®ãƒ­ã‚®ãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯æ­´å²ãŒã‚ã‚‹.

timbreã¯pure clojureã§ã¯ã‚ã‚‹ãŒ, ã‚„ã¯ã‚Šè¨­å®šä¾‹ã‚„ãƒã‚¦ãƒã‚¦ãŒGoogleæ¤œç´¢ã§è¦‹ã¤ã‹ã‚‹ã®ã¯, Javaãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¤šã„(logback).


## Clojure Logging Libraries {#9898b8}


### clojure.tools.logging {#72b25d3f-8637-4735-960b-c44af8418aa2}

clojure tools.logging libaryã§Javaã®è³‡ç”£ã‚’æ´»ç”¨.

-   official docs
    -   <https://github.com/clojure/tools.logging>
    -   <https://clojure.github.io/tools.logging/>

---

-   ref:
    -   [ğŸ–ŠLogbackã®ãƒ­ã‚°ã‚’è¦‹ã‚„ã™ãã™ã‚‹æ–¹æ³•(ãƒ•ã‚¡ã‚¤ãƒ«ã‚’grep, Lilith) | Futurismo](https://futurismo.biz/archives/6825/)
    -   [Quickly Set up Clojure Logging with the Right Library](https://spin.atomicobject.com/2015/05/11/clojure-logging/)
    -   [Clojure Log Configuration](https://www.solasistim.net/posts/clojure_log_configuration/)


#### ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã®ãƒ­ã‚®ãƒ³ã‚° {#bd211d}

é€šå¸¸ã¯ç¬¬ä¸€å¼•æ•°ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã„ã‚Œã‚‹ãŒ, ãƒãƒ«ãƒã‚¢ãƒªãƒ†ã‚£ã§ç¬¬ä¸€å¼•æ•°ã«Java, ä¾‹å¤–(Throwable), ç¬¬ï¼’å¼•æ•°ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¸¡ã™ã“ã¨ã‚‚å‡ºæ¥ã‚‹.

ã“ã®å ´åˆ, ãƒ­ã‚°ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¸‹ã«ãšã‚‰ãšã‚‰ã¨ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹. ãƒ­ã‚°ã®ã¿ã‚„ã™ã•ã¨ç›¸è«‡ã—ã¦ã¤ã‹ã†(Unknown/Unexpected Errorã¨ã‹).


#### unilog {#d25f6e}

clojure.tools.loggingã®è¨­å®šã‚’ã‹ã‚“ãŸã‚“ã«ã™ã‚‹. ãƒ­ã‚®ãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãã®ã‚‚ã®ã§ãªã„.

ref. <https://github.com/pyr/unilog>

-


### timbre {#c0af56ee-9d64-4846-9b1b-3f49881a3801}

Pure Clojure/Script logging library.

[GitHub - ptaoussanis/timbre: Pure Clojure/Script logging library](https://github.com/ptaoussanis/timbre)

[slf4j-timbre](https://github.com/fzakaria/slf4j-timbre) ã‚’ã¤ã‹ã†ã¨Javaã®ãƒ­ã‚®ãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨é€£æºå¯èƒ½.

æ—¥æœ¬ã®æ™‚åˆ»è¨­å®šä¾‹:

```clojure
(def timbre-config
  {:timestamp-opts
   {:pattern  "yyyy-MM-dd HH:mm:ss,SSS"
    :locale   (java.util.Locale. "ja_JP")
    :tiemzone (java.util.TimeZone/getTimeZone "Asia/Tokyo")}})
(timbre/merge-config! timbre-config)
```

ã¾ãŸç¾å®Ÿçš„ãªå•é¡Œç‚¹ã¨ã—ã¦, timbreã¯pure clojureã§ã¯ã‚ã‚‹ã‚‚ã®ã®, 3rd party libraryãŒjavaã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ä¾å­˜ã—ã¦ã„ã‚‹ã¨,ãã®åˆ¶å¾¡ã‚’timbreã‹ã‚‰ã¯ã§ããªã„(Javaã‹ã‚‰ç‹¬ç«‹ã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ©ç‚¹ãªã®ã§). ãã®ãŸã‚çµå±€ logback.xmlã‚’æ›¸ã‹ãªã„ã¨ã„ã‘ãªã„ã‹ã‚‚ã—ã‚Œãªã„.

<https://github.com/ptaoussanis/timbre/issues/138>

(ãªã‚“ã‹cider-nreplã¨ã®ç›¸æ€§ãªã®ã‹ CIDEEç’°å¢ƒã§errorãŒå‹•ä½œã—ãªã„. ã“ã‚Œã¯stderrã®æ‰±ã„ã‹ã‚‚ã—ã‚Œãªã„).

---

websocketãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®[sente]({{< relref "20220209102028.md#21f6271d-81ee-4219-86ce-c3a843e8e825" >}})ã¨åŒã˜ä½œè€….


### Cambium {#e746da}

better timbreã¨ã‹.

[Cambium Home - Structured logging for Clojure | Cambium](https://cambium-clojure.github.io/)


## âœ…Clojure Logging Tips {#f3bbe2}


### <span class="org-todo todo _">ğŸ’¡</span> tips: ã†ã‚‹ã•ã„ã‚µãƒ¼ãƒã®ãƒ­ã‚°ã‚’é»™ã‚‰ã›ã‚‹ {#e17301}

jetty serverã‚’èµ·å‹•ã—ãŸã‚Šclj-httpã‚’ä½¿ã†ã¨REPLã‚’ä¾µé£Ÿã™ã‚‹å•é¡Œ.

ä»¥ä¸‹ã¯logback.xmlã‚’è¨­å®šã™ã‚‹ä¾‹.

-   [Pedestalã®ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ãŒã†ã‚‹ã•ã„ã®ã§ã€é™ã‹ã«ã—ãŸ - ayato-p](https://scrapbox.io/ayato-p/Pedestal%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%83%AD%E3%82%B0%E3%81%8C%E3%81%86%E3%82%8B%E3%81%95%E3%81%84%E3%81%AE%E3%81%A7%E3%80%81%E9%9D%99%E3%81%8B%E3%81%AB%E3%81%97%E3%81%9F)
    -   <https://twitter.com/_ayato_p/status/1115059001459335168>
-   [Basic logging in Clojure web service not appearing on console - Stack Overflow](https://stackoverflow.com/questions/31371993/basic-logging-in-clojure-web-service-not-appearing-on-console)

timbre

-   [Noisy Netty logs show up after adopting this library Â· Issue #32 Â· fzakaria/slf4j-timbre Â· GitHub](https://github.com/fzakaria/slf4j-timbre/issues/32)

---

```clojure
{"org.apache.http" :error
 "io.netty"        :error}
```


### âœ…ãƒ­ã‚°è¡¨ç¤ºãŒUTCã§JSTã§ã¯ãªã„ {#52ec7a}

ã“ã®æ–¹æ³•ãŒæ­£ã—ã„ã®ã‹ã‚ã‹ã‚‰ãªã„ã‘ã©ã¨ã‚Šã‚ãˆãšç›´ã£ãŸã®ã§. ã•ãã‚‰ã‚µãƒ¼ãƒã‚’å€Ÿã‚Šã¦Clojureã„ã‚Œã¦clojure.tools.loggingã§ãƒ­ã‚°ã—ãŸã‚‰æ™‚åˆ»ãŒUTCã ã£ãŸ.

ã“ã‚Œã¯clojureã®èµ·å‹•ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§JVM_OPTã«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³, å…·ä½“çš„ã«ã¯"-Duser.timezone=Asia/Tokyo"ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§è§£æ±ºã—ãŸ.

deps.ednãªã‚‰aliasã®å®šç¾©ã®ãªã‹ã«ä»¥ä¸‹ã‚’è¿½åŠ ã™ã‚‹.

```clojure
{:jvm-opts    ["-Duser.timezone=Asia/Tokyo"]}
```

ãŸãŸã—ã•ãã‚‰ã‚µãƒ¼ãƒä»¥å¤–ã®ç’°å¢ƒã§ã¯å•é¡Œãªã„ã®ã§åŸå› ãŒã‚ˆãã‚ã‹ã‚‰ãªã„.


## <span class="org-todo todo _">ğŸ”—</span> References {#d95867}

-   [Clojureè¨˜äº‹ç´¹ä»‹<ç™¾æ—¥ä¿®è¡Œ>(3)ï¼šã€Œãƒ­ã‚°ã®åŸºæœ¬ã€ - æœ¬å½“ã¯æ€–ã„HPC](https://freak-da.hatenablog.com/entry/2015/12/07/215442)
-   [Clojure in production: Logging - Brownsofa](http://brownsofa.org/blog/2015/06/14/clojure-in-production-logging/)
