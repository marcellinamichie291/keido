+++
title = "ğŸ“Clojure: core.async"
lastmod = 2022-10-17T19:17:15+09:00
tags = ["WIKI", "Clojure"]
draft = false
+++

-   up: [ğŸ“Clojure: State and Concurrency]({{< relref "20220116191927.md" >}})


## ğŸ“Clojure: core.async {#a63165}

éåŒæœŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ãŸã‚ã®Clojureãƒ©ã‚¤ãƒ–ãƒ©ãƒª.

<https://github.com/clojure/core.async>

ç†è«–ã¨ã—ã¦ã¯[ğŸ“CSPãƒ¢ãƒ‡ãƒ«]({{< relref "20221008220000.md#8007a6cb-ec77-48c4-8dab-a14524ff57ef" >}})ã¨ã„ã†ã‚‚ã®ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹.

ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãªã‚‚ã®ã®, ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ãªã„ã®ã§è‡ªåˆ†ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦.

ãªã‚“ã‹ãƒãƒƒãƒˆã§æƒ…å ±ã‚’æ¤œç´¢ã—ã¦ã‚‚ã¾ã¨ã¾ã£ãŸæƒ…å ±ãŒãªã„ã®ã¯å°‘ã—æ•·å±…ãŒé«˜ã„. ä¸€å¿œãƒ¡ãƒ¢ã®ãŠã—ã‚Šã«å‚è€ƒãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã¯ã¾ã¨ã‚ãŸ.


### Basic Concepts {#b3e95d}

-   ãƒãƒ£ãƒãƒ«(channel): ä¸¦åˆ—ã«å‹•ãã‚¿ã‚¹ã‚¯é–“ã§å€¤ã‚’å—ã‘æ¸¡ã™é€šä¿¡è·¯
    -   ãƒãƒƒãƒ•ã‚¡ã‚’æŒã£ãŸã‚­ãƒ¥ãƒ¼ã®ã‚ˆã†ãªã‚‚ã®.
-   [è»½é‡ã‚¹ãƒ¬ãƒƒãƒ‰]({{< relref "20220116195030.md#0fbe2fc2-62bd-4c1c-8834-c6f211565542" >}})(å”èª¿ã‚¹ãƒ¬ãƒƒãƒ‰)
    -   ãƒãƒƒãƒ•ã‚¡sizeã«ã‚ˆã£ã¦ã‚¹ãƒ¬ãƒƒãƒ‰ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹è«–ç†ã‚¹ãƒ¬ãƒƒãƒ‰.
    -   åˆ‡ã‚Šæ›¿ã‚ã‚Šã‚’ãƒ‘ãƒ¼ã‚¯(parking)ã¨ã„ã†.
    -   åˆ‡ã‚Šæ›¿ã‚ã‚‰ãªã„ã®ã‚’ãƒ–ãƒ­ãƒƒã‚¯(Blocking)ã¨ã„ã†.
    -   [ğŸ’¡parkingã¨ã„ã†è»½é‡ã‚¹ãƒ¬ãƒƒãƒ‰ã®æ¦‚å¿µ](#7ba1c4a5-87b4-4ead-b9b9-0b1a063a31e2)


### Basic Syntax(API) {#c78c0b}

-   chan: channelç”Ÿæˆ
-   goãƒã‚¯ãƒ­: éåŒæœŸãƒ–ãƒ­ãƒƒã‚¯ç”Ÿæˆ
    -   go-loop: goã¨loopã®ç³–è¡£æ§‹æ–‡ãƒã‚¯ãƒ­.
        -   recurã¨åˆã‚ã›ã¦åˆ©ç”¨ã™ã‚‹ãŒrecurã¯Clojureæ¨™æº–é–¢æ•°.
-   é€ä¿¡
    -   >!: channelã«éåŒæœŸã§æ›¸ã
    -   >!!: channelã«åŒæœŸã§æ›¸ã
-   å—ä¿¡
    -   <!: channelã‚’éåŒæœŸã§èª­ã‚€
    -   <!!: channelã‚’åŒæœŸã§èª­ã‚€
-   å¾…æ©Ÿ
    -   alts!: è¤‡æ•°ãƒãƒ£ãƒãƒ«ã‹ã‚‰éåŒæœŸå‡¦ç†ã§æ—©ã„è€…å‹ã¡ã§ä¸¦è¡Œã§å¾…æ©Ÿã™ã‚‹.


### ãƒãƒ£ãƒãƒ«é€£æº {#61889f}

ã‚ˆã, å°ã•ãªãƒãƒ£ãƒãƒ«ã‚’ãƒ¬ã‚´ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚ˆã†ã«ãã£ã¤ã‘ã‚‹ã¨ã„ã†æ¯”å–©ãŒä½¿ã‚ã‚Œã‚‹. ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ç†è§£ã—ãŸã„. ãƒ¬ã‚´ãƒ–ãƒ­ãƒƒã‚¯ã¨ã„ã†ã‚ˆã‚Šãƒ—ãƒ©ãƒ¬ãƒ¼ãƒ«ã‹ãª?

-   pipe: ä¸€å¯¾ä¸€
-   mult/tap: ä¸€å¯¾å¤š
-   pub/sub: ä¸€å¯¾å¤š
-   mix/admin: å¤šå¯¾ä¸€


#### core.async: mult/tap {#7ffcda}

multã¯multipleã®ç•¥.

é€šå¸¸ãƒãƒ£ãƒãƒ«ã«å…¥ã£ãŸå€¤ã¯ä¸€ã¤ã®å‡ºå£ã—ã‹å–ã‚Šå‡ºã›ãªã„. multã‚’ã™ã‚‹ã¨, è¤‡æ•°å–ã‚Šå‡ºã›ã‚‹ã‚ˆã†ã«ãªã‚‹ãŒ, å–ã‚Šå‡ºã›ã‚‹å‡ºå£ã‚’æŒ‡å®šã™ã‚‹ã«ã¯tapã‚’ã¤ã‹ã£ã¦ãƒãƒ£ãƒãƒ«ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹.

-   [mult - clojure.core.async | ClojureDocs - Community-Powered Clojure Documentation and Examples](https://clojuredocs.org/clojure.core.async/mult)


#### core.async: pub/sub {#7c997455-af40-4663-b841-7b0e6f39ec19}

pubã¯(pub)licationã®ç•¥, subã¯(sub)scriptionã®ç•¥.

ã„ã‚ã‚†ã‚‹Pub/Subãƒ‘ã‚¿ãƒ¼ãƒ³. core.asyncã®channelã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æŒ™å‹•ã¯producer-comsumerãƒ‘ã‚¿ãƒ¼ãƒ³ãªã®ã§, [ğŸ’¡Pub/Subãƒ‘ã‚¿ãƒ¼ãƒ³ã¨Prod/Consãƒ‘ã‚¿ãƒ¼ãƒ³ã®é•ã„]({{< relref "20220116195030.md#a4997d2e-3c93-462a-90dc-37eab14f961b" >}})ã‚’æ„è­˜ã—ãŸã„. pub/subãƒ¡ã‚½ãƒƒãƒ‰ã‚ˆã£ã¦æ©Ÿèƒ½æ‹¡å¼µã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸.

[ğŸ¤”pub/subã¯multimethodã®éåŒæœŸé€²åŒ–ç³»?!](#97f0d153-506e-431c-aa70-8ef06db36ef1)

---

-   [Pub Sub Â· clojure/core.async Wiki Â· GitHub](https://github.com/clojure/core.async/wiki/Pub-Sub)
-   [pub - clojure.core.async | ClojureDocs - Community-Powered Clojure Documentation and Examples](https://clojuredocs.org/clojure.core.async/pub)
-   [Clojure core.async Pub/Sub Example (with callbacks) Â· GitHub](https://gist.github.com/oubiwann/d281477454b4e9aedd162d46439ce3ac)


#### examples {#bfebe3}

[ã‚„ã¯ã‚Šä¿ºã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆç®¡ç†ã¯ã¾ã¡ãŒã£ã¦ã„ã‚‹ã€‚](https://zenn.dev/s_karuta/articles/097f96079c888b)

å•é¡Œè¨­å®šãŒã‚·ãƒ³ãƒ—ãƒ«ã‹ã¤, ã‚ˆã„äº‹ä¾‹. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã®IOã‚’core.asyncã§è§£æ±º.


### ãƒãƒƒãƒ•ã‚¡åˆ¶å¾¡ {#c9d66c}

bufferã¯æœ‰é™ã‚µã‚¤ã‚ºã®ã‚­ãƒ¥ãƒ¼ã®ã‚ˆã†ãªã‚‚ã®ãªã®ã§, ã„ã£ã±ã„ã«ãªã£ãŸã¨ãã®åˆ¶å¾¡ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹.

-   dropping-buffer
    -   ã„ã£ã±ã„ã«ãªã£ãŸã‚‰è¿½åŠ ã—ã‚ˆã†ã¨ã—ãŸå€¤ã‚’åˆ‡æ¨ã¦
-   sliding-buffer
    -   ã„ã£ã±ã„ã«ãªã£ãŸã‚‰æœ€åˆã«è¿½åŠ ã—ãŸå€¤ã‚’åˆ‡æ¨ã¦


## core.async Topics {#df3878}


### ğŸ’¡put!/take!ã¨<!/>!ã®é•ã„ {#15797d}

Asynchronously puts a val into port, calling fn1 (if supplied) when complete.

ref. [put! - clojure.core.async | ClojureDocs](https://clojuredocs.org/clojure.core.async/put!)

go-blockã®ä¸­ã§å‘¼ã¶æ¡ä»¶ã¯ãªã, ã•ã‚‰ã«callbacké–¢æ•°ã‚’è¨­å®šã§ãã‚‹.

ref. [Clojure - Go Block Best Practices](https://clojure.org/guides/core_async_go)

best practiceã¨ã—ã¦put!ã‚’æ¨å¥¨ã—ã¦ã„ã‚‹?


### ğŸ’¡parkingã¨ã„ã†è»½é‡ã‚¹ãƒ¬ãƒƒãƒ‰ã®æ¦‚å¿µ {#7ba1c4a5-87b4-4ead-b9b9-0b1a063a31e2}

[ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°]({{< relref "20220802090757.md#2244d84a-60f9-4793-a0d6-b3b28936c317" >}})(blocking)ã¯ã‚ˆãããæ¦‚å¿µã ãŒ, core.asyncã§ã¯ãã®å¯¾æ¦‚å¿µã¨ã—ã¦Parking(å¾…æ©Ÿ)ã¨ã„ã†æ¦‚å¿µãŒã§ã¦ãã‚‹. ã“ã‚Œã¯, channelèª­ã¿æ›¸ãå‡ºæ¥ãªã„å ´åˆã¯ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’è§£æ”¾ã—ã¦æ­¢ã¾ã£ã¦ã„ã‚‹ã¨ã„ã†çŠ¶æ…‹.

core.asyncã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹çš„ã«ã¯ <!, >!ãŒéåŒæœŸèª­ã¿æ›¸ãã®parkingå¾…æ©Ÿ, >!!, <!!ãŒåŒæœŸèª­ã¿æ›¸ãã®blockingå¾…æ©Ÿã«ãªã‚‹.

ä»¥ä¸‹ã®è¨˜äº‹ã®(Blocking and Parking)ã¯ã‚ã‹ã‚Šã‚„ã™ã„èª¬æ˜.

<https://www.braveclojure.com/core-async/>


### ğŸ’¡å…¨ã¦ã®channelã®çµæœã‚’å¾…ã¡åˆã‚ã›ã‚‹ã«ã¯? {#64536e}

alts!/alts!!ã¯ã„ãšã‚Œã‹ã®ãƒãƒ£ãƒãƒ«ã®åˆ°ç€ã‚’å¾…ã¡åˆã‚ã›ã¦æ—©ã„ã‚‚ã®ãŒã¡ã§å‡¦ç†ã™ã‚‹.

éåŒæœŸå‡¦ç†ãŒå…¨ã¦çµ‚äº†ã™ã‚‹ã¾ã§ä¸¦è¡Œã§å¾…æ©Ÿã™ã‚‹ã«ã¯mapvã‚’ã¤ã‹ã†.

```clojure
(mapv #(async/<!! %) channels)
```

[clojure - Waiting for n channels with core.async - Stack Overflow](https://stackoverflow.com/questions/31858846/waiting-for-n-channels-with-core-async)


### ğŸ’¡core.asyncã¯Go Langã®channelã®Clojureç‰ˆ {#a52a6f}

Goã§ã„ã†channelã®æ¦‚å¿µã‚‰ã—ã„ãŒ, Go ã‚’çŸ¥ã‚‰ãªã„ã®ã§ãƒ”ãƒ³ã¨ã“ãªã„.

ãŸã , Goã¨ä¸¦è¡Œå‡¦ç†ã«ã¤ã„ã¦ã®æƒ…å ±ã¯Clojureã‚ˆã‚Šã‚‚æ¤œç´¢ã§å¤šãã¿ã¤ã‹ã‚‹(ã¨ãã«æ—¥æœ¬èª)ã®ã§, å‚è€ƒã«ãªã‚‹.

-   [Goã§ã®ä¸¦è¡Œå‡¦ç†ã‚’å¾¹åº•è§£å‰–ï¼](https://zenn.dev/hsaki/books/golang-concurrency)
    -   [ä¸¦è¡Œå‡¦ç†ã¨ä¸¦åˆ—å‡¦ç†ï½œGoã§ã®ä¸¦è¡Œå‡¦ç†ã‚’å¾¹åº•è§£å‰–ï¼](https://zenn.dev/hsaki/books/golang-concurrency/viewer/term)
-   [Concurrency is not parallelism - The Go Programming Language](https://go.dev/blog/waza-talk)


### ğŸ’¡reloadable core.async {#23f6240b-8243-48e8-91d9-2581806dfa36}

[Reloaded Workflow]({{< relref "20220117205249.md#7e942a1e-481a-4f5d-8c0d-1edd44da93df" >}})ã‚’core.asyncã¨çµ„ã¿åˆã‚ã›ã‚ˆã†ã¨ã—ãŸæ™‚, é–‰ã˜ãŸãƒãƒ£ãƒãƒ«ã‹ã‚‰loopãŒç„¡é™ã«nilã‚’å–ã‚Šå‡ºã—ç¶šã‘ã‚‹ã“ã¨ã‚’å›é¿ã™ã‚‹.

-   [Reloadable core.async code](http://blog.sandipan.net/clojure/2015/07/25/reloadable-core-async.html)
-   [ãƒªãƒ­ãƒ¼ãƒ€ãƒ–ãƒ« core.async - ayato-p](https://scrapbox.io/ayato-p/%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%80%E3%83%96%E3%83%AB_core.async)

---

ãƒãƒªã‚¢ãƒŠæµ·æºã‚ˆã‚Šãƒ‹ãƒƒãƒã™ãã‚‹è½ã¨ã—ç©´ã‹ã‚‚ã—ã‚Œãªã„ãŒ, Emacs CIDERã§integrant.repl ã¨async/go-loopã‚’é€£æºã•ã›ãŸã¨ãã«æ¨™æº–å‡ºåŠ›ãŒREPLã«è¡¨ç¤ºã•ã‚Œãªã‹ã£ãŸ.

ã„ã‚ã„ã‚èª¿ã¹ãŸã‚‰ã“ã‚Œã¯CIDERãŒæ‚ªãã†. core.asyncé–¢ä¿‚ãªã„ã˜ã‚ƒãªã„ã‹... ã¨ãƒãƒã£ã¦ãƒ–ãƒåˆ‡ã‚Œã¦ã„ã‚‹èª°ã‹ã®ãŸã‚ã®ãƒ¡ãƒ¢.

[ğŸ’¡cider-ns-refresh-show-logã®ãƒ¯ãƒŠ]({{< relref "20220531084041.md#254827a1-89b8-487c-be2a-7458a01c8407" >}})


### ğŸ’¡æ€§èƒ½ã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ãŒCPUãƒã‚¦ãƒ³ãƒ‰ã‹IOãƒã‚¦ãƒ³ãƒ‰ã‹ {#08a59092-35e5-47a2-8361-84a1b25f283f}

-   [Clojureã®ã„ã‚ã‚“ãªä¸¦è¡Œå‡¦ç†ã®ä½¿ã„åˆ†ã‘ - ç´™ç®±](https://boxofpapers.hatenablog.com/entry/clojure-concurrent)
-   [concurrency - Clojure: future, agent or core.async for IO - Stack Overflow](https://stackoverflow.com/questions/45619969/clojure-future-agent-or-core-async-for-io)

ã“ã®ã¸ã‚“ã®è­°è«–ã¯Goã®goroutineã§æ¤œç´¢ã‚’ã‹ã‘ã¦ã‚‚ã„ã„ã‹ã‚‚. Clojureã‚ˆã‚Šã‚‚æƒ…å ±ãŒåœ§å€’çš„ã«å¤šã„.

-   [åŸç†åŸå‰‡ã‹ã‚‰é©åˆ‡ãªgoroutineã®æ•°ã‚’è€ƒãˆã‚‹](https://zenn.dev/imamura_sh/articles/goroutine-29492669efb6aef33306)

ã—ã£ã‹ã‚Šã‚„ã‚‹ãªã‚‰ã°, è¨ˆæ¸¬ã—ã¦å®Ÿé¨“ã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚‹.


### ğŸ’¡atomã®çŠ¶æ…‹ã‚’core.asyncã§update {#869f75}

æ­£ã—ã„æ–¹æ³•ã‹ã‚ã‹ã‚‰ãªã„ã‘ã©ã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ¡ãƒ¢.

<https://github.com/weissjeffm/gdax-bot/blob/master/src/coinbase_api/core.clj#L61>

```clojure
(defn keep-current-price-updated [match-ch price-atom]
  (a/go-loop []
    (when-let [match (a/<! match-ch)]
      (swap! price-atom assoc (:product_id match)
             (-> match :price read-string))
      (recur))))
```

å¼•æ•°ã¨ã—ã¦atomã¨channelã‚’ã‚‚ã‚‰ã£ã¦, channelã‹ã‚‰æ–°ã—ã„å€¤ãŒåˆ°ç€ã™ã‚‹ãŸã³ã«atomã‚’updateã™ã‚‹. ã“ã†ã„ã†å°ã•ãªupdateå‡¦ç†ãŒgo-loopã§ä½œæˆã—ãŸè»½é‡ã‚¹ãƒ¬ãƒƒãƒ‰ã§CPUãŒæš‡ãªã¨ãã«å®Ÿè¡Œã§ãã‚‹ã®ã¯ã„ã„ã‹ã‚‚ã—ã‚Œãªã„.

ã¾ãŸatomã‚„channelã®å—å–ã¯integrantã¨ã‹ã«é€£æºã‚’ã¾ã‹ã›ã¦ã‚‚ã„ã„ã‹ã‚‚ã—ã‚Œãªã„.

[Clojure: agent]({{< relref "20220116191927.md#6af7597c-b0f6-4fcc-a6b3-4a7db9c064e5" >}}) ãŒatomã‚ˆã‚Šã‚‚é©ã—ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ãŒã©ã†ãªã‚“ã ã‚ã†. atomã¨agentã®é•ã„ã¯æ›´æ–°ãŒåŒæœŸã‹éåŒæœŸã‹ã¨ã„ã†é•ã„ãŒã‚ã‚‹. ã—ã‹ã—go-blockã®ãªã‹ã§ã¯æ›´æ–°ã‚’ã‚­ãƒƒã‚¯ã™ã‚‹ã‹ã©ã†ã‹ãŒéåŒæœŸãªã®ã§, ãã®å…ˆã®åŒæœŸ/éåŒæœŸã¯ãã“ã¾ã§å•é¡Œã§ã¯ãªã„ã‹ã‚‚ã—ã‚Œãªã„ã—éåŒæœŸå‡¦ç†ã®å»¶é•·ã®åŒæœŸã¨ã„ã†æ„å‘³ã§atomãŒã„ã„ã®ã‹ã‚‚. go-blockã‚’ã¤ã‹ã‚ãªã„ãªã‚‰ã°agentã‚‚æ¤œè¨ã®ä½™åœ°ã‚ã‚Š.


## core.async Insights {#333324}


### ğŸ¤”(async/chan 1)ã¨ã¯bufferingã—ãªã„ã¨ã„ã†ã“ã¨ {#1dd903}

chanã®ã‚µã‚¤ã‚ºã‚’å¼•æ•°ã§æŒ‡å®šã§ãã‚‹ãŒ, ã“ã‚ŒãŒsize=1ã¨ã„ã†ã“ã¨ã¯ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã—ãªã„ã¨ã„ã†ã“ã¨ã‚’æ„å‘³ã™ã‚‹.


### ğŸ¤”channel closed?ã‚’ç¢ºèªã™ã‚‹ã«ã¯ {#c51055}

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒãªã„éš ã—æ©Ÿèƒ½ãªã®ã§ã“ã‚ŒãŒæ­£ã—ã„ã®ã‹ã¯ã‚ã‹ã‚‰ãªã„.

```clojure
@(.closed ch)
```


### ğŸ¤”producer-consumer patternã¨core.async {#b2f50c}

ã‚ãŸã—ã®æ‹™ã„è¨˜æ†¶ã ã¨, éåŒæœŸå‡¦ç†ã‚’Java ã‚„Pythonã§ã†ã¾ãå‡¦ç†ã™ã‚‹ã«ã¯, åŒæœŸã‚­ãƒ¥ãƒ¼ã‚’ç”¨ã„ãŸ[Producer-Consumer Pattern]({{< relref "20220116195030.md#1e0ae462-5cdf-45d2-82de-ef3587583ff1" >}})ã‚’ã¤ã‹ã†ã®ãŒé‰„æ¿ã ãŒ, ãã‚Œã‚’core.asyncã‚’ã¤ã‹ã†ã“ã¨ã«ã‚ˆã£ã¦ã‹ã‚“ãŸã‚“ã«å®Ÿè£…ã§ãã‚‹(ç´ æ™´ã‚‰ã—ã„).

---

ä¸€å¿œéå»è¨˜äº‹ã‚’ã¿ã‚‹ã¨å…±æœ‰ãƒ¡ãƒ¢ãƒªæ–¹å¼ã§ã¯ãªã[ğŸ“æ±ºå®šæ€§ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ãƒ¢ãƒ‡ãƒ«]({{< relref "20221008195738.md" >}})?(å¿˜ã‚ŒãŸ).

-   refs
    -   [ğŸ–ŠJava ã§ Producer-Consumer Pattern ã‚’å®Ÿè£…ã—ã¦ã¿ãŸ | Futurismo](https://futurismo.biz/archives/2656/)
    -   [ğŸ–Šãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å¤‰æ•° (Oz) ã§å®Ÿç¾ã™ã‚‹ Producer-Consumer Pattern | Futurismo](https://futurismo.biz/archives/2829/)

---

2010å¹´ã®ã¾ã , core.asyncãŒãªã‹ã£ãŸæ™‚ä»£ã«blocking queueã§channelã®æ¦‚å¿µã‚’å®Ÿè£…ã—ãŸã¨ã„ã†è¨˜äº‹.

[Channels in Clojure Â· Dave Jack](https://www.vidston.com/post/channels-in-clojure/)


### ğŸ¤”core.asyncã«ãŠã‘ã‚‹ç™»å ´äººç‰©ã¯æœ«å°¾å†å¸°ã™ã‚‹ãªã«ã‹ {#c4fcbe}

ä¸¦è¡Œãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®èª²é¡Œã¯è¤‡æ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒå”èª¿ã—ãªãŒã‚‰éåŒæœŸã§ã‚„ã‚Šå–ã‚Šã™ã‚‹ä»•çµ„ã¿ãŒã‚¤ã‚·ãƒ¥ãƒ¼ã¨ãªã‚‹.

ã—ã‹ã—, Clojureã®, ã•ã‚‰ã«ã„ãˆã°core.asyncã®è©±é¡Œã®ãªã‹ã§ã¯Threadã¯æœ¬ç‰©ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã¯ãªã, [è»½é‡ã‚¹ãƒ¬ãƒƒãƒ‰]({{< relref "20220116195030.md#0fbe2fc2-62bd-4c1c-8834-c6f211565542" >}})ã¨ã„ã†ã‚‚ã®ã«ãªã‚‹. ã“ã‚Œã¯Threadã¨ã¯ã¡ã‚‡ã£ã¨é•ã†while-loopã™ã‚‹ãªã«ã‹.

```clojure
(async/go-loop []
  (do-something!)
  (recur))
```

ãã†ã™ã‚‹ã¨, ä»Šã¾ã§ä¸¦åˆ—ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°=ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã ã¨æ€ã£ã¦ã„ãŸè‡ªåˆ†ã®ä¸­ã®æ€ã„è¾¼ã¿ãŒç ´ã‚Œã‚‹ã“ã¨ã«ãªã‚‹. ã“ã‚Œã¯ã“ã‚Œã§é¢ç™½ã„ã“ã¨ã .

loopã™ã‚‹ãªã«ã‹ã‚’æ·±å €ã‚Šã—ã¦ã„ããŸã„.


### ğŸ¤”pub/subã¯multimethodã®éåŒæœŸé€²åŒ–ç³»?! {#97f0d153-506e-431c-aa70-8ef06db36ef1}

[Clojure: pub/sub](#7c997455-af40-4663-b841-7b0e6f39ec19)

pubã®é–¢æ•°å‘¼ã³å‡ºã—ã«ãŠã„ã¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒä½¿ã‚ã‚Œã‚‹ã®ãŒæ··ä¹±ã™ã‚‹. ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®å®Ÿä½“ã¯é–¢æ•°ã§ã‚ã‚‹. (get m :key)ã®çœç•¥è¡¨ç¾. ãã—ã¦subã®é–¢æ•°ã®å¼•æ•°ã¯ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰.

-   (pub ch topic-fn)
-   (sub p topic ch)

ã“ã®ã‚„ã‚„ã“ã—ã•ã¯ã©ã“ã‹ã§çµŒé¨“ã—ã¦ã„ã‚‹. [Clojure ãƒãƒ«ãƒãƒ¡ã‚½ãƒƒãƒ‰]({{< relref "20220506155825.md" >}})ã®defmultiã¨defmethodã®é–¢ä¿‚ã«ã¨ã¦ã‚‚ä¼¼ã¦ã„ã‚‹ã“ã¨ã«æ°—ã¥ã„ãŸ.

ã‚‚ã£ã¨è¦‹æ–¹ã‚’ã‹ãˆã¦ã—ã¾ãˆã°, ã‚‚ã¯ã‚„pub/subã¯ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã®éåŒæœŸã®é€²åŒ–ç³»ã§ã‚ã‚‹. ã•ã‚‰ã«ã„ãˆã°, multimethodã¨ã¯æ¡ä»¶åˆ†å²ã‚’ã‚¯ãƒ¼ãƒ«ã«é€²åŒ–ã•ã›ãŸè¦‹æ–¹ãŒã‚ã‚‹ã®ã§, pub/subã¨ã¯æ¡ä»¶åˆ†å²ã‚’ã‚¯ãƒ¼ãƒ«ã«éåŒæœŸåŒ–ã—ãŸã‚‚ã®ã¨è¦‹ãˆã‚‹.


### channelã¯multã—ãªã„ã¨ä¸€ã¤ã®æƒ…å ±ã¯ä¸€ã¤ã—ã‹å–ã‚Šå‡ºã›ãªã„ {#671925}

ã“ã‚Œã‚‰ã‚’ä¸¡æ–¹è©•ä¾¡ã—ãŸã‚ã¨ã«REPLã‹ã‚‰channelã«å€¤ã‚’å…¥ã‚Œã‚‹ã¨, äº¤äº’ã«å‹•ã.

```clojure
(a/go-loop [] (prn (a/<! in-ch)) (recur))
(a/go-loop [] (println (a/<! in-ch)) (recur))
```


### REPLã§åŒæœŸé€ä¿¡ãŒãƒãƒ³ã‚°ã—ãŸã¨ãã®å›é¿æ–¹æ³• {#ad7e1e}

Emacs é™å®š?? a/>!!ã§ãƒãƒ³ã‚°ã—ãŸã¨ãã®å›é¿æ–¹æ³•ã¯ã“ã¡ã‚‰.

[âœ…REPLã§ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’è©•ä¾¡ã—ã¦ãƒãƒ³ã‚°ã‹ã‚‰ã®å¾©æ—§(cider-interrupt)]({{< relref "20220316151158.md#e76d70b4-445d-432a-a3ed-b43b19d5971a" >}})


## ğŸ”—Refenreces {#ec4e12}


### Online {#54f664}

-   [Clojure + core.async ã«ã‚ˆã‚‹éåŒæœŸï¼†ä¸¦åˆ—ãƒ—ãƒ­ã‚»ã‚¹ã®ä¸–ç•Œ - ç´™ç®±](https://boxofpapers.hatenablog.com/entry/core_async)
    -   [t_yano]({{< relref "20220216154041.md#9b47d9a7-ef98-4225-8f20-8ebd91001e11" >}})ã•ã‚“ã«ã‚ˆã‚‹æ—¥æœ¬èªã«ã‚ˆã‚‹ã‚ã‹ã‚Šã‚„ã™ã„èª¬æ˜è¨˜äº‹.
    -   [ğŸ“Clojure Transducer]({{< relref "20220331203002.md" >}})ã¨pipelineã¨ã®ã‚³ãƒ©ãƒœæŠ€ã¨ã‹ã‚‚.
-   [ãµã¤ã†ã®core.async](https://www.slideshare.net/tsutomuyano/coreasync-100376704)
    -   ã“ã®è³‡æ–™ã‚‚å¤§å¤‰ã‚ã‹ã‚Šã‚„ã™ã„.
-   [å…¥é–€core.async](https://www.slideshare.net/sohta/coreasync)
-   [Intro to Core Async | Lesson 25 | Learn ClojureScript](https://www.learn-clojurescript.com/section-4/lesson-25-intro-to-core-async/)
-   clojure.org
    -   [Clojure - Clojure core.async Channels](https://clojure.org/news/2013/06/28/clojure-clore-async-channels)
    -   [Clojure - Go Block Best Practices](https://clojure.org/guides/core_async_go)
-   [Introduction to Asynchronous Programming in Clojure | BradCypert.com | Programming Tutorials and Resources](https://www.bradcypert.com/clojure-async/)


### Books {#6225eb}

ã‚ãŸã—ãŒæ„›èª­ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°Clojureã«ã¯core.asyncã®è©±é¡Œã¯è¼‰ã£ã¦ãªã„, Joy of Clojureã«ã‚‚..

-   [Mastering Concurrent Processes with core.async | Clojure for the Brave and True](https://www.braveclojure.com/core-async/)
-   [ğŸ“šLiving Clojure - Carin Meier(2015)]({{< relref "20220113152023.md" >}})
    -   chanpter6ã«ã¡ã‚‡ã‚ã£ã¨åŸºç¤ãŒã®ã£ã¦ã„ã‚‹.


### Movies {#80662e}

-   ["Clojure core.async" by Rich Hickey (2013) - YouTube](https://www.youtube.com/watch?v=yJxFPoxqzWE)
    -   Rich Hickeyã«ã‚ˆã‚‹core.asyncã®ç´¹ä»‹
-   [LispCast Clojure core.async: Channels - YouTube](https://www.youtube.com/watch?v=msv8Fvtd6YQ)
    -   [ğŸ‘¨Eric Normand]({{< relref "20220324214106.md" >}})ã«ã‚ˆã‚‹è¬ã®4åˆ†ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‹•ç”».
-   [#17 å¤§å…ˆè¼©Clojurianã®çŸ¢é‡ã•ã‚“ (@t_yano)ã«Uzabaseç¤¾ã‚„core.asyncã®ãƒ‡ã‚£ãƒ¼ãƒ—ãªè©±ã‚’ã—ã¦ã‚‚ã‚‰ã£ãŸ #YCTFC #clojure - YouTube](https://www.youtube.com/watch?v=xQxio0uTDNA)


## See also {#611114}

-   [ğŸ“Clojure: Transducer]({{< relref "20220331203002.md" >}})
-   [ğŸ“Clojure: Manifold]({{< relref "20221013151243.md" >}})
