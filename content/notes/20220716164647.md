+++
title = "📝mmbot"
lastmod = 2022-11-03T10:48:50+09:00
tags = ["WIKI"]
draft = false
+++

-   tags: [🔖仮想通貨Bot戦略]({{< relref "20220603152138.md#73d718cb-a2fb-4add-8d46-41485ffc4db1" >}})
-   refs.
    -   [📝bitFlyer]({{< relref "20220719113407.md" >}})
    -   [📝マーケットメイク]({{< relref "20220716165800.md" >}})
    -   [📝流動性マイニング]({{< relref "20221002143806.md" >}})


## 📝mmbotとは {#584736}

market making bot. [📝マーケットメイク]({{< relref "20220716165800.md" >}})戦略を[📝仮想通貨Bot]({{< relref "20220603152137.md" >}})に適用.

ネット記事やTwitterでは[📝高頻度bot]({{< relref "20220716131618.md" >}})はmmbotの意味で使われていることが多いがmmbotは高頻度botの部分であり全てではないことに注意. ただ検索ワードとしてはmmbotの代替としてつかってもいいかも.

mmbotは日本語でしか情報はでてこない. 英語だとcrypto market making bot. 元々マーケットメイクは株での[HFT]({{< relref "20220916104417.md" >}})の文脈で注目されてきた. botという個人がやるような話題はcryptoに特有な印象がある.

このメモでの表記もmmbotにしておく. 正解はないけど, mmbotが多い印象.


### mmbotの特徴 {#10556b}

初心者には優しい.

-   pros.
    -   リスクが少なくコツコツ稼げる.
    -   少資金から高い利回りを達成できる.
-   cons.
    -   ある程度稼げるとスケールしない.
    -   複利運用ができない([高頻度取引の限界](#71241834-e7d7-4075-8714-87659a971b0e)).
    -   取引手数料無料かつtakerが多い環境でしか利益を上げづらい戦略.

市場選びがとても重要. 稼げない市場では稼げない. bitFlyerが特に有名なのはmmbotの特徴によるかも.


### mmbot戦略 概要 {#38436e}

既存戦略は大きく分けて２つに分類できる.

-   [📍mmbot: Optimal Spread予測](#3678dded-21c0-4333-bec1-4b5ea00e924b)
-   [📍mmbot: トレンド対策](#1d660725-713d-4fa7-90af-a912d2061098)

つまり利益を最大化させるイシューと損失を最小化するイシューの2つ.

トレンド対策はさらに[📝在庫リスク]({{< relref "20220716193437.md#d191db6d-8c37-4acd-9945-9c6a6a1a8cfe" >}})と[📝逆選択リスク]({{< relref "20220716193437.md#a36e3243-909b-4e1a-b2b1-bce06eb2ab60" >}})の２つに分解できる.


### 💡mmbotはレンジに強くトレンドに弱い {#937b3c1b-a62d-4b3b-91ad-316155798649}

傾向としてレンジ相場に強く, トレンド相場に弱い. そこはそもそも[📝マーケットメイク]({{< relref "20220716165800.md" >}})がどうやって利益を上げるかということに関わっている.

基本的にはレンジ相場において価格が上がったり下がったりするのを想定して指値を指し続ける[📝レンジ・トレーディング]({{< relref "20220918070939.md#dda08df8-fab3-4a9e-a608-b8e850d663fb" >}})と似た考えで利益を上げる. しかしいったんトレンドが発生するとその前提が崩れるため, 不利な条件でポジションを解消しないといけない(ref. [📍逆選択リスク対応](#1d660725-713d-4fa7-90af-a912d2061098)).


### 💡mmbotの収益源がマーケットメイクでない? {#660b6b3f-f00b-4657-83f7-dc4f6173e9cb}

マーケットメイク自体が悪いというわけではなく, 同じようなアルゴリズムが大量に板で動いているとき.

仮にこの仮説が真であるなら, 取り組むべきイシューの方向性は大きく変わる. そしてこの事実はmmbotのmmがマーケットメイクなため, このアルゴリズムに従えば理論的には利益が積み上がっていくに違いないという見方の裏に隠れていた真実かもしれない.

[💡高頻度取引の損益 はスプレッド損益とポジション損益]({{< relref "20220916104417.md#d396cdef-0320-4fa0-a505-f09b215f5afe" >}})でありさらに5秒を超えると価格が下がるリスクがあるという研究結果もあり, もうマーケットメイクで確実な利益を狙えるのは5秒でその後はトレンドが起こるリスクを想定しつつ手仕舞い戦略を考える必要がある.

---

ref. <https://twitter.com/masao_FX/status/1018791703346495488>

> 利益出せるMMbotが販売されているわけないだろ……

---

ref. <https://twitter.com/blog_uki/status/1002344718972272640>

> mmbotが流行り始めてるけどフィーが貰えると言っても何かエッジを積んでないと絶対にいつか破綻する。それも含めて市場は効率化している。mmbotのエッジとは、①短期的な値動きの予測力、②指値の位置の統計的優位性。特に②は他のメイカーのロス(損失とういか不合理性)が自分の収益に転換される。

---

ref. [【bitFlyer - LightningFX】アルゴリズム高頻度取引mmbotの作り方，考え方，サンプルコード紹介](https://note.com/mmbot/n/n8e93128a23fb)

> 利益を出しているmmbotの大半は，本来のマーケットメーカーとしてスプレット収益ではなく，大部分が価格上下による超短期のキャピタルゲインだと考えています．

---

cf. [🎓常勝HFTはアルゴリズムによる労働の超高速化]({{< relref "20220826111156.md" >}})


## 📍mmbot: Optimal Spread予測 {#3678dded-21c0-4333-bec1-4b5ea00e924b}

利益を最大化するようなスプレッドを求める.

実効スプレッド[Effective spread]({{< relref "20220918092153.md#e1befe97-d60e-4a3e-89f7-c8c9e38eac8e" >}})を仮想通貨の文脈で予測する戦略.

指値の位置における[📍統計的有意性とパラメータ選択](#01d08c76-4a7d-47fe-9aba-b6104b821e7f)問題.

---

通常のスプレッドは最良気配値の差分で[Bid-Ask Spread]({{< relref "20220918092153.md#279b7a6c-f628-4b41-8ea8-764502efe786" >}})と呼ばれるが, 最良気配値はマーケットメイカーによって価格操作されている可能性もある. 市場の適正なスプレッドを予測してそこに指値をいれる. そうしたほうがより大きな利益を狙うことが出来る.

現在のスプレッドよりも, 未来のスプレッドの動きを予測してそれに対して注文をかける. 以下のリンクがわかりやすかった.

> ;; <https://note.com/akaness_note/n/n3c816e051f8c>
>
> これがもし次のt秒間で100150円から100450円の間まで変動すると予測出来たらどうでしょうか。100449円ショートと100151円ロングで差額298円となり単純に最良価格の間に挟むよりも利益が大きくなります。
>
> 歩み値や板情報等の分析を行い、このアクティブスプレッドを予測することがこの戦略の要であり、予測精度の高さがそのまま利益に直結すると言えるでしょう。


### magito mmbot サンプルコード {#0a7c69}

[magito]({{< relref "20220712161715.md#2a5ebb06-8d80-4fea-8873-b12b56788cff" >}})さんの書いたnote記事とそのサンプルコード.

-   [Python3 MarketMaker(MM)BOTのサンプルロジックとソースコード](https://note.com/magimagi1223/n/n5fba7501dcfd)
-   <https://twitter.com/regolith1223/status/1017419515666108417>

初心者登竜門? おそらくネットでさくっと参考できるものとして最も参考になるのでみんなみていそうなnote記事とそのサンプルコード.

よく外でも言及されている.

-   [mmbot神教材まとめ | ヤメティブログ](https://yameteeeee.com/mmbot_textbook/)
-   [MarketMakerBOTのソースコード（by magito氏）読解メモ1](https://note.com/wanna_be_free/n/n5cba4f4a282d)
-   [pybottersとasyncioでmagito MM!｜pe｜note](https://note.com/clever_dahlia308/n/n2fdb1ca0c62e)

このmagitoさんのeffective spreadを求める方法が独自の工夫なのか一般的なものなのかはわからない. 数年前に買った２つのnoteにも同じeffective spreadのような計算は乗っていた(有料noteなのでここではリンクはらず).

ただ, 大口注文を検出したらその手前に自分の指値注文を入れるという方法は一般的には[市場流動性活用(Penny Jump)]({{< relref "20220716165800.md#a46b85cc-5013-4e26-810f-bc2c9411a3df" >}})という方法に似ている.


### Avellaneda マーケットメイキング {#e22444}

[🔍High-frequency trading in a limit order book]({{< relref "20220716165800.md#339e5f47-79bc-449e-be08-97a0b145568c" >}})という論文がよくmmbot作成において参照されている.

おそらく[UKI]({{< relref "20220712161715.md#84fc275c-5877-4ce2-9e27-b5eda59c3812" >}})さんのブログ記事で紹介されたからかつよつよbotterはみんな読んでるはず.

[マーケットメイク戦略の理論 - これからの「お金」の話をしよう](https://we.love-profit.com/entry/2018/02/12/113916)

これは[Avellaneda Market Making]({{< relref "20220716165800.md#3d55b374-6008-4385-88a4-b4f115e399e5" >}})といわれている.

ここでやっていることは, 最適なspread幅を予測するための一つの方法.


### まささんまとめInsights {#cf2dc8}

ref. <https://twitter.com/i/events/1015960962959069184>

> まず、十分に短い期間では「価格はある値を中心に、ある価格帯をランダムに行ったり来たりする」と仮定できます。ボリンジャーバンドに近しい。なので狙いは、その行ったり来たりの値幅でどんどん売り買いすること。「ある値」を上回れば売り注文、下回れば買い注文。
>
> 期間が短いほどこの仮定は適用しやすいから、超高頻度で取引。で、「その価格帯の値幅を適切に推定する」ことが肝になりますよね。トレンドがなく一定の幅を往復するだけなら、これでどんどん儲けられます。価格ボラの大きさと、板の厚さ＆成行注文量から幅を推定できるらしい

> 「その価格帯の値幅を適切に推定する」ことが肝になりますよね.

つまり, アクティブスプレッドを予測することがキモ. 板の端の値は見かけ上の虚構の値であり, 意図的になにかを仕掛けているのであり, それが取引全体の最適な値ではない. 予測に対して機械学習をつかったりルールベースでアルゴリズムから算出したり.


### 約定履歴からEffective Spreadを重み付け調整 {#58fb71}

ref. [Python3 MarketMaker(MM)BOTのサンプルロジックとソースコード｜magito｜note](https://note.com/magimagi1223/n/n5fba7501dcfd)

> 「1サイクルの値幅」と「約定のしやすさ」はトレードオフの関係にあるため、この戦略では「X」というパラメータの調整がパフォーマンスの決め手になることが分かります。ちなみに自分は約定履歴を参照し、一度の成行注文の数量を考慮して数量Xを決めていました。

サンプルではAMOUNT_THRU=0.01の固定値となっている部分かな?

---

OHLCVから取引量を算出してそれを考慮するというところがミソかな？しかしフォワードで負けたと書いてある.

> ;; <https://note.com/tomoatx/n/nda3acdcf37aa>
>
> 板ごとのタイムスタンプのohlcvについて、板60\*4回分(大体1分間)について、板1回分(t-1~tの間)の平均の取引量をbuy,sell側でそれぞれ計算して、buy側で計算したものをsell側で、sell側で計算したものをbuy側で閾値として用いる。

---

ref. [MMbotの在庫ペナルティ付与方法を考える - 仮想通貨マイニングセンター@カブキ](https://kabukimining.hateblo.jp/entry/2019/03/26/225248)

> ;; <https://twitter.com/akagamiv2/status/1103775456262848515>
>
> 過去見る期間：WINDOW
> その重み付け：EFFECT
> 在庫ペナ：PENALTY
>
> みたいなパラメータがある。過去WINDOW期間の標準偏差取って例えば標準偏差100でEFFECT0.5なら50上下に指す。在庫偏り解消のためpos\*PENALTYで在庫+(-)なら下(上)方向に指値ずらす。似たやり方してる人多そう。
>
> ---
> ;; <https://twitter.com/akagamiv2/status/1104265174691663873>
>
> 標準偏差である必然はなくWINDOW期間の高値-安値を擬似スプレッドとしても良い。これはアリさんツイートによる知見。在庫ペナは大きいと損益曲線が平滑になりローリスク・ローリターン、小さいと純粋なナンピンみたいになりハイリスク・ハイリターンになる。
>
> ---
>
> ;; <https://twitter.com/akagamiv2/status/1104266752282652672>
>
> チンパンmmだと急変時は間違いなく焼かれる。だから短期価格予測でアルファ積んだり逃げ成行が重要になる。

これの意味するところは[💡optimal spreadの数式の定性的意味]({{< relref "20220716165800.md#fd5949ee-3a63-4a06-9613-e8e595b50318" >}})における数式の第１項. windowのは標準偏差sigma, effectはgamma.


### mmbotの重要パラメータWEP {#0fbc6f}

-   window: 過去を見る期間
-   effect: 重み付け
-   penalty: 在庫ペナルティ

> <https://twitter.com/akagamiv2/status/1106048211427319808>
>
> これら3定数はWEP(ウェップ)と個人的に呼んでいて、最適化してる。指値算出の横軸・縦軸＆在庫ペナ。大抵のmmbotはこれの延長で、加えたとしても1〜2パラメータなのではと思っている。
>
> ;; <https://twitter.com/akagamiv2/status/1106046446652936192>
>
> 過去見る期間：WINDOW=>短在庫ペナ：PENALTY=>大
>
> なほどRDR(リターン・最大ドローダウン比率)は高。RDRが高いと損益曲線が平滑化されている証拠。逆に、長・小だと平滑化は犠牲になるけど絶対利益に効く。最大DD下げて平滑化してロット増やすか、低ロットで絶対利益を取りにいくかの二択。


### 注文の強さ, またはスプレッドが開くとはなんだ? {#4f59d5}

[高頻度botを雑に作るイメージ｜片道切符マン｜note](https://note.com/_and_go/n/nfa4f5672d65b)

この記事では, spreadが開くということを図で説明してある(わかりやすい!).

スプレッドが上に開くとはどういうことか? それは... 記事参照.

> 上がりそう！↓
> 出してた売り板をキャンセルしないと！ or 成行で買わなきゃ！↓
> スプレッドが上に開く

食われたことは約定履歴から情報がわかり, 逃げたことは板情報からデータ取得ができる.

ref. [注文の強さ(Trading Intensity)]({{< relref "20220918092153.md#00fce1fd-052c-46c0-b2be-4c3744394be9" >}})


## 📍mmbot: トレンド対策 {#1d660725-713d-4fa7-90af-a912d2061098}

これはマーケットメイクにおける[逆選択リスク]({{< relref "20220716165800.md#cf7b1353-ca17-4ae5-b344-918785aa81ce" >}})と[📝在庫リスク]({{< relref "20220716193437.md#d191db6d-8c37-4acd-9945-9c6a6a1a8cfe" >}})の問題にどう対処するか.

トレンドが発生するとmmbotにとっては不利になる. 具体的にはbuy/sellの約定しやすい方から約定し, 不利な方の指値が残されてしまう. 単純な価格の上下への指値は約定しずらい.

逆選択に対してはトレンドの方向を予測して, 在庫リスクに対しては在庫を考慮して呼値を決める.

マーケットメイクは古くから株のHFTで研究されてきているため, 株の研究ノウハウは[📍マーケットメイクとトレンド対策]({{< relref "20220716165800.md#7f75ae31-b9a1-4af2-96a1-db484c261939" >}})にまとめる.

---

ref. [【bitFlyer - LightningFX】アルゴリズム高頻度取引mmbotの作り方，考え方，サンプルコード紹介](https://note.com/mmbot/n/n8e93128a23fb)

> mmbotのアルゴリズムで最も重要になってくるのは短期での価格予想です．利益を出しているmmbotの大半は，本来のマーケットメーカーとしてスプレット収益ではなく，大部分が価格上下による超短期のキャピタルゲインだと考えています．

---

片方残った場合,

-   価格が戻るまで待つ(どれくらいの時間か).
-   指値update
    -   未約定オーダーをキャンセル後約定したオーダーに対し指値注文で反対売買.
    -   未約定のオーダーをキャンセル後同方向に指値注文を再度送信する.
-   成行注文で手仕舞いする
    -   損切りのタイミングを見極める.
    -   片方だけ約定したものを成行で処理.
    -   片方だけ約定できなかったものを成行で注文.

---

-   [bitFlyerでMMbotを作ってみた結果、在庫管理は利益出すために必須！ | 矢野テックの投資ブログ](https://investment-vmoney.com/archives/5173)
-   [mmbotを何種類か作った時のメモ書き｜あかネス｜note](https://note.com/akaness_note/n/n3c816e051f8c)
-   [onSingleLeg · bitz+rinjani/r2 · GitHub](https://github.com/bitrinjani/r2/blob/master/docs/CONFIG_JP.md#onsingleleg%E8%A8%AD%E5%AE%9A%E8%A9%B3%E7%B4%B0)
-   [片方が約定しなかった場合の成行注文によるヘッジ機能の追加 bitrinjani/r2](https://github.com/bitrinjani/r2/issues/7)
-   <https://twitter.com/0xRyuzaki/status/1437512538997018633>
    -   有意義なTwitterスレッド.
    -   <https://threadreaderapp.com/thread/1437512538997018633.html>


### ネットワーク遅延 {#e317f2}

ref. [マーケット・メイクにおける在庫管理と実運用上の懸念点｜Hoheto (仮想通貨botter)｜note](https://note.com/hht/n/n868b0c36bfac)


### まささんmmbotまとめ {#f56266}

なるほどmmbotのキモは在庫管理.

ref. <https://twitter.com/i/events/1015960962959069184>

> ただ、トレンドが発生するとその仮定が崩れ、「在庫」を抱えてしまいます。買ったけど価格が戻らずに売れないとか。在庫は処分しなきゃです。積極的に処分すると、一回ごとの損失は減るけど、勝率も減る。抱えすぎても逆に問題。要はトレードオフです。
>
> この「在庫をどれだけ抱えてよいか」を最適化するのがMM戦略の肝のようです。それは「リスク回避度」と呼ばれ、小さいほど①推定した価格帯の値幅よりも狭めの幅で売り買い注文を繰り返す、②在庫を減らしやすい方向に売り買い注文の幅をずらす、のが基本的な考え方だそう。


### 💡ペナルティによる指値損切り {#1d177542-cc71-4dcc-b620-8111859a16b7}

不利な状況にどうやって対応するか.

> ;; <https://twitter.com/javeleeer/status/1083654472046239744>
>
> mmbot、一定の閾値(評価損、lotなど)を超過したら成行で捨てる処理はナンセンスで許せないけど、在庫管理関数が指値注文にペナルティを乗せた結果、成行レートで約定してしまうのはスマートな実装に思える。あるとおもいます。

<!--quoteend-->

> ;; <https://twitter.com/blog_uki/status/1001333128093351938?lang=ja>
> こんにちわ。自分はstopは使っていません。stopで清算という概念ではなく、新しい指値が約定して自然とポジションを0に復元させる、という考え方でやっています。ポジションとは反対側の指値が約定しやすくしています。

-   refs.
    -   [即時執行可能指値注文]({{< relref "20220918092649.md#27fdef45-d11e-4c4f-a2ef-adffc743c34f" >}})
    -   [Avellaneda Market Making]({{< relref "20220716165800.md#3d55b374-6008-4385-88a4-b4f115e399e5" >}})


### 必ず順方向のポジションから作るようにする {#cd8237}

> <https://twitter.com/muzineco/status/1033332390913961984>
>
> 直近の価格変動を予測して、不利にならない方の指値を必ず先に約定させること（直近で上昇する、と予測するのであれば、必ずロングを約定させた後にショートを入れる）。

---

なるほど.

> 結論から入りますが、
>
> 「トレンド発生時、必ず順方向のポジションから作るようにする」
>
> という施策によって、強いトレンド相場に入ったときのボットの挙動を安定させることができました。

<!--quoteend-->

> トレンド判定の方法ですが、すぐに思いつくだけでも以下のように様々なものがあります。
>
> ・N分間の騰落率・N分間の移動平均の変化率・N分間の約定ボリューム
>
> 筆者はこれらを組み合わせて5分から10分程度の短期のトレンドを検出...

[トレンド相場でメイカーボットの安定性・収益力を高めるアイデア｜Hoheto (仮想通貨botter)｜note](https://note.com/hht/n/na333099d536f)

お年玉note(1/19投稿🤔)とTwitterでいっているいうことで効果が高そう.

<https://twitter.com/i_love_profit/status/1218841792709193729>


### from hummingbot {#c7a3da}

-   [What is inventory risk?](https://blog.hummingbot.org/blog-2020-10-inventory-risk/)
-   [Identifying trends](https://blog.hummingbot.org/blog-2021-03-identifying-trends/)
-   [[Level 2] Selecting markets, identifying trends, and reducing inventory risk](https://blog.hummingbot.org/academy-level-2-b-beginner-selecting-markets-identifying-trends-and-reducing/)


### ぽろり収集 {#973fa5}

> ;; <https://twitter.com/pugoog/status/1205485900408295425>
>
> mmbotの損益グラフからドテン君に切り替えるシステムは割と確度高そう

<!--quoteend-->

> ;; <https://twitter.com/CryptoNdb/status/1135699999864414208>
>
> mmbotって急騰急落時に死ぬと思うんですけどドテン君と同時に走らせたらいいヘッジになりそう。

<!--quoteend-->

> ;; <https://twitter.com/Poitan_unyo/status/1079038915535724545>
> ;; <https://twitter.com/kunmosky1/status/1079154764808478720>
>
> トレンドフォロー+mmbot の組み合わせにぜひしましょう！
>
> ---
>
> mmbot的なbotがトレンド相場にやられちゃうのはもはや宿命みたいなもんですからね。なんとか対策したいところです(^ ^)


### 部分約定対策 {#b2e1a6}

在庫管理における派生的な問題. 部分約定自体はよくあること.

指値注文で一部のみ約定する場合があるのでこのハンドリング戦略. ポジションずれをどうリバランスするか.

部分約定, 一部約定は特に仮想通貨でつかわれていて一般的には[内出来]({{< relref "20220918092649.md#a7f59104-2004-4b5d-a33d-ef7fc950efce" >}})という用語の方が多い気がする. filled/remainingで表されるもの.

一般的かわからないが, Inventry skewとも.

残ってしまった注文に対して注文内容を編集して更新(取引所によってAPIで１回で情報の編集更新がたり, キャンセルと再注文の2回のAPIの組み合わせで実現), または損切りする.

次の注文でorder sizeを変更して調整.


### 高騰暴落対策 {#ec8c71}

VPINを活用する方法. 別のメモで解説.

ref. [VPINによる市場変動予測]({{< relref "20220916104417.md#9ec43900-1beb-4606-a224-84bb72c56a0a" >}})


## mmbot Topics {#3c0eef}

mmbotトピックまとめ. 市場動向つねに変化しているため, 古い情報は今とは乖離があるかも.


### 📍統計的有意性とパラメータ選択 {#01d08c76-4a7d-47fe-9aba-b6104b821e7f}

高頻度botはバックテストではなくフォワードテストでどんどん検証していくという考え方もある. なぜならば, 高頻度であるゆえいろんな影響を受けやすくバックテスト通りに期待が動かないから.

ref. [高頻度botを雑に作るイメージ｜片道切符マン｜note](https://note.com/_and_go/n/nfa4f5672d65b?magazine_key=m411b4702af88)

> **最小ロットでのフォワードが何より重要だ！**

---

しかしその一方でパラメータは算出するべきともある.

ref. [【bitFlyer - LightningFX】アルゴリズム高頻度取引mmbotの作り方，考え方.. ](https://note.com/mmbot/n/n8e93128a23fb)

> mmbotなどの高頻度取引においては，人間の感覚でパラメータを決めることは避けるべきです．
>
> 高頻度取引は1円，2円の差で運用成績は大きく左右します．HFTも含め多くのファンドは，そのような人間の感でパラメータの設定はしていません．
>
> ---
>
> mmbotの作成において必ず考慮しなければいけないのは，統計的に有意性があるか，ということです．アルファやエッジとも呼ばれますが，高頻度で取引をする自動売買においては，取引回数を無限と近似し，統計的にみて根拠がある方向やパラメータで指値を供給・キャンセル，することが絶対的に必要です．
>
> “統計的”とは，相関関係がある指標をもとに価格の上下を予測し，パラメータ調整には精度の高い評価ができているか，ということです．

---

おそらく算出は理想だが少し大変ということで, やるに越したことはないのだと思う. 優先度の問題.

---

-   refs.
    -   [アルファ]({{< relref "20220716193437.md#ac450f02-d652-4181-b9ec-1cb23b7300c8" >}})
    -   [⚙アルファを探せ]({{< relref "20220915053805.md" >}})
    -   [📝仮想通貨データ分析]({{< relref "20220831124425.md" >}})


### ロット数と並行トレード {#24d3da}

1つのbotのロットを上げるべきか, 複数のbotで小さいロットにするか問題.

-   [mmbotにおけるポジションと注文サイズについて - キジトラのブログ](https://kijitora-2018.hatenablog.com/entry/2018/12/23/102913)
-   [シストレにおけるポジション調整の数式表現について〜調整のアクティブ度合いによる式の変化〜 - マクロは3:2:5](https://sshuhei.com/entry/adjust_lot/)

---

以下Twitterサルベージ.

-   <https://twitter.com/AAAAisBraver/status/1034605157592395776>
    -   アンケートが参考になるかも. 0.01~0.1が25%.
-   <https://twitter.com/akagamiv2/status/1103130547537080320>
    -   AKAGAMIさんのツイート. 0.04~0.1くらい.

---

たくさん分割して在庫管理しながら指値している例.

<https://twitter.com/yanoteck/status/1357600266887917569>


### 2種類のmmbot {#b0006e}

-   取引指標が示す方向に指値を入れるbot.
-   スプレッドを意識してask/bidの両建てをするbot.

> ;; <https://twitter.com/asupega/status/1025777982273540098>
>
> mmbotと呼ばれるものにも2種類あって、uki氏のnoteにあったような、とにかく指標が示す方向に（成行になってもいいから）指値を入れ続けるタイプのbotと、スプレッドを意識してaskとbidの両方に入れ続けるbotがあるような気がしていて、後者が爆益してるような感じがするんですよね……

mmbot自体が造語なので正解はないかも.


### 投資戦略の項目 {#889779}

<https://italiajin.com/marketmake/>

-   相場の勢い
-   在庫リスク
-   板の厚み
-   想定期間経過後の相場予測


### 高頻度取引の限界 {#71241834-e7d7-4075-8714-87659a971b0e}

ref. [100万円を1000万円にする取引戦略を考えてみる（主に取引回数と利回りの関係について） - マクロは3:2:5](https://sshuhei.com/entry/100to1000/)

> MMbotは複利運用が難しく，これから改良を続けても自分の能力と照らし合わせて考えて，おそらく日次50万程度が限界．取引手数料無料かつ，takerが多い環境でしか利益を上げづらい戦略なので，実質bitflyerFXでしか稼働が不可能．

[スナフキン]({{< relref "20220712161715.md#c472d9fe-aabf-4a20-84f7-ef5ab999f7b6" >}})

現在ではどうかわっているか?


### mmbot同士の戦いは熾烈なので、BTCJPYで今から勝つのはほぼ不可能 {#ed0e7b}

ref. [暗号通貨で勝てるのか？ 結論mmbotが唯一の可能性 | (`^・^`)猫にビットコイン](https://tokyo559.com/%E6%9A%97%E5%8F%B7%E9%80%9A%E8%B2%A8%E3%81%A7%E5%8B%9D%E3%81%A6%E3%82%8B%E3%81%AE%E3%81%8B%EF%BC%9F-%E7%B5%90%E8%AB%96%E3%80%80mmbot%E3%81%8C%E5%94%AF%E4%B8%80%E3%81%AE%E8%81%96%E6%9D%AF/)

> 結論高性能mmbotを作る。方法は人それぞれ、運用が肝。
>
> -   自分で作る。C++、JAVAなどコンパイル系言語による高速化は可能性あるかも
> -   作ってもらう（多分高額）

高速化で差別化をはかるというインサイトは得た.

> 株取引は板のAPIは公開されていないと思うので、mmbotは運用できない。
>
> もし出来たらボロ儲けでしょう。

2022年は公開されている. [株取引API]({{< relref "20220714203637.md#540cb0dc-c01c-409b-abe4-5001ba8ef0ae" >}})


### 天下一BOT大会 {#a5f7a3ca-65ab-42e3-a6eb-2dd2e3f7912a}

2018年6月に行われたbotの収益を競うイベント.

[最強の仮想通貨自動売買botはどれだ！？第一回天下一BOT会（仮）開催！エントリー受付開始 | ALIS](https://alis.to/seville/articles/3gpe5pwL4vxn)

天下一BOT会でmmbotが驚異的な強さを発揮したとかで注目度アップ.

[「天下一BOT会」ドラゴンボールではなく仮想通貨自動売買ボット対決！ | 銭ナビ](https://number-x-value.com/2282.html)

第2回.

[「第二回天下一BOT会 令和元年記念大会」開催！今回はLiquidで | 銭ナビ](https://number-x-value.com/3778.html)


### 手数料について {#8fc27c}

mmbotでは買いと売りを両方注文するので手数料はそこも考慮. 理想的には手数料無料がいい.


### 一般人の成行注文を刈る {#638f92}

あなたの知らないbotの世界. 裁量トレーダーがbotのやっていることを知って驚くツイートをたまに見かける.

-   <https://twitter.com/youheihey69/status/1013580858635182080>


### 結局どこの取引所がいいのか問題 {#eec2f0}

bitFlyer全盛時代が2018年にあったようだが, そこから決定的なものはないのかな?


### 収益安定化 - from UKI {#ab8f2f}

> <https://twitter.com/blog_uki/status/1001827689446035456>
>
> 1.トレード損益の改善。タイムアウトまでに約定できる範囲で指値の幅をできるだけ広く取る。2.トレード数。limit制限いっぱいまで打ち続けてレンジ相場のうちに利益を掻き集める。3.トレンド対策。不意のトレンドの損失を抑えるようポジション管理。

優先度設定の参考になる. インパクトとその相談.


### 価格操作とmmbotダマシ {#a834b6}

価格操作によりMMBOTを攻撃する手法もあるらしい.

ref. [第1回墨汁会議 `価格操作対策とMMBOTを攻撃する手法` - 墨汁うまいと学ぶ仮想通貨の世界](https://bokujyuumai-salon.ethereum-japan.net/movie/2571)

ここでいうパンプ＆ダンプかな? 見せ玉?

ref. [暗号通貨市場におけるHFTまとめ｜Hoheto (仮想通貨botter)｜note](https://note.com/hht/n/n29542dcec517)


### mmbotの利益の仕組み {#adaec9}

この記事がオススメ↓

[典型的なHFT業者は要するにマーケットメイクをしている]({{< relref "20220916104417.md#816aca98-c0e8-46a3-af59-2f80e94d67f9" >}})


### 手動で売買したい一般人の成行注文をとる {#a909c0}

ビットコインを買う場合, 販売所と取引所があり, 普通の人は販売所は手数料が高いので取引所をできれば使いたいのだ. しかし, 取引所というのは交換によって売買するため, そもそも売っている人がいないと買うこともできない.

そこでbotは買いたいひとに対してあらかじめ指値で注文を出すことによって板に注文を並べておくことによって一般人から成行注文で買ってもらうことを待つ. この時, 実際の値段よりもちょっと高く売りに出すことが大事でこれが利益の厳選になる. ビットコインをすぐ買いたいけど販売所の手数料が嫌な人が販売所よりも安いならば若干の損でもbotの注文を買ってくれる.

botは安く買って高く売れればそれが利益になるが, このマーケットメイクのうまいところは, あらかじめ売りと買いの両方に注文を出して売りたい人と買いたい人の両方を相手にすること.

これをすることで, 安く買う -> 高く売るということをやろうとしたときに, 買ってから売るという順番ではなくて, 買いつつ売るというような状況になり, 結果２倍の速度で１サイクルを回すことができる. ここがマーケットメイクの秀逸点.

仮に同時行わないとする, 例えば高く売ることに成功すると, JPYの残高は増え, BTCの残高は減る. このあとさらにもう一度BTC高く売るためにはどこかからJPYでBTCを買ってBTCを安く仕入れる必要がある.


### 💡bitbank mmbot sample repositoriesからのインサイト {#c6ad46}

<https://github.com/bitbankinc/sample-market-making-bot>

bitbankの公式マーケットメイクサンプルのREADMEにはこんな戦略がありますよ, というのが乗っている(ここはサンプルコードではない, アイデアのみ).

> 大きな板が最終約定価格付近に存在した場合、その手前に板を置く例えば最終約定価格から50円、100円、200円離した価格にそれぞれ売り板/買い板を置く
> botのロジックを他のユーザに悟られないよう、発注数量をランダム値にするオーダーブックの売り数量が買い数量を極端に上回っていた場合、様子を見て買い注文は出さない等約定履歴APIを利用し、自分の直近の約定結果から不利にならないような位置に板を置くボラティリティが大きい局面を判定し、そのときだけはbotの動作を停止させる、または数量を小さくする


### 💡様々な市場に応じたマーケットメイクTips {#1a99de}

ref. [Tips for Handling Different Market Conditions](https://blog.hummingbot.org/blog-2022-03-02-market-conditions/)

トレンドを検出したら,

-   Order Delay: 約定しやすい方を遅れて出す.
-   Offseting Spreds: トレンドによって約定しやすい方向の呼値を多くして逆を少なくする.
    -   どうやって比率を決定するかは書いてない.
    -   固定値+50とかを付与するとか.
    -   板の厚みや約定履歴から情報の偏りをみるか.


## 🤔mmbot Insights {#2dca5e}

mmbotに対する個人的感想.

-   [💭自分のmmbotはなにか根本的に間違っているのかもしれない(2022/10/21)]({{< relref "2022-w42.md#86f54d27-0d17-4534-9b35-1a131c452dfb" >}})


### ネットの情報よりも書籍や論文で学ぶ {#536cfc}

はじめはこのwikiにネットに転がっている情報を集めまくったものの, 効率が悪かったと思った.

mmbotを作成するためには[📝マーケット・メイキング・アルゴリズム]({{< relref "20220716165800.md#e4dd477c-8553-4d2c-8e61-224b22ba8e34" >}})を正しく理解することが大事であり, そのための近道はブログ解説記事だったりツイートではなく, [杉原論文]({{< relref "20220716193728.md#2b011271-d8b2-416d-90b4-7db9373be42e" >}})だったり書籍などを読んで全体像を学ぶのがいいと思った.

個々のブログはどうしても断片を切り取ったものになり, それを自分の知識体系として統合するのは大事だが, 構造化された知識を上からまずは把握してから各論に入るほうが効率がいい.

そこまで情報は多くないものの, 仮想通貨ではなく株取引としてのマーケットメイク理論は昔から今に至るまでずっと研究されているようでバリエーションもたくさんある. [📝アルゴリズム取引]({{< relref "20220714203637.md" >}})においてはマーケットメイクとアービトラージはニ大鉄板戦略的な位置づけにある.


## References {#d95867}


### 理論 {#cf55fa}

-   [マーケットメイク戦略の理論 - これからの「お金」の話をしよう](https://we.love-profit.com/entry/2018/02/12/113916)
-   [高頻度botを雑に作るイメージ｜片道切符マン｜note](https://note.com/_and_go/n/nfa4f5672d65b?magazine_key=m411b4702af88)
-   [【bitFlyer - LightningFX】アルゴリズム高頻度取引mmbotの作り方，考え方，サンプルコード紹介-2021年1月最終更新｜mmbotxxx｜note](https://note.com/mmbot/n/n8e93128a23fb)
    -   無料は考え方のみ. サンプルコードは有料パート.
    -   匿名投稿だが, 句読点にカンマとピリオドをつかっているのでもうこれで誰が書いたかわかったかもしれない. 技術文書にこの記法を用いる人は限られているしこだわりがあって使っているはず.


### 入門情報まとめ/やってみた {#9a37cb}

初心者, またはこれからの情報.

-   [既存戦略調査 (1) mmbot｜j26｜note](https://note.com/j26/n/n396b5fb31663)
-   [HFTを作りたい｜さきやま｜note](https://note.com/sakiyama100/n/n20ef5a4c9549)
-   [仮想通貨トレードで参考にした公開情報｜ひよっこ｜note](https://note.com/mycrypto/n/n7ba7c8e6cda5)
-   [mmbotとは何者か？ 天下一BOT会で圧勝してる短期高速スキャ系ボット流行の兆し | 銭ナビ](https://number-x-value.com/656.html)
-   bitbank
    -   [仮想通貨の自動取引入門 `環境構築`. 仮想通貨に限らず自動取引は取引時に人手を介さず、リスクのコントロールおよびリター… | by Yuya Sugano | Medium](https://yuyasugano.medium.com/%E4%BB%AE%E6%83%B3%E9%80%9A%E8%B2%A8%E3%81%AE%E8%87%AA%E5%8B%95%E5%8F%96%E5%BC%95%E5%85%A5%E9%96%80-%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89-99c1ca8f8b02)
    -   [仮想通貨の自動取引入門 `テクニカル指標`. 仮想通貨に限らず自動取引は取引時に人手を介さず、リスクをコントロールしつつコスト… | by Yuya Sugano | Medium](https://yuyasugano.medium.com/%E4%BB%AE%E6%83%B3%E9%80%9A%E8%B2%A8%E3%81%AE%E8%87%AA%E5%8B%95%E5%8F%96%E5%BC%95%E5%85%A5%E9%96%80-%E3%83%86%E3%82%AF%E3%83%8B%E3%82%AB%E3%83%AB%E6%8C%87%E6%A8%99-53b32f301ce6)
    -   [仮想通貨の自動取引入門 `Backtestingによるバックテスト` | by Yuya Sugano | Medium](https://yuyasugano.medium.com/%E4%BB%AE%E6%83%B3%E9%80%9A%E8%B2%A8%E3%81%AE%E8%87%AA%E5%8B%95%E5%8F%96%E5%BC%95%E5%85%A5%E9%96%80-backtesting%E3%81%AB%E3%82%88%E3%82%8B%E3%83%90%E3%83%83%E3%82%AF%E3%83%86%E3%82%B9%E3%83%88-22b243976a65)
    -   [仮想通貨の自動取引入門 `Pubnubによるマーケット・メイキング` | by Yuya Sugano | Medium](https://yuyasugano.medium.com/%E4%BB%AE%E6%83%B3%E9%80%9A%E8%B2%A8%E3%81%AE%E8%87%AA%E5%8B%95%E5%8F%96%E5%BC%95%E5%85%A5%E9%96%80-pubnub%E3%81%AB%E3%82%88%E3%82%8B%E3%83%9E%E3%83%BC%E3%82%B1%E3%83%83%E3%83%88-%E3%83%A1%E3%82%A4%E3%82%AD%E3%83%B3%E3%82%B0-df403abbe944)


### サンプルコードあり {#e16d0b}

magit mmbotが入門としてよく言及されるものの, mmに派生的な戦略が付与されいてる気がする. いちおしはBitMEXのセミナー動画(Youtube)とそのGitHubコード.

-   [pybottersとasyncioでpenny jump!｜pe｜note](https://note.com/clever_dahlia308/n/nce1be635ad72)
    -   <https://github.com/ko0hi/pybotters-magito-mm>
-   [mmbot作って動かしたけど勝てる気がしないので、コードを公開して一旦諦める](https://zenn.dev/dl10yr/articles/mmbot-zasetsu)
-   <https://github.com/BitMEX/sample-market-maker>
    -   BitMEXのGitHub repoにmmbot.
    -   おそらくサンプルの中で一番よくできている. 在庫管理のposition調整も.
    -   トレンド方向予測は諦めて在庫調整をしながら指し続ける戦略.
    -   解説動画: <https://www.youtube.com/watch?v=Dm65PAbkQUw>
-   <https://github.com/bitbankinc/sample-market-making-bot>
    -   bitbankのmmbot
-   <https://github.com/ondra-novak/mmbot>
    -   GitHubのスターも100超えていて2022でも更新されている. C++製.


### 戦略/Tips {#8dd7c6}

ある程度取り組んだ視点からの解説記事. 基礎とサンプルからの改善.

-   [mmbotを何種類か作った時のメモ書き｜あかネス｜note](https://note.com/akaness_note/n/n3c816e051f8c)
-   片道切符マンさん
    -   [過去実施して増益に効果的だった施策、効果的ではなかった施策などなど①](https://note.com/_and_go/n/nf2450f6239fe)
    -   [過去実施して増益に効果的だった施策、効果的ではなかった施策などなど②](https://note.com/_and_go/n/nbfb3f687b67d)
-   むじネコさん
    -   <https://twitter.com/muzineco/status/1033330462712709120>
-   [Hummingbot]({{< relref "20220712161715.md#e7c5f961-7856-446c-b900-409672d2511f" >}})
    -   高頻度botのオープンソースプロジェクト.
    -   ブログやYoutubeでがっつりマーケットメイク関係の情報発信がされている.


### Papers {#60b1a0}

仮想通貨というよりも株を対象にしたマーケットメイク戦略の論文がおおいので[📝マーケットメイク]({{< relref "20220716165800.md" >}})にまとめる.

-   [📄執行戦略と取引コストに関する研究の進展 - 杉原慶彦[2012]​]({{< relref "20220716193728.md#2b011271-d8b2-416d-90b4-7db9373be42e" >}})
-   [📄High-frequency trading in a limit order book - Avellaneda and Stoikov [2008]​]({{< relref "20220716165800.md#339e5f47-79bc-449e-be08-97a0b145568c" >}})
