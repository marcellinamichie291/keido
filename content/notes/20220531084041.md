+++
title = "ğŸ“Clojure Integrant"
lastmod = 2022-10-18T07:25:13+09:00
tags = ["Clojure", "WIKI"]
draft = false
+++

-   up: [Clojure: çŠ¶æ…‹ç®¡ç†ã¨ã‚·ã‚¹ãƒ†ãƒ ]({{< relref "20220211142329.md#497a8160-d192-45db-aa0c-84b9a2442861" >}})
-   refs.
    -   [weavejester/integrant: Micro-framework for data-driven architecture](https://github.com/weavejester/integrant)
    -   made by [ğŸ‘¨James Reeves(@weavejester)]({{< relref "20220320183317.md" >}}).
    -   [ğŸ“ãƒ‡ãƒ¼ã‚¿æŒ‡å‘ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°]({{< relref "20220310095153.md" >}})


## ğŸ“Integrantã¨ã¯ {#3f5307}

ãƒ‡ãƒ¼ã‚¿é§†å‹•è¨­è¨ˆã«ã‚ˆã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ãƒã‚¤ã‚¯ãƒ­ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯.

[Dependency Ingection]({{< relref "20220310114456.md" >}}) ã‚’Clojureã§å®Ÿç¾.

è¨­å®šãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹åˆæœŸåŒ–é–¢æ•°ã‚’å®šç¾©ã§ã, è¨­å®šãƒ‡ãƒ¼ã‚¿ã®å®šç¾©ã‹ã‚‰å®Ÿä½“ã‚’ç”Ÿæˆ.


### Usage {#c64518}

-   integrant
    -   **configuration map** ã‚’ã‚‚ã¨ã«ç”Ÿæˆã•ã‚Œã‚‹micro-serviceã®1ã¤ã®å˜ä½.
-   configuration map
    -   keyã®å®šç¾©ã‚’ã¾ãšã™ã‚‹. ã“ã‚Œã¯å…·ä½“çš„ãªå®Ÿè£…ã¸ã¨åˆæœŸåŒ–ã•ã‚Œã‚‹å…¥åŠ›æƒ…å ±.
    -   Clojureã®mapã¨ã—ã¦è¡¨ç¾ã™ã‚‹ã‹EDNãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã«å®šç¾©ã™ã‚‹.
    -   configuration mapåŒå£«ã¯ **ig/ref** ã§ å‚ç…§ã™ã‚‹ã“ã¨ãŒã§ãã‚‹.
-   ig/init-key ã§ integrant serviceã®åˆæœŸåŒ–ã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿ã¨é–¢æ•°ã‚’å®šç¾©.
-   ig/halt-key!ã§integrant serviceã®init-keyã®å®šç¾©ã‚’ç ´æ£„ã™ã‚‹é–¢æ•°ã‚’å®šç¾©.
-   ig/initã«configuration mapã‚’æ¸¡ã™ã“ã¨ã§, ä¾å­˜é–¢ä¿‚ã«å¾“ã£ã¦ integrant ã‚’åˆæœŸåŒ–.
-   init/halt!ã§ ç ´æ£„.

<!--listend-->

```clojure
(defmethod ig/init-key :handler/greet [_ {:keys [name]}]
  (fn [_] (resp/response (str "Hello " name))))
```

-   {:keys [name]}ã¯Clojure åˆ†é…æŸç¸›ã®è¨˜æ³•.
    -   ref: [ğŸ“Destructuring]({{< relref "20220116094552.md" >}})
-   keyã« ::hogeã¿ãŸã„ãª 2ã¤ã®ã‚³ãƒ­ãƒ³ã‚’ã¿ã‹ã‘ã‚‹. ::hogeã¯ :(namespace)/hogeã®æ„å‘³.
    -   REPLã§è©•ä¾¡ã™ã‚‹ã¨ã‚ã‹ã‚‹, reader syntax.


### Usage: Integrant suspend/resume {#d269c6}

<https://github.com/weavejester/integrant#suspending-and-resuming>

Integrantã¯initã¨halt, ã¤ã¾ã‚Šã‚·ã‚¹ãƒ†ãƒ ã®é–‹å§‹ã¨çµ‚äº†ã®æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹.

suspend/resumeã¯ä¸»ã« **é–‹ç™ºç”¨** ã§ã‚ã‚‹. ãã—ã¦ä½¿ã„ã“ãªã™ã«ã¯atomã¨delayã‚’ã¤ã‹ã†ã¨ã„ã†ã²ã¨å·¥å¤«ã‚’åŠ ãˆã‚‹.

Integrantã®è€ƒãˆæ–¹ã¨ã—ã¦namespaceã«atomã‚’bindingã—ãªã„. ãã®ä»£ã‚ã‚Šã« init-keyã®ä¸­ã§ atomã‚’å®£è¨€ã—ã¦è¿”ã‚Šå€¤ã®mapã«bindingã™ã‚‹.


## Integrant-REPL {#672fb670-7d22-4312-99af-767d6f8b3528}

Integrantã§[Reloaded Workflow]({{< relref "20220117205249.md#7e942a1e-481a-4f5d-8c0d-1edd44da93df" >}})ã‚’ã™ã‚‹ãŸã‚ã®è£œåŠ©ãƒ©ã‚¤ãƒ–ãƒ©ãƒª. Integrantã¨åŒã˜weavejesterã•ã‚“ãŒä½œæˆ.

<https://github.com/weavejester/integrant-repl>

ã‚³ãƒ¼ãƒ‰è‡ªä½“ã¯å°ã•ãã‚·ãƒ³ãƒ—ãƒ«ãªã®ã§ãªã«ã‚’ã‚„ã£ã¦ã„ã‚‹ã®ã‹ã¯ã‚½ãƒ¼ã‚¹è¦‹ã‚‹ã®ãŒæ—©ã„ã‹ã‚‚.


### ğŸ’¡systemã‚’replã‹ã‚‰ã¿ã‚‹ {#3fa643}

å€‹äººçš„ã«å¼·ã„ã¨ãŠã‚‚ã†Tips. integrant.replã¯integrantã§åˆæœŸåŒ–ã—ãŸsystemã‚’ [alter-var-root]({{< relref "20220116080418.md#0a9a33a9-ec92-43a3-9312-2734cb01c65a" >}}) å¤‰æ•°ã«bindã—ã¦ã„ã‚‹. ã™ã‚‹ã¨, ã“ã®systemã®å¤‰æ•°ã‚’è¦—ã„ã¦ã—ã¾ãˆã°å‹•ä½œã—ã¦ã„ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã®ä¸­èº«ãŒã‚¹ã‚±ã‚¹ã‚±ã®ã¾ã‚‹ã¿ãˆ.

integrantãŒè¦ã¯ã‚¢ãƒ—ãƒªã®ãªã‹ã§atomãªã©ã®çŠ¶æ…‹ã‚’ãƒãƒ©ãƒãƒ©ã«å®£è¨€ã™ã‚‹ã®ã§ã¯ãªãã¦ä¸€ã¤ã®rootã¨ãã®ãƒ„ãƒªãƒ¼ã«ã¾ã¨ã‚ã¾ã—ã‚‡ã†ã¨ã„ã†è¨­è¨ˆãªã®ã§, ã“ã®ä¸­ã‚’ã¿ã‚Œã°ã‚·ã‚¹ãƒ†ãƒ ã®å…¨ã¦ãŒè¦‹ã‚Œã‚‹.

```clojure
(require '[integrant.repl.state :refer [config system]])
```


### âœ…CIDERé€£æº {#03991e}

[Emacs CIDER]({{< relref "20220316151158.md#3f666d7d-d303-41ba-911c-50f65fb31c92" >}}) ã§ M-x cider-ns-refreshã®å‰å¾Œã«suspendã¨resumeã‚’hookã•ã›ã‚‹ã¨æ°—è»½ã«ã‚·ã‚¹ãƒ†ãƒ ã‚’reset.

.dir-locals.elã«ä»¥ä¸‹ã‚’è¨˜è¼‰.

```elisp
((clojure-mode . ((cider-ns-refresh-before-fn . "integrant.repl/suspend")
                  (cider-ns-refresh-after-fn . "integrant.repl/resume"))))
```

é€šå¸¸, cider-ns-refreshã¯M-x C-c M-n rã«bindingã•ã‚Œã¦ã„ã‚‹. ã“ã‚Œã¯å¤‰æ›´ãŒã‚ã£ãŸnamespaceã®ã¿ã‚’refreshã™ã‚‹ã™ã¹ã¦ã®namespaceã‚’refreshã—ãŸã„å ´åˆã¯, C-u C-c M-n rã‚’å®Ÿæ–½ã™ã‚‹å¿…è¦ãŒã‚ã‚‹.

ref. [Miscellaneous Features :: CIDER Docs](https://docs.cider.mx/cider/usage/misc_features.html)


#### ğŸ’¡cider-ns-refresh-show-logã®ãƒ¯ãƒŠ {#254827a1-89b8-487c-be2a-7458a01c8407}

è½ã¨ã—ç©´ãªã®ãŒã‚ˆãã‚ã‹ã‚‰ãªã„ãŒ, cider-ns-refreshã§å®Ÿè¡Œã™ã‚‹ã¨å‰å¾Œã®integrantã®init/haltã®æ¨™æº–å‡ºåŠ›ãŒREPLã«è¡¨ç¤ºã•ã‚Œãªã‹ã£ãŸ. cider-ns-refresh-show-log-bufferã«tã‚’è¨­å®šã™ã‚‹ã¨ **cider-ns-refresh-log** ã¨ã„ã†bufferãŒè¡¨ç¤ºã•ã‚Œã¦ã“ã“ã«å‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹.

```emacs-lisp
(setq cider-ns-refresh-show-log-buffer t)
```

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã¿ã‚‹ã¨ outã¨bufferã®ä¸¡æ–¹ã«åŒã˜å‡ºåŠ›ãŒã§ã‚‹ã¨èª­ã‚ãŸã®ã ãŒ... è‡ªåˆ†ã®ç’°å¢ƒã§ã¯ã§ãªã„. ã“ã‚ŒãŒnreplã®å½±éŸ¿ãªã®ã‹ã¯ä¸æ˜. ã¨ã‚Šã‚ãˆãšå‡ºåŠ›ãŒç¢ºèªã§ãã‚Œã°æ·±è¿½ã„ã¯ã—ãªã„ã“ã¨ã«ã—ãŸ.

Workaroundã¨ã—ã¦printlnã‚’è«¦ã‚ã¦logãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã®ã‚‚æ‰‹.


## ğŸ’¡Integrant Topics {#a290a2}

[Duct]({{< relref "20220211142329.md#d8c00c56-21de-485d-af41-01f920cd7c7f" >}})ã¯å†…éƒ¨ã§integrantã‚’ã¤ã‹ã£ã¦ã„ã‚‹ã®ã§ductã§æ¤œç´¢ã—ã¦ã‚‚ã„ã„.


### âœ…Reloaded Workflowã§init/haltã«æ™‚é–“ãŒã‹ã‹ã‚‹å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ— {#a7586f}

[Reloaded Workflow]({{< relref "20220117205249.md#7e942a1e-481a-4f5d-8c0d-1edd44da93df" >}})ã§ã‚·ã‚¹ãƒ†ãƒ ã‚„ãã®ã‚µãƒ–ã‚·ã‚¹ãƒ†ãƒ ã®èµ·å‹•ã¨çµ‚äº†ã‚’ã—ãŸããªã„ã¨ã. è¨€ã„æ›ãˆã‚‹ã¨, é–‹ç™ºä¸­ã¯ã‚¹ã‚¿ãƒ³ãƒã‚¤çŠ¶æ…‹ã§ãªã«ã‚‚ã—ã¦ã»ã—ããªã„ã¨ãã®æ–¹æ³•.

atom, delay, realizedã‚’ã†ã¾ãã¤ã‹ã†.

```clojure
(defmethod ig/init-key ::app [_ opts]
    (atom (delay (start opts))))

(defmethod ig/halt-key! ::app [_ app]
  (when (realized? @app)
    (.close @@app)))
```

ã‚¹ã‚¿ãƒ³ãƒã‚¤çŠ¶æ…‹ã«ãªã‚‹ã®ã§å¤–éƒ¨é–¢æ•°ã‹ã‚‰èµ·å‹•.

```clojure
(defn run []
  (let [bot (:hoge.bot/app system)]
    (when (not (realized? @bot))
      (force @bot))
    :running))
```

è‡ªåˆ†ã§è€ƒå¯Ÿã—ãŸæ–¹æ³•ãªã®ã§ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãªã®ã‹ã¯ã‚ã‹ã‚‰ãªã„. delayã®ä»£ã‚ã‚Šã«promise/deliverã‚’ã¤ã‹ã£ã¦ã‚‚åŒã˜ã“ã¨ã¯ã§ãã‚‹ã¯ãš.


### âœ…integrantã§çŠ¶æ…‹ã‚’ä¿æŒã—ãŸã„ãªã‚‰def/alter-var-root {#af8bcd}

ref. [ğŸ’¡è€ƒå¯Ÿ: Component/Mountã¨Integrantã®æ±ºå®šçš„é•ã„ã¯OOP vs FP](#7110ebb1-ddd0-414a-9250-5d3c8d0a07ee)

ãã‚Œã§ã‚‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘çš„ã«integrantã‚’ã¤ã‹ã†ãªã‚‰ã° [def macro / alter-var-rootã«ã‚ˆã‚‹varã®å†å®šç¾©]({{< relref "20220116080418.md#0a9a33a9-ec92-43a3-9312-2734cb01c65a" >}})ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã¤ã‹ã†.

```clojure
; https://github.com/dimovich/roll/blob/master/src/clj/roll/sente.clj

(defonce sente-fns nil)

(defn send-msg [& args]
  (some-> (:chsk-send! sente-fns)
          (apply args)))

(defmethod ig/init-key :roll/sente [_ opts]
  (alter-var-root #'sente-fns (constantly (start-sente opts))))

(defmethod ig/halt-key! :roll/sente [_ {:keys [stop-fn]}]
  (info "stopping roll/sente...")
  (alter-var-root #'sente-fns (constantly nil))
  (when stop-fn
    (stop-fn)))
```

tools.namespace/refreshã¯defonceã—ã¦ã‚‚å¼·åˆ¶çš„ã«ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã®ã§def/defonceã¯ã‚ã¾ã‚Šé–¢ä¿‚ãªã„ã‹ãª?


## ğŸ¤”Integrant è€ƒå¯Ÿ {#28aa1d}


### ğŸ’¡è€ƒå¯Ÿ: Integrantã§çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ã¨ã„ã†ã“ã¨(Global Storage) {#e54de604-3bac-4561-a12c-8cad34bf8ee9}

Clojureã®ä¸–ç•Œã§ã¯, æ™®é€šã¯çŠ¶æ…‹ã‚’atomã§ç®¡ç†ã™ã‚‹.

Integrantã‚’å°å…¥ã™ã‚‹ã“ã¨ã§, å„namespaceã«æ•£ã‚‰ã°ã‚‹atomã§å®£è¨€ã•ã‚ŒãŸçŠ¶æ…‹ã‚’systemã¨ã„ã†ã²ã¨ã¤ã®çŠ¶æ…‹ã«ç´ã¥ã‘ã¦ã¾ã¨ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹. ãã—ã¦ã“ã®ãƒ„ãƒªãƒ¼æ§‹é€ ã§çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ã‹ã‚‰ã“ãã‚·ã‚¹ãƒ†ãƒ ã®åœæ­¢ã‚„å†èµ·å‹•ãŒç”¨æ„ã«ã§ãã‚‹.

é€†ã«è¨€ã†ã¨, Integrantã‚’åˆ©ç”¨ã™ã‚‹ã¨ã„ã†ã“ã¨ã¯, namespaceã§atomã‚’å®£è¨€ã—ãªã„ã¨ã„ã†ã“ã¨.

**Global storage** ã¨è¨€ã‚ã‚ŒãŸã‚Šã™ã‚‹. (ref. [Systems in Clojure](https://grishaev.me/en/clj-book-systems/#integrant)).

---

[Integrant: how to store and access the running system? : Clojure](https://www.reddit.com/r/Clojure/comments/ar87te/integrant_how_to_store_and_access_the_running/)

> Systems in Integrant are intended to be autonomous.

> Anyway, my point is that it seems to me Integrant still requires a whole app buy-in in the sense that, unlike with Mount, you have to thread all your state through a single entry-point.

systemã¯threadã§å‹•ä½œã™ã‚‹å†å¸°ãƒ—ãƒ­ã‚»ã‚¹. ã—ã‹ã—ã“ã‚Œã¯Integrantã¨è¨€ã†ã‚ˆã‚Šã‚‚é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ã‚¤ãƒ‡ã‚£ã‚ªãƒ .

> Only constants should be global.

å®šæ•°ã®ã¿ãŒå‚ç…§å¯èƒ½ã§ã‚ã‚ŠçŠ¶æ…‹ã¯éš ã•ã‚Œã¦ã„ã‚‹ã¨ã„ã†è€ƒãˆ(debugé™¤ã).


### ğŸ’¡è€ƒå¯Ÿ: Java Command Patternã‹ã‚‰ã®ã‚¢ãƒŠãƒ­ã‚¸ãƒ¼ {#b0b70e}

ã‚¯ãƒ©ã‚¹ã¨ã„ã†ã‚‚ã®ã‚’å˜ãªã‚‹æŠ½è±¡ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨æ‰ãˆã‚‹ã¨, ã‚¯ãƒ©ã‚¹ã«ã¯å±æ€§ã¨ã—ã¦ã®å€¤ã¨é–¢æ•°å€¤ã®é›†åˆã§ã‚ã‚Š, ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯ãã‚Œã‚’ãƒ¡ãƒ¢ãƒªä¸Šã«é ˜åŸŸç¢ºä¿ã—ãŸçŠ¶æ…‹.

ig/init-keyã§ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯å€¤ã¨ãã®åˆæœŸåŒ–é–¢æ•°ã®pairã®bindingã§ã‚ã‚Š, ig/init-keyã§å®šç¾©ã—ãŸpairã®é›†åˆã‚’ig/initã§ã¾ã¨ã‚ã¦åˆæœŸåŒ–ã—ã¦ã„ã‚‹.

ãã†ã™ã‚‹ã¨, ig/init-keyã§åˆæœŸåŒ–ã—ãŸãã‚Œãã‚Œã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ï¼‘ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã« bindingã—ã¦ç®¡ç†ã—ã¦ã„ã‚‹ã‚ˆã†ã«ã‚‚ã¿ãˆã‚‹. ç®¡ç†ã¨ã„ã†ã“ã¨ã§, suspend, resume, haltã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ [Command Pattern]({{< relref "20220309184220.md#6526189d-1a5c-47ae-8423-506a65a6898c" >}}) ã§æ‰±ã†ã‚ˆã†ãªã‚‚ã®ã¨ã—ã¦æ‰ãˆã‚Œã°ç´å¾—ãŒã„ã.

(ã‚¢ãƒŠãƒ­ã‚¸ãƒ¼ã¨ã—ã¦é¡æ¨ã—ãŸã ã‘ã§å®Ÿè£…ã‚’èª­ã‚“ã§ã¯ãªã„...å¾Œã§èª­ã‚€).


### ğŸ’¡è€ƒå¯Ÿ: Integrant Rationale cf. Component {#9e9e28}

Clojure Component ã®ä»£æ›¿ã‚’æ„è­˜ã—ã¦, ã¨ãã«ComponentãŒä¾å­˜é–¢ä¿‚ã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒ å†…(Clojure Source Code)ã§ç®¡ç†ã™ã‚‹ãŒ, Integrantã¯EDNã§ç®¡ç†ã™ã‚‹ã¨ã“ã‚ãŒã“ã ã‚ã‚Šãƒã‚¤ãƒ³ãƒˆ.

ã™ãªã‚ã¡Integrantã¯Clojure Mapã§ã‚‚EDNã§ã‚‚ã©ã¡ã‚‰ã§ã‚‚æ§‹æˆå®šç¾©ã§ãã‚‹ãŒ, è¨­è¨ˆå‹•æ©Ÿã‹ã‚‰ã„ãˆã°EDNã¤ã‹ãˆã‚ˆï¼ã¨ã„ã†ã“ã¨ã‹ãªï¼Ÿ


### ğŸ’¡è€ƒå¯Ÿ: Component/Mountã¨Integrantã®æ±ºå®šçš„é•ã„ã¯OOP vs FP {#7110ebb1-ddd0-414a-9250-5d3c8d0a07ee}

Componentã‚„Mountã‚’ä½¿ã£ãŸã“ã¨ãŒãªã„ã®ã§ä»¥ä¸‹ã¯ãƒªãƒ³ã‚¯å…ˆã‹ã‚‰ã®ç†è§£.

[Integrant: an alternative to Component and Mount : Clojure](https://www.reddit.com/r/Clojure/comments/5gvhi2/integrant_an_alternative_to_component_and_mount/)

Componentã‚„Mountã¯çŠ¶æ…‹ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å‚ç…§ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§, é–¢æ•°ã®å¼•æ•°ã¨ã—ã¦ã‚‚ã‚‰ã†å¿…è¦ãŒãªã„.

Integrantã¯çŠ¶æ…‹ãŒãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¸­ã«éš ã•ã‚Œã¦ã„ã¦è‡ªç”±ã«å‚ç…§ã§ããªã„. ãã®ãŸã‚ãã®çŠ¶æ…‹ã«å¯¾ã™ã‚‹æ“ä½œã¯é–¢æ•°ã®å¼•æ•°ã¨ã—ã¦ã‚‚ã‚‰ã£ã¦å¤‰åŒ–ã—ãŸå€¤ã‚’è¿”ã™ã‚ˆã†ã«æ›¸ã. ã¾ãŸã¯handlerã®å®šç¾©ã¨ã—ã¦çŠ¶æ…‹ã¨ãã‚Œã«å¯¾ã™ã‚‹æ“ä½œã‚’1ã¤ã«bindingã™ã‚‹.

Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãªã‚‰ãŸãã•ã‚“ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’è¦‹ãªãŒã‚‰è‡ªç„¶ã¨ã“ã®åˆæœŸåŒ–ã§çŠ¶æ…‹ã¨é–¢æ•°ã‚’handlerã¨ã—ã¦bindingã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ãˆã°ã„ã„ã‚‚ã®ã®, webã¨ã¯é–¢ä¿‚ãªãå˜ã«integrantã‚’ä½¿ãŠã†ã¨ã—ãŸã¨ã, ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãŒãªã„ã®ã§è‡ªåˆ†ã®æµå„€ã§å®Ÿè£…ã—ãŒã¡, æœ¬è³ªã‚’è€ƒãˆã‚ˆã†.

åˆæœŸåŒ–æ™‚ã«è‡ªå‰ã§namespaceã«atomã«ä¿å­˜ã—ã¦ãŠãæ–¹æ³•ã¯ãã‚‚ãã‚‚ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹è€ƒãˆã«åã™ã‚‹ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³.

Integrantã¯é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°(FP)ã®è€ƒãˆã«è¿‘ã„. ä¸€æ–¹Componentã®è€ƒãˆã¯ã‚¯ãƒ©ã‚¹ã‚„OOPã«è¿‘ã„.

ã¨ãã«FPã§ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹ã¨å†ªç­‰æ€§ã‚’ç²å¾—ã™ã‚‹ã“ã¨ãŒã§ã, ã“ã‚ŒãŒé–‹ç™ºæ™‚ã«ã¨ãã«å½¹ã«ç«‹ã¤(cf. [Reloaded Workflow]({{< relref "20220117205249.md#7e942a1e-481a-4f5d-8c0d-1edd44da93df" >}})). Componentã¯è‡ªåˆ†ãŒåˆæœŸåŒ–æ¸ˆã¿ã‹ã©ã†ã‹ã¯Componentè‡ªèº«ã—ã‹ã‚ã‹ã‚‰ãªã„.

-   [Componentã¨Integrantã®é•ã„ - ayato-p](https://scrapbox.io/ayato-p/Component%E3%81%A8Integrant%E3%81%AE%E9%81%95%E3%81%84)
    -   <https://twitter.com/athos0220/status/931003506638458882>


### ğŸ’¡Integrantã¨Ring Handlerã®2ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ {#c99333}

-   refs:
    -   [Integrantã§Ringãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ã©ã†æ‰±ã†ã‹ - ayato-p](https://scrapbox.io/ayato-p/Integrant%E3%81%A7Ring%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%E3%83%BC%E3%82%92%E3%81%A9%E3%81%86%E6%89%B1%E3%81%86%E3%81%8B)
    -   [Passing dependencies into ring handlers ... on request map, or \`partial\`ed into the handler?](https://clojureverse.org/t/passing-dependencies-into-ring-handlers-on-request-map-or-partial-ed-into-the-handler/8540)

2ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã‚‹.

-   ã™ã¹ã¦ã®Ringãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æ‰±ã†.
-   ãƒ«ãƒ¼ã‚¿ãƒ¼éƒ¨åˆ†ã¾ã§ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã—ã¦ã€Ringãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã¯ãŸã ã®é–¢æ•°ã¨ã—ã¦æ‰±ã†.

[Component/Mountã¨Integrantã®æ±ºå®šçš„é•ã„ã¯OOP vs FP](#7110ebb1-ddd0-414a-9250-5d3c8d0a07ee) ã®è­°è«–ã«ä¼¼ã¦ã„ã‚‹.


### ğŸ’¡ãªãœintegrantã‚’ã¤ã‹ã†ã®ã‹? {#8660a8}

ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã«ã¯ï¼“ç‚¹ã®ç†ç”±ã‹è¿°ã¹ã‚‰ã‚Œã¦ã„ã‚‹.

ref. [Why bother with Integrant? - quanttype](https://quanttype.net/posts/2020-11-15-why-use-integrant.html)

-   Correct start-up and shut-down orde.
-   Starting a partial system.
-   Good for REPL-driven and test-driven workflows.

å€‹äººçš„ã«ã¯[Integrant-REPL](#672fb670-7d22-4312-99af-767d6f8b3528)ã®ã‚³ãƒ³ãƒœã«ã‚ˆã‚‹[Reloaded Workflow]({{< relref "20220117205249.md#7e942a1e-481a-4f5d-8c0d-1edd44da93df" >}})ã®éƒ¨åˆ†ãŒå¤§ãã„ãŒ, è‹¥å¹²è¨˜æ³•ã‚’è¦šãˆãªã„ã¨ã„ã‘ãªã„ç…©ã‚ã—ã•ãŒã‚ã‚‹ã®ãŒå«Œã‹ã‚‚ã—ã‚Œãªã„.

æ€æƒ³çš„ã«ã‚ã¾ã‚Šatomã‚’å¤šç”¨ã™ã‚‹ã‚ˆã†ãªæ„Ÿã˜ã«æ›¸ã‘ãªã„(éƒ¨åˆ†çš„ã«ã¯æ›¸ã„ã¦ã‚‹ãŒã“ã‚Œã§ã„ã„ã®ã‹ãªã¨é•å’Œæ„ŸãŒã‚ã‚‹...). ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦[Global Storage](#e54de604-3bac-4561-a12c-8cad34bf8ee9)çš„ãªã‚‚ã®ã«ãƒãƒ©ãƒãƒ©ã«æ•£ã‚‰ã°ã‚‹çŠ¶æ…‹ã‚’å…¨éƒ¨ã‚’é–‰ã˜è¾¼ã‚ã¦restartã§ãã‚Œã°ãã‚ŒãŒç†æƒ³ãªã®ã . ç¾å®Ÿã¯é¢å€’.


### ğŸ’¡ig/init-keyã®ç¬¬ä¸€å¼•æ•°ã¯ãªã«? {#db0f93}

ã„ã¤ã‚‚ _ ã¨ãªã£ã¦çœç•¥ã•ã‚Œã¦ã„ã‚‹ã‚„ã¤. ã“ã“ã«ã¯keyãŒå…¥ã£ã¦ãã‚‹. debug printã™ã‚‹ã¨init-keyã®éš£ã«ã‚ã‚‹ ::xxx ãŒå…¥ã£ã¦ãã‚‹.

ãŸã„ã¦ã„ã®å ´åˆã¯ _ ã§æ§‹ã‚ãªã„.

integrantã®README.md,ã§ã¯resume-keyã®ä¸­ã§åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹. resume-keyã®ä¸­ã§ã•ã‚‰ã«integrantã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã¨ãã«ã¤ã‹ã†.


## <span class="org-todo todo _">ğŸ”—</span> References {#d95867}

-   [Enter Integrant: A Micro-framework for Data-Driven Architecture (James Reeves, 2017) - YouTube](https://www.youtube.com/watch?v=tiWTpp_DPIQ&t=2276s)
    -   ä½œè€…ã«ã‚ˆã‚‹ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å‹•ç”».
-   [Integrantå…¥é–€(1) - Integrantã®åŸºæœ¬ - ayato-p](https://scrapbox.io/ayato-p/Integrant%E5%85%A5%E9%96%80(1)_-_Integrant%E3%81%AE%E5%9F%BA%E6%9C%AC)
-   [ã¯ã˜ã‚ã¦ã®Duct - Uzabase Tech](https://tech.uzabase.com/entry/2018/04/03/115236)
    -   integrantã«ã¤ã„ã¦ã‚‚æ›¸ã‹ã‚Œã¦ã‚‹.
