+++
title = "ğŸ“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³(POSA)"
lastmod = 2022-10-23T15:51:51+09:00
tags = ["WIKI"]
draft = false
+++

-   up: [ğŸ“‚ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢è¨­è¨ˆ]({{< relref "20220220102258.md" >}})

Pattern Oriented Software Architectureã«ã¤ã„ã¦.


## ğŸ“šã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ - ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã®ãŸã‚ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ä½“ç³»(POSA-1) {#e77f6f6d-b331-47d3-a168-ed9e4c60fbe7}

-   title: ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£â€•ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã®ãŸã‚ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ä½“ç³»
-   url: <http://www.amazon.co.jp/exec/obidos/ASIN/4764902834/asakichy-22/>
-   notes.
    -   ä¼šç¤¾ã®å›³æ›¸é¤¨ã«ã‚ã£ãŸ.


### æ··æ²Œã‹ã‚‰æ§‹é€ ã¸ {#04a41b}

è¤‡é›‘ã«ãªã‚ŠãŒã¡ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®æ§‹é€ ã‚’æ•´ç†ã—ã¦ã€Œåˆ†å‰²ã—ã¦çµ±æ²»ã€ã™ã‚‹ãŸã‚ã®ãƒ‘ã‚¿ãƒ¼ãƒ³.


#### Layers {#87bfda}

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¤‡æ•°ã®"å±¤"ã«åˆ†ã‘, ãã‚Œã‚‰ã‚’ç‹¬ç«‹ã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦é–‹ç™ºãƒ»ä¿å®ˆã™ã‚‹. å„å±¤ã¯ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã•ã‚ŒãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã‚ã‚Š, ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã®é€²æ­©ã‚„è¦æ±‚ã®å¤‰åŒ–ã«åˆã‚ã›ã¦å„å±¤ã‚’å€‹åˆ¥ã«ç½®æ›ã§ãã‚‹.

-   [å¤šå±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ - Wikipedia](http://ja.wikipedia.org/wiki/%E5%A4%9A%E5%B1%A4%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3)

åˆ†å‰²ãŒå¿…è¦ãªå¤§è¦æ¨¡ãªã‚·ã‚¹ãƒ†ãƒ ãŒå‰æ. å°è¦æ¨¡ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã„ã‚‰ãªã„.

-   [å…«è§’ç ”ç©¶æ‰€ : POSA æœ¬ã§ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‹‰å¼·ã—ã‚ˆã† Layers](http://www.hakkaku.net/articles/20080630-227)

<!--list-separator-->

-  ç‰¹å¾´

    -   éš£æ¥ã—ãªã„ãƒ¬ã‚¤ãƒ¤ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¦æ­¢
    -   ç‰‡æ–¹å‘ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯.

<!--list-separator-->

-  ãƒ¡ãƒªãƒƒãƒˆ

    1.  å¤‰æ›´ãŒå±€æ‰€åŒ–ã•ã‚Œã‚‹ãŸã‚ä¿å®ˆæ€§ãŒå‘ä¸Šã™ã‚‹,
    2.  æŠ½è±¡åº¦ã®ä½ã„ä¸‹ä½ãƒ¬ã‚¤ãƒ¤ã¯, ã•ã¾ã–ã¾ãªã‚·ã‚¹ãƒ†ãƒ ã§å†åˆ©ç”¨ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
    3.  ãƒ¬ã‚¤ãƒ¤é–“ã®ã‚„ã‚Šå–ã‚ŠãŒæ¨™æº–åŒ–ã•ã‚Œã¦ã„ã‚‹å ´åˆ, ãƒ¬ã‚¤ãƒ¤ã‚’äº¤æ›ã™ã‚‹ã“ã¨ãŒå®¹æ˜“ã«ãªã‚‹


#### Pipes and Filters {#d3cd65}


#### lackboard {#fdbedf}


### åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ  {#98489e}

åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ ã‚’é–‹ç™ºã™ã‚‹ä¸Šã§æœ‰åŠ¹ãªãƒ‘ã‚¿ãƒ¼ãƒ³.


#### Broker {#8f794b}


### å¯¾è©±å‹ã‚·ã‚¹ãƒ†ãƒ  {#160f33}

äººã¨ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®å¯¾è©± (ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚·ã‚¹ãƒ†ãƒ ã®å¯¾è©±) ã‚’æä¾›ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§æœ‰åŠ¹ãªãƒ‘ã‚¿ãƒ¼ãƒ³


#### Model-View-Controller {#e7c7db}

-   [MVC ã«ã¤ã„ã¦è€ƒãˆã‚‹ | KRAY Inc](http://kray.jp/blog/think_about_mvc/#)


#### Presentation-Abstraction-Control {#6eebac}


### é©åˆå‹ã‚·ã‚¹ãƒ†ãƒ  {#3d24c9}

ç’°å¢ƒã®å¤‰åŒ–ã‚„æ©Ÿèƒ½è¦æ±‚ã®å¤‰åŒ–ã«ã‚ˆã‚‹ä¸­æ ¸æ©Ÿèƒ½ã¸ã®å½±éŸ¿ã‚’æŠ‘ãˆã‚‹ãŸã‚ã«æœ‰åŠ¹ãªãƒ‘ã‚¿ãƒ¼ãƒ³.


#### Microkernel {#12677e}


#### Reflection {#aea1e4}


### References {#d95867}

-   [POSA ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ - Strategic Choice](http://d.hatena.ne.jp/asakichy/20090602/1243900715)
-   [ç¬¬ 2 å› ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯ä½•ã‹ | Think IT](http://thinkit.co.jp/article/940/1)


## ğŸ“šPattern-Oriented Software Architecture: Patterns for Concurrent and Networked Objects(POSA-2) {#885d9664-2ad1-40ad-9b70-2f9af2a863d9}

[ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘è¨­è¨ˆã¨ä¸¦åˆ—ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’Andoirdã§å­¦ã¶ï¼Pattern-Oriented Software Architecturesã‚’å—ã‘ãŸ | Futurismo](https://futurismo.biz/archives/2527/)

Doug å…ˆç”Ÿ, æ¸¾èº«ã®è‘—ä½œ! ãªãã® PDF ç¾¤.

-   [Index of /~schmidt/PDF](http://www.dre.vanderbilt.edu/~schmidt/PDF/)

ã¨ã¦ã‚‚å‚è€ƒã«ãªã‚‹ãƒªãƒ³ã‚¯. POSA2.

-   [Pattern-Oriented Software Architecture: Patterns for Concurrent and Networked Objects](http://www.dre.vanderbilt.edu/~schmidt/POSA/POSA2/)


### Service Access and Configuration Patterns {#02c519}


#### Wrapper Facade {#db3ac2}

[Wrapper Facade Pattern ã«ã¤ã„ã¦èª¿ã¹ã¦ã¿ãŸã¾ã¨ã‚ | Futurismo](https://futurismo.biz/archives/2613/)

ã‚½ã‚±ãƒƒãƒˆãªã©ã® OS ã«ä¾å­˜ã™ã‚‹ã‚ˆã†ãª native methods ã«å¯¾ã—ã¦ãƒ©ãƒƒãƒ‘ãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½œæˆã™ã‚‹ã“ã¨.

```language
encapsulate low-level functions and data
structures with object-oriented (OO) class interfaces.
```

ä»¥ä¸‹ã®ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚‹.

-   Non-OOP è¨€èªãŒ OOP ã§åˆ©ç”¨ã§ããŸã‚Š (Type-safe I/F)
-   OS ä¾å­˜ãŒãªããªã£ãŸã‚Š, (Portable)
-   ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã‚¨ãƒ©ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹æ©Ÿèƒ½ã‚’ä½œã‚Šè¾¼ã‚“ã ã‚Šã—ã¦,API error-prone (èª¤ã‚ŠãŒã¡ãª) ã‚’é˜²ã.

Facade ã‚„ Bridge ã¨ç•°ãªã‚Š, è–„ã, Light weight ãªå®Ÿè£…ã§ã‚ªãƒ¼ãƒãƒ˜ãƒƒãƒ‰ãŒãªã„ã“ã¨ãŒç‰¹å¾´.

coursera ã® posa è¬›ç¾©ã§å‡ºã¦ããŸãƒ‘ã‚¿ãƒ¼ãƒ³. Doug æ° ã®è«–æ–‡.

-   <http://www.cs.wustl.edu/~schmidt/PDF/wrapper-facade.pdf>

è¨€èªãƒ¬ãƒ™ãƒ«ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒå¤šã„? Ruby ã® Socket Library ãŒã‚ˆã„ä¾‹. bind ã‚„ listen ã‚’ TCPServer ãƒ¡ã‚½ãƒƒãƒ‰ã§éš ã—ã¦ã„ã‚‹.

```ruby
server = TCPServer.new (4481)

# =>
server = Socket.new (:INET, :STREAM)
addr = Socket.pack_sockaddr_in (4481, "0.0.0.0")
server.bind (addr)
server.listen (5)
```


#### Component Configurator {#7e8f37}


#### Interceptor {#06050a}


#### Extension Interface {#e48735}


### Event Handling Patterns {#be68d3}


#### Reactor (Evented) {#0595f9}

[Reactor Pattern ã«ã¤ã„ã¦èª¿ã¹ã¦ã¿ãŸã¾ã¨ã‚ | Futurismo](https://futurismo.biz/archives/2616/)

ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã®ãŸã‚ã®ãƒ‘ã‚¿ãƒ¼ãƒ³. åŒæœŸçš„ãªã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†.

```language
The reactor design pattern is an event handling pattern
for handling service requests delivered concurrently
to a service handler by one or more inputs.
```

-   [Reactor pattern - Wikipedia, the free encyclopedia](http://en.wikipedia.org/wiki/Reactor_pattern)

Networking ã§åˆ©ç”¨ã•ã‚Œã‚‹ Reactor ã¯, select ã‚’ä½¿ã£ãŸç‹­ç¾©ã® Reactor Pattern.

<!--list-separator-->

-  ç‰¹å¾´

    ã‚¤ãƒ™ãƒ³ãƒˆ (å…¥åŠ›ãƒ‡ãƒ¼ã‚¿) ã‚’,å‡¦ç†ã‚„çŠ¶æ…‹ã‚’è¡¨ã™ãƒãƒ³ãƒ‰ãƒ© (ãƒ¡ã‚½ãƒƒãƒ‰ or ã‚µãƒ–ã‚¯ãƒ©ã‚¹) ã«ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒ (çµã³ã¤ã‘ã‚‹) ã™ã‚‹.

    ãƒãƒ³ãƒ‰ãƒ©ã”ã¨ã«è²¬å‹™ã‚’åˆ†å‰²ã§ãã‚‹ã®ã§ OOP å‘ã.

    EventMachine ã¯ Reactor ãƒ‘ã‚¿ãƒ¼ãƒ³ã®é«˜æ€§èƒ½ãªå®Ÿè£…ã•.

    -   [è¦‹ãˆãªã„ãƒã‚«ãƒ©: ã€ç¿»è¨³ã€‘ EventMachine å…¥é–€](http://keijinsonyaban.blogspot.jp/2010/12/eventmachine.html)

    Android ã¯çŠ¶æ…‹ã”ã¨ã«ãƒãƒ³ãƒ‰ãƒ©ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹.

    -   onCreate ()
    -   onResume ()
    -   onDestory ()

    Spring Framework ã§ã¯, GET ã‚„ POST ã® HTTP request ã¯,
    ãã‚Œãã‚Œå¯¾å¿œã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã•ã‚Œã‚‹.

<!--list-separator-->

-  Structure

    -   Resources: å…¥åŠ›ãƒ‡ãƒ¼ã‚¿
    -   Synchronous Event Demultiplexer:å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’æ‹¾ã†ãŸã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—.
        -   ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§ loop ã—ã¦ã„ã‚‹ã“ã¨ãŒç‰¹å¾´ (Synchronous).
        -   Dispatcher: ãƒãƒ³ãƒ‰ãƒ©ã‚’ç®¡ç†ã™ã‚‹. Demultiplexer ã‹ã‚‰é€šçŸ¥ã‚’å—ã‘ãŸã‚‰,
            -   Resource ã‚’ Handler ã« Dispatch ã™ã‚‹ (select ãªã©)
        -   Handler: Resource ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸå‡¦ç†.

<!--list-separator-->

-  References

    -   [Architecture of a Highly Scalable NIO-Based Server | Java.net](https://today.java.net/article/2007/02/08/architecture-highly-scalable-nio-based-server)
    -   [Tech Stuff: Reactor Pattern Explained - Part 1](http://jeewanthad.blogspot.jp/2013/02/reactor-pattern-explained-part-1.html)
    -   [NIO-based Reactor | Genuine Blog](http://blog.genuine.com/2013/07/nio-based-reactor/)
    -   <http://gee.cs.oswego.edu/dl/cpjslides/nio.pdf>


#### Proactor {#439966}

éåŒæœŸãªã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†.

-   [Proactor pattern - Wikipedia, the free encyclopedia](http://en.wikipedia.org/wiki/Proactor_pattern)

POSIX ã® aio ã‚’åˆ©ç”¨ã—ã¦å®Ÿç¾ã™ã‚‹.

-   [Man page of AIO](http://linuxjm.sourceforge.jp/html/LDP_man-pages/man7/aio.7.html)

éåŒæœŸã« I/O æ“ä½œã‚’å®Ÿæ–½ã—ã¦, çµ‚äº†æ™‚ã«ã¯ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§é€šçŸ¥ã‚’å—ã‘å–ã‚‹. Non-Blocking.

<!--list-separator-->

-  Reactor ã¨ Proactor ã®é•ã„

    ã“ã“ãŒ ã‚‚ã¨ãƒã‚¿.

    -   [Comparing Two High-Performance I/O Design Patterns](http://www.artima.com/articles/io_design_patterns2.html)

    æ—¥æœ¬èªã®è§£èª¬: [C++ vs. Java vs. C#ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ - äº•ä¸Š](http://dev.ariel-networks.com/blog/inoue.php?itemid=705)

    Reactor ãƒ‘ã‚¿ãƒ¼ãƒ³

    select (2) or poll (2) ã§ã‚½ã‚±ãƒƒãƒˆã®ç›£è¦–ã‚’ã—ã¦, non-blocking ãªrecv (2), send (2) ã§é€å—ä¿¡ã—ã¾ã™.

    ã‚½ã‚±ãƒƒãƒˆãŒèª­ã¿æ›¸ãã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¾ã§ã‚«ãƒ¼ãƒãƒ«ã§å¾…æ©Ÿã—ã¦, èª­ã¿æ›¸ãã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¨ãƒ¦ãƒ¼ã‚¶ã‚¢ãƒ—ãƒªã«åˆ¶å¾¡ãŒæ¥ã¾ã™. ãƒ¦ãƒ¼ã‚¶ã‚¢ãƒ—ãƒªã¯recv ã§èª­ã¿è¾¼ã‚“ã ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒãƒ•ã‚¡ã«ã‚³ãƒ”ãƒ¼ (èª­ã¿è¾¼ã¿æ™‚) ã™ã‚‹ã‹, ãƒãƒƒãƒ•ã‚¡ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚“ã§ send ã‚’å‘¼ã³ã¾ã™. å®Ÿéš›ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã¸ã®ãƒ‡ãƒ¼ã‚¿é€å—ä¿¡ã¯, ã‚«ãƒ¼ãƒãƒ«ã®ä»•äº‹ã§ã™.

    ---

    Proactor ãƒ‘ã‚¿ãƒ¼ãƒ³

    éåŒæœŸ IO ã® API (aio_ã® prefix ã®ä»˜ã„ãŸ API) ã§é€å—ä¿¡ã—ã¾ã™. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®é€å—ä¿¡ãŒå®Œäº†ã—ãŸæ™‚ç‚¹ã§, ã‚«ãƒ¼ãƒãƒ«ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ã‚¢ãƒ—ãƒªã«åˆ¶å¾¡ãŒæ¥ã¾ã™. èª­ã¿è¾¼ã¿ã®å ´åˆ, ãƒãƒƒãƒ•ã‚¡ã«èª­ã¿è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ãŒæ—¢ã«å…¥ã£ã¦ã„ã‚‹ã®ã§, ãƒ¦ãƒ¼ã‚¶ã‚¢ãƒ—ãƒªã¯ãã‚Œã‚’ä½¿ãˆã¾ã™.

    ---

    <http://subtech.g.hatena.ne.jp/mala/20090920/1253447692>

    ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€å ´åˆã ã¨

    -   Reactor ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯ã€Œ writable ã«ãªã‚‹ã®ã‚’å¾…ã¤, æ›¸ãè¾¼ã‚ã‚‹ã ã‘æ›¸ãè¾¼ã‚€ã€ã¨ã„ã†ã®ã‚’å…¨ã¦ã®æ›¸ãè¾¼ã¿ãŒçµ‚ã‚ã‚‹ã¾ã§ç¹°ã‚Šè¿”ã—ã¾ã™.
    -   Proactor ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯, ã‚«ãƒ¼ãƒãƒ«ã«è»¢é€ã‚’ä»»ã›ã¦, è»¢é€ãŒå®Œäº†ã—ãŸæ™‚ç‚¹ã§ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ã¾ã™.

    æ¥µç«¯ãªè©±, 1byte ãšã¤ã—ã‹ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚Œãªã„ãƒ‡ãƒã‚¤ã‚¹ãŒã‚ã£ãŸã¨ã—ã¦

    -   Reactor ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ 1MB é€ã‚ã†ã¨ã—ãŸå ´åˆ, 100 ä¸‡å› (100 ä¸‡ \* n)
        ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚¤ãƒƒãƒãŒç™ºç”Ÿã™ã‚‹.
    -   Proactor ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å ´åˆã¯, ã‚«ãƒ¼ãƒãƒ«ã« 1MB ã®ãƒ‡ãƒ¼ã‚¿ã‚’é€ã£ã¦ãŠã„ã¦,
        ã¨ä¾é ¼ã—ã¦çµ‚ã‚ã£ãŸã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã«å‡¦ç†ãŒæˆ»ã‚‹. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚¤ãƒƒãƒã¯æœ€å°é™ã§æ¸ˆã¿ã¾ã™.

    ã©ã¡ã‚‰ãŒå„ªã‚Œã¦ã„ã‚‹ã‹?

    -   ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã¨ã‚«ãƒ¼ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚¤ãƒƒãƒã®ã‚³ã‚¹ãƒˆ.
    -   åŠ ãˆã¦: ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ãƒ¢ãƒ‡ãƒ«ã§æ›¸ã„ã¦ã„ã‚‹å ´åˆã¯, é–¢æ•°å‘¼ã³å‡ºã—ã®ã‚³ã‚¹ãƒˆ.
    -   åŠ ãˆã¦: ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ¢ãƒ‡ãƒ«ã§æ›¸ã„ã¦ã„ã‚‹å ´åˆã¯, ã‚¹ãƒ¬ãƒƒãƒ‰ or è»½é‡ã‚¹ãƒ¬ãƒƒãƒ‰ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚¤ãƒƒãƒã®ã‚³ã‚¹ãƒˆ.

    ãŒ, ç™ºç”Ÿã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™.
    ã“ã®ã‚³ã‚¹ãƒˆãŒç„¡è¦–ã§ããªã„ã»ã©å¤§ãã„å ´åˆ, Proactor ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å„ªä½æ€§ãŒå¤§ãããªã‚‹, ã¨ã„ã†ã“ã¨ã«ãªã‚‹ã§ã—ã‚‡ã†.

    -   StackOverflow: [java - reactor vs proactor - Stack Overflow](http://stackoverflow.com/questions/11859332/reactor-vs-proactor)
    -   ã‚ã‹ã‚Šã‚„ã™ã„ PDF paper: [Event-driven I/O paper - Marc's Blog](http://blog.marc-seeger.de/2010/08/01/event-driven-i-o-paper/)

    The main difference between reactor and
    proactor is the way they do the actual write/read.

    -   the reactor is only being signalled when the socket is ready to
        write/read and then does.the reading/writing itself in a
        synchronous manor
    -   the proactor will use an asynchronous I/O call to the operating
        system and only supply the buffers to read from/write to.read
        from/write to.


#### Asynchronous Completion Token {#0d3056}


#### Acceptor-Connector {#bdce63}

é€šä¿¡ã®åˆæœŸåŒ–å‡¦ç†ã¨å®Ÿéš›ã®å‡¦ç†ã‚’åˆ†é›¢ã™ã‚‹ã“ã¨ã§, æ§‹é€ ã‚’æ•´ç†ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³.

Reactor Pattern ã«ãŠã„ã¦, Handler ã¨ Reactor ã®ä»²ä»‹ã‚’è¡Œã†. Handler ã« Dispatch ã™ã‚‹å‰ã«, ä¸€é€£ã®æ‰‹ç¶šããŒå¿…è¦ãªå ´åˆã«ã¯,

-   Acceptor ãŒ Handler ã«å¯¾ã—ã¦æ‰‹ç¶šãã‚’å®Ÿæ–½ã—ã¦ã‹ã‚‰ (Accept)
-   Reactor ã‹ã‚‰ Handler ã¸ã® Dispatch ã‚’ã•ã›ã‚‹ (Connect)

Acceptor ãŒã‚µãƒ¼ãƒå´ã®ä»²ä»‹è€…, Connector ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ä»²ä»‹è€….

ã‚¯ãƒ©ã‚¹å›³çš„ã«ã¯,EventHandler ã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã«  Handler ã‚„ Acceptor, Connector ãŒã„ã‚‹.

EventHandler

-   CifsAcceptor
    -   negotiate
    -   session
-   CifsHandler
    -   read
    -   write
-   CifsConnector
    -   negotiate
    -   session


### Synchronization Patterns {#39c150}


#### Scoped Locking {#f0da5b}

ã‚¯ãƒ©ã‚¹ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¦ lock ã—ã¦,ãƒ‡ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ Unlock ã™ã‚‹.


#### Strategized Locking {#d9be83}


#### Thread-Safe Interface {#43be6b}


#### Double-checked locking {#1bd1ba}

ãƒ­ãƒƒã‚¯ã®å–å¾—ã«ãŠã‘ã‚‹ã‚ªãƒ¼ãƒãƒ˜ãƒƒãƒ‰ã‚’å‰Šæ¸›ã™ã‚‹ãŸã‚ã®æŠ€æ³•. ã¾ãšã‚’ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ã§ãªã„æ–¹æ³•ã§ã€Œãƒ­ãƒƒã‚¯ãƒ’ãƒ³ãƒˆã€ã‚’èª¿ã¹ã¦, ãã‚ŒãŒæˆåŠŸã—ãŸã‚‰å®Ÿéš›ã®ãƒ­ãƒƒã‚¯ã‚’è©¦ã¿ã‚‹.


### Concurrency Patterns {#d99571}


#### Active Object (Actor) {#5bc4b1}

ãƒ¡ã‚½ãƒƒãƒ‰ã®å‘¼ã³å‡ºã—ã¨ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿéš›ã®å®Ÿè¡Œã‚’åˆ†é›¢ã™ã‚‹ã“ã¨ã§ä¸¦è¡Œæ€§ã‚’å°å…¥ã™ã‚‹.
å„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯åˆ©ç”¨è€…ã‹ã‚‰ã®è¦æ±‚ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã¨ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã‚’æŒã¤.

å¤–éƒ¨ã® Client ã‚¹ãƒ¬ãƒƒãƒ‰ã‹ã‚‰éåŒæœŸã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã£ã¦ã‚‚, è‡ªåˆ†å›ºæœ‰ã® Active Object ã‚¹ãƒ¬ãƒƒãƒ‰ã§, è‡ªåˆ†ã®éƒ½åˆã®ã„ã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å‡¦ç†ã‚’å®Ÿè¡Œã•ã›ãŸã„å ´åˆã«åˆ©ç”¨ã™ã‚‹.

èµ·å‹• (invocation) ã¨å®Ÿè¡Œ (execution) ã®åˆ†é›¢.

> Active Object defines units of concurrency as service requests
> on components & runs service requests on a component in a different
> thread from the requesting client thread.

<!--list-separator-->

-  ä»–ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã®é–¢ä¿‚

    Acceptor-Connector / Reactor

    Acceptor-Connector Pattern ã«ãŠã‘ã‚‹ Handler éƒ¨åˆ†ã‚’ã‚¹ãƒ¬ãƒƒãƒ‰åŒ–ã™ã‚Œã°ã‚ˆã„. (i.e. Thread per connection) Reactor ã® Minor Change ã§å®Ÿç¾ã§ãã‚‹.

    ---

    Half-Sync/Half-Async

    Active Object ã¯ã‚¹ãƒ¬ãƒƒãƒ‰/ ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’åˆ†é›¢ã™ã‚‹.
    Half-Sync/Half-Async ã¯, éåŒæœŸãƒ—ãƒ­ã‚»ã‚¹ã¨åŒæœŸãƒ—ãƒ­ã‚»ã‚¹ã‚’åˆ†é›¢ã™ã‚‹.

<!--list-separator-->

-  Sample

    Java ã®ã‚µãƒ³ãƒ—ãƒ«

    -   [Active object - Wikipedia, the free encyclopedia](http://en.wikipedia.org/wiki/Active_object)

    Ruby ã®ã‚µãƒ³ãƒ—ãƒ«

    -   [Blog Alpha Networking: ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ (Active Object ãƒ‘ã‚¿ãƒ¼ãƒ³) Ruby ç·¨](http://alpha-netzilla.blogspot.jp/2010/11/design-pattern.html)
        -   [Ruby ã§ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ 14 #ActiveObject - ãã‚Œãƒã‚°ã§!](http://takuya-1st.hatenablog.jp/entry/20101124/1290573115)


#### Monitor Object {#357897}

æ’ä»–çš„ã«å®Ÿè¡Œã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ãƒ¡ã‚½ãƒƒãƒ‰ç¾¤ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ã«åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®æ©Ÿæ§‹. Java ã¯ã“ã‚Œã‚’è¨€èªãƒ¬ãƒ™ãƒ«ã§ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹.

-   [javax.management.monitor (Java Platform SE 6)](http://docs.oracle.com/javase/jp/6/api/javax/management/monitor/package-summary.html)
-   [Monitor (synchronization) - Wikipedia, the free encyclopedia](http://en.wikipedia.org/wiki/Monitor_(synchronization))
-   [ã‚¹ãƒ¬ãƒƒãƒ‰ã®æ’ä»–åˆ¶å¾¡](http://www.narihiro.info/g1gc-impl-book/lock.html)

Half-Sync/Half-Async Pattern ã¨çµ„ã¿åˆã‚ã›ã¦åˆ©ç”¨ã™ã‚‹ã“ã¨ã§, busy ã®åˆ¶å¾¡ã‚„æš‡ãªæ™‚ã®éåº¦ãªè² è·ã‚’é¿ã‘ã‚‹.


#### Half-Sync/Half-Async {#fbedf8}

éåŒæœŸã‚µãƒ¼ãƒ“ã‚¹ã¨åŒæœŸã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ†é›¢ã™ã‚‹. éåŒæœŸãƒ¬ã‚¤ãƒ¤ã¨åŒæœŸãƒ¬ã‚¤ãƒ¤ã¯ã‚­ãƒ¥ãƒ¼ã§ã¤ãªãŒã£ã¦ã„ã‚‹.

-   <https://www.dre.vanderbilt.edu/~schmidt/PDF/PLoP-95.pdf>

éåŒæœŸå‡¦ç†ã¨åŒæœŸå‡¦ç†ã‚’å…±å­˜ã•ã›ã¦, æ§‹é€ ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ã§ãã‚‹.

```language
The Half-Sync/Half-Async pattern decouples async & sync service processing in concurrent systems, to simplify programming without unduly reducing performance.
```

<!--list-separator-->

-  Example of Networking Programming

    ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ OS ã‚„ GUI Framework ã§åºƒãåˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹.

    OS ä¸Šã§å‹•ããƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯,ã‚½ã‚±ãƒƒãƒˆã« read/write ã™ã‚‹. ã“ã®ã¨ã, ã‚½ã‚±ãƒƒãƒˆãŒã‚­ãƒ¥ãƒ¼ã«ãªã£ã¦, Kernel ãŒç‰©ç† NIC ã¨ã‚„ã‚Šã¨ã‚Šã‚’ã™ã‚‹.

    -   User-Level Processes
        -   Sync User Process 1
        -   Sync User Process 2
        -   Sync User Process 3
    -   Socket Layer
        -   Socket Queues
    -   BSD UNIX Kernel
        -   Async Protocol Processing
        -   NIC

<!--list-separator-->

-  Netty ã«ã‚ˆã‚‹å®Ÿè£…

    å®Œå…¨ã«ã‚ã™ã‚ŒãŸãŒç§ã®å®Ÿè£…?

    -   <http://netty.io/3.6/guide/#faq.4>
    -   <https://gist.github.com/tsu-nera/e30e54a668fdf0195e89>


#### Leader/Followers {#2631a0}

Preforking or Thread Pool å‚ç…§.

äº‹å‰ã« ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œã£ã¦ãŠãã®ã§, ã‚ªãƒ¼ãƒãƒ˜ãƒƒãƒ‰ãŒå°ã•ã„.


#### Thread-specific storage {#b8f8f0}

é™çš„å¤‰æ•°ãƒ»ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®ã‚ˆã†ã«æ‰±ãˆã‚‹ãŒã‚¹ãƒ¬ãƒƒãƒ‰ã”ã¨ã«ç•°ãªã‚‹å†…å®¹ã‚’æ ¼ç´ã§ãã‚‹ãƒ¡ãƒ¢ãƒªé ˜åŸŸã‚’æä¾›ã™ã‚‹.


## POSA-3 {#114423}


## POSA-4 {#ad7dd2}


## POSA-5 {#13372b}


## ğŸ“šJavaè¨€èªã§å­¦ã¶ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³å…¥é–€ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ç·¨ - çµåŸæµ© {#c019b155-60aa-45b1-b2b7-a8e44eb73d6b}

-   [ã€å¢—è£œæ”¹è¨‚ç‰ˆ Java è¨€èªã§å­¦ã¶ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³å…¥é–€ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ç·¨ã€](http://www.hyuki.com/dp/dp2.html)
-   [ruby ã§ã‚„ã£ã¦ã¿ãŸ. ã€å¢—è£œæ”¹è¨‚ç‰ˆ Java è¨€èªã§å­¦ã¶ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³å…¥é–€ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ç·¨ã€ã¾ã¨ã‚ - ãã‚Œãƒã‚°ã§!](http://takuya-1st.hatenablog.jp/entry/20101124/1290573650)


### Single Threaded Execution - ã“ã®æ©‹ã‚’æ¸¡ã‚Œã‚‹ã®ã¯, ãŸã£ãŸä¸€äºº {#fd8ebd}


### Immutable - å£Šã—ãŸãã¨ã‚‚, å£Šã›ãªã„ {#2777cc}


### Guarded suspension {#faf2ef8c-e661-4e5a-863a-267621ac6df0}

å‰ææ¡ä»¶ãŒæº€ãŸã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿã™ã‚‹ãŸã‚ã®æ©Ÿæ§‹. ç”¨æ„ã§ãã‚‹ã¾ã§, å¾…ã£ã¦ã¦ã­.

æº€ãŸã•ã‚Œãªã‘ã‚Œã°ãªã‚‰ãªã„æ¡ä»¶ã‚’ **ã‚¬ãƒ¼ãƒ‰æ¡ä»¶** ã¨ã„ã†.

-   [Guarded suspension - Wikipedia](https://en.wikipedia.org/wiki/Guarded_suspension)
-   [ã€Javaè¨€èªã§å­¦ã¶ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³(ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ç·¨)ã€ã¾ã¨ã‚(ãã®ï¼•) - Qiita](https://qiita.com/yoshi-yoshi/items/427be45a8b0044083911)


### Balking - å¿…è¦ãªã‹ã£ãŸã‚‰, ã‚„ã‚ã¡ã‚ƒãŠã† {#ef5d95}

å‰ææ¡ä»¶ãŒæº€ãŸã•ã‚Œã¦ã„ãªã„å ´åˆã¯, (ãã®æ™‚ç‚¹ã§ã®) å‡¦ç†ã®å®Ÿè¡Œã‚’ã‚ãã‚‰ã‚ã‚‹.


### Producer-Consumer {#ea1cf3}

ã‚¹ãƒ¬ãƒƒãƒ‰é–“ã§å‡¦ç†ã®å¾…ã¡åˆã‚ã›ã‚’è¡Œã„ãªãŒã‚‰å‡¦ç†ã‚’å®Ÿè¡Œã§ãã‚‹.

ã€Œç”Ÿç”£è€…ã€ (producer) ã‚¹ãƒ¬ãƒƒãƒ‰ç¾¤ãŒãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¦ã€Œé€šä¿¡è·¯ã€ã«è¿½åŠ ã—,
ã€Œæ¶ˆè²»è€…ã€ (consumer) ã‚¹ãƒ¬ãƒƒãƒ‰ç¾¤ãŒãã®ãƒ‡ãƒ¼ã‚¿ã‚’ã€Œé€šä¿¡è·¯ã€ã‹ã‚‰å–ã‚Šå‡ºã—ã¦å‡¦ç†ã™ã‚‹ã¨ã„ã†æ§‹é€ .

å¿…è¦ãªåŒæœŸã¯ã™ã¹ã¦ã€Œé€šä¿¡è·¯ã€ã«ã‚ˆã£ã¦è¡Œãªã‚ã‚Œã‚‹ãŸã‚, ç”Ÿç”£è€…ã¨æ¶ˆè²»è€…ã®ãƒ«ãƒ¼ãƒãƒ³ã¯åŒæœŸã‚’æ„è­˜ã›ãšã«å®Ÿè£…ã§ãã‚‹. ã“ã®é€šä¿¡è·¯ã¯åŒæœŸã‚­ãƒ¥ãƒ¼ãªã©ã§å®Ÿç¾ã•ã‚Œã‚‹ (ä¸€éƒ¨ã®è¨€èªã¯ã“ã‚Œã‚’æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§æä¾›ã—ã¦ã„ã‚‹).

Producer ã¨ Consumer ã®å‡¦ç†ã‚¹ãƒ”ãƒ¼ãƒ‰ãŒé•ã†ã¨ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆãŒè½ã¡ã‚‹. ãã“ã§ä¸­ç¶™åœ°ç‚¹ã¨ã—ã¦ã‚­ãƒ¥ãƒ¼ã‚’ãŠã, ãã“ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã•ã›, å‡¦ç†ã‚¹ãƒ”ãƒ¼ãƒ‰ã®é•ã„ã‚’å¸åã•ã›ã‚‹

Java ã§ã¯ wait, notifyAll ã‚’ä½¿ã†.

-   [Java ã§ Producer-Consumer ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè·µ! - omiya6048's blog](http://omiya6048.hatenablog.com/entry/2013/05/29/145253)
-   [Producer â€“ consumer problem - Wikipedia, the free encyclopedia](http://en.wikipedia.org/wiki/Producer%E2%80%93consumer_problem)
-   [Publisher-Subscriber - Strategic Choice](http://d.hatena.ne.jp/asakichy/20090701/1246407927#20090701f1)

POSA ã®èª²é¡Œã§ã¯, BlockingQueue ã‚’åˆ©ç”¨ã—ãŸ.

-   [BlockingQueue (Java Platform SE 6)](http://e-class.center.yuge.ac.jp/jdk_docs/ja/api/java/util/concurrent/BlockingQueue.html)
-   [Java ã§ Producer-Consumer ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè·µ! - omiya6048's blog](http://omiya6048.hatenablog.com/entry/2013/05/29/145253)

Ruby ã®ä¾‹ãŒã‚ã‚‹. Ruby ã§ã¯ ConditionVariable ã® wait, broadcast ã‚’åˆ©ç”¨.

-   [Blog Alpha Networking: ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ (Producer-Consumer ãƒ‘ã‚¿ãƒ¼ãƒ³) Ruby ç·¨](http://alpha-netzilla.blogspot.jp/2010/11/producer-consumer-ruby.html)

---

more. [âš™Producer-Consumerãƒ‘ã‚¿ãƒ¼ãƒ³]({{< relref "20220116195030.md#1e0ae462-5cdf-45d2-82de-ef3587583ff1" >}})


### Read-Write Lock - ã¿ã‚“ãªã§èª­ã‚€ã®ã¯ã„ã„ã‘ã‚Œã©, èª­ã‚“ã§ã‚‹é–“ã¯æ›¸ã„ã¡ã‚ƒã ã‚ {#fccf1e}

æ›¸ãè¾¼ã¿ã¯æ’ä»–ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã ãŒèª­ã¿è¾¼ã¿ã¯ä¸¦è¡Œã«è¡Œãˆã‚‹ã‚ˆã†ã«ã—ãŸã„å ´åˆã®ãŸã‚ã®ãƒ­ãƒƒã‚¯æ©Ÿæ§‹.

æ’ä»–åˆ¶å¾¡ãŒå¿…è¦ãªå…±æœ‰ãƒªã‚½ãƒ¼ã‚¹ã®ãŸã‚ã«å°å…¥ã™ã‚‹.


### Thread-Per-Message - ã“ã®ä»•äº‹, ã‚„ã£ã¨ã„ã¦ã­ {#1ca10c}


### Worker Thread - ä»•äº‹ãŒæ¥ã‚‹ã¾ã§å¾…ã¡, ä»•äº‹ãŒæ¥ãŸã‚‰åƒã {#a1a0ab}


### Future - å¼•æ›åˆ¸ã‚’, ãŠå…ˆã«ã©ã†ã {#76dfb0}

ã€Œå‡¦ç†ãŒå®Œäº†ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹åˆ†ã‹ã‚‰ãªã„å‡¦ç†çµæœã€ã‚’è¡¨ã™ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ã§åŒæœŸã‚’å®Ÿç¾ã™ã‚‹. å‡¦ç†ãŒå®Œäº†ã—ã¦ã„ãªã„ã†ã¡ã«çµæœã‚’å–å¾—ã—ã‚ˆã†ã¨ã—ãŸå ´åˆã¯å‡¦ç†ãŒå®Œäº†ã™ã‚‹ã¾ã§ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹.


### Two-Phase Termination - å¾Œç‰‡ä»˜ã‘ã—ã¦ã‹ã‚‰, ãŠã‚„ã™ã¿ãªã•ã„ {#87a1ca}


### Thread-Specific Storage - ã‚¹ãƒ¬ãƒƒãƒ‰ã”ã¨ã®ã‚³ã‚¤ãƒ³ãƒ­ãƒƒã‚«ãƒ¼ {#7e28e0}


### Active Object - éåŒæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚‹, èƒ½å‹•çš„ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ {#33a38e}


### Lock {#b48516}

ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦ 1 ã¤ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒã€Œãƒ­ãƒƒã‚¯ã€ã‚’ã‹ã‘ã¦, ãã®ã‚ã„ã ä»–ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒãã®ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šå¤‰æ›´ã‚’åŠ ãˆãŸã‚Šã§ããªã„ã‚ˆã†ã«ã™ã‚‹.

-   [Lock Design Pattern](http://www.castle-cadenza.demon.co.uk/lock.htm)


### Scheduler {#ffaac1}

ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç† (ä¾‹ãˆã°ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ›¸ãè¾¼ã¿) ã®å®Ÿè¡Œã‚’å„ã‚¹ãƒ¬ãƒƒãƒ‰ã«è¨±å¯ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’æ˜ç¢ºã«åˆ¶å¾¡ã™ã‚‹.


### Thread pool {#465a87}

å¤šæ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆã—ã¦ãã‚Œã‚‰ã«å¤šæ•°ã®ã‚¿ã‚¹ã‚¯ã‚’å‡¦ç†ã•ã›ã‚‹. å…¸å‹çš„ãªçŠ¶æ³ã§ã¯ã‚¹ãƒ¬ãƒƒãƒ‰æ•°ã‚ˆã‚Šã‚‚ã‹ãªã‚Šå¤šãã®ã‚¿ã‚¹ã‚¯ãŒå­˜åœ¨ã—, å„ã‚¹ãƒ¬ãƒƒãƒ‰ã¯, ã‚ã‚‹ã‚¿ã‚¹ã‚¯ã®å‡¦ç†ãŒçµ‚ã‚ã‚‹ã¨æ¬¡ã®å‡¦ç†å¾…ã¡ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œã«å–ã‚Šã‹ã‹ã‚‹.

ä¸€èˆ¬ã«, Producer-consumer ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ã£ã¦å®Ÿç¾ã•ã‚Œã‚‹.


### Two-phase termination {#499ec6}

ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’å®‰å…¨ã«çµ‚äº†ã•ã›ã‚‹æ–¹æ³•. ã‚¹ãƒ¬ãƒƒãƒ‰ã¯, çµ‚äº†è¦æ±‚ã‚’è¡¨ã™ãƒ•ãƒ©ã‚°ã‚’å®šæœŸçš„ã«ç¢ºèªã—ã¦, ãã‚ŒãŒã‚»ãƒƒãƒˆã•ã‚ŒãŸã‚‰çµ‚äº†å‡¦ç†ã‚’è¡Œã†.


## Network Architecture Patterns {#1eec73}

Working with TCP Sockets ã‹ã‚‰.


### Serial {#5255d3}

-   advantage
    -   Structure is simple.
    -   Resource usage is simple.
-   disadvantage
    -   No concurrency.


### Process per connection {#f3e3fc}

connection ã”ã¨ã« å­ãƒ—ãƒ­ã‚»ã‚¹ã‚’èµ·å‹•ã™ã‚‹.
connection ã‚’ accept ã—ãŸã‚ã¨ã«ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç”Ÿæˆã™ã‚‹.

-   advantage
    -   simple
    -   less overhead
-   disadvantage
    -   Unix system é™å®š
    -   ãƒ—ãƒ­ã‚»ã‚¹æ•°ã«ã¯é™ç•ŒãŒã‚ã‚‹


### Thread per connection {#84407b}

connection ã”ã¨ã« ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’èµ·å‹•ã™ã‚‹. connection ã‚’ accept ã—ãŸã‚ã¨ã«ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ç”Ÿæˆã™ã‚‹.

-   advantage
    -   process per connection ã‚ˆã‚Šã‚‚ ä½ resource, overhead
-   disadvantage
    -   ã‚¹ãƒ¬ãƒƒãƒ‰æ•°ã«ã¯é™ç•ŒãŒã‚ã‚‹


### Preforking {#23e607}

connection ã”ã¨ã« å­ãƒ—ãƒ­ã‚»ã‚¹ã‚’èµ·å‹•ã™ã‚‹.
ã‚ã‚‰ã‹ã˜ã‚ process ã‚’å¿…è¦æ•°èµ·å‹•ã—ã¦ãŠã,
accept ã—ãŸã‚‰ãã®ãƒ—ãƒ­ã‚»ã‚¹ã«å‡¦ç†ã‚’å®Ÿæ–½ã•ã›ã‚‹.

-   advantage
    -   äº‹å‰ã«ãƒ—ãƒ­ã‚»ã‚¹ã‚’èµ·å‹•ã—ã¦ãŠãã®ã§, accept æ™‚ã® overhead ãŒãªã„.
    -   ãƒ¡ãƒ¢ãƒªã®æ’ä»–ã‚’æ„è­˜ã™ã‚‹å¿…è¦ãŒãªã„.
-   disadvantage
    -   ã‚¹ãƒ¬ãƒƒãƒ‰ã«æ¯”ã¹ã¦ã‚ˆã‚Šå¤šãã®ãƒ¡ãƒ¢ãƒªã‚’åˆ©ç”¨ã™ã‚‹.


### Thread Pool {#beca74}

connection ã”ã¨ã« ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’èµ·å‹•ã™ã‚‹. ã‚ã‚‰ã‹ã˜ã‚ ã‚¹ãƒ¬ãƒƒãƒ‰ ã‚’å¿…è¦æ•°èµ·å‹•ã—ã¦ãŠã, accept ã—ãŸã‚‰ãã®ã‚¹ãƒ¬ãƒƒãƒ‰ã«å‡¦ç†ã‚’å®Ÿæ–½ã•ã›ã‚‹.


### Evented (Reactor) {#0d2f56}


#### ç‰¹å¾´ {#b7782a}

-   ã™ã¹ã¦ã®å‡¦ç†ã‚’ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿæ–½ã™ã‚‹.
-   ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã‚’åˆ©ç”¨ã—ãªãã¦ã‚‚, éåŒæœŸå‡¦ç†ãŒã‹ã‘ã‚‹.
-   ã‚¹ãƒ¬ãƒƒãƒ‰ã‚„ãƒ—ãƒ­ã‚»ã‚¹æ•°ã®åˆ¶é™ãªã—ã«, ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®è¦æ±‚ã«ç­”ãˆã‚‹ã“ã¨ãŒã§ãã‚‹.


#### å®Ÿè£…æ–¹æ³• {#fde81e}

-   ã‚½ã‚±ãƒƒãƒˆã‚’ select ã§ç›£è¦–ã™ã‚‹.
    èª­ã¿å–ã‚Šå¯èƒ½, æ›¸ãè¾¼ã¿å¯èƒ½ãªã‚½ã‚±ãƒƒãƒˆã®ã¿ã«å¯¾ã—ã¦å‡¦ç†ã‚’å®Ÿæ–½ã™ã‚‹.
-   é…ã„å›ç·šãŒã‚ã‚‹ã¨ãã«, ãã®å›ç·šã«å¼•ããšã‚‰ã‚Œã¦ Reactor ãŒä»–ã®å‡¦ç†ã‚’ã§ããªã„.
    ã™ã¹ã¦ã®å‡¦ç†ãŒ Blocking ã•ã‚Œã‚‹.
    ãã‚“ãªã¨ãã¯, non-blocking write ã‚’åˆ©ç”¨ã™ã‚‹.


#### sample {#5e8ff9}

<!--list-separator-->

-  synchronized

    ```ruby
    hosts.each do |host|
      sock = TCPSocket.new (host, 80)
      sock.write (request)
      sock.read
      sock.close
    end
    ```

<!--list-separator-->

-  threads

    ```ruby
    threads = hosts.map do |host|
      Thread.new (host) do |h|
        sock = TCPSocket.new (h, 80)
        sock.write (request)
        sock.read
        sock.close
      end
    end
    threads.each{|t| t.join}
    ```

<!--list-separator-->

-  reactor

    ```ruby
    write_socks = hosts.map do |host|
      TCPSocket.new (host, 80)
    end
    read_socks = []

    # handler
    write_proc = lambda{|sock|
      sock.write (request)
    }

    # handler
    read_proc = lambda{|sock|
      sock.read
      sock.close
    }

    # Reactor
    until (write_socks + read_socks).empty?

      # Demultiplexer
      r_socks, w_socks, e_socks = IO.select (read_socks, write_socks)

      # Dispatcher
      if ws = w_socks.first
        write_proc.call (ws)
        read_socks << ws
        write_socks.delete (ws)
      end

      # Dispatcher
      if rs = r_socks.first
        read_proc.call (rs)
        read_socks.delete (rs)
      end
    end
    ```
