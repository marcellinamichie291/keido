+++
title = "📝マクロ - Macro"
lastmod = 2022-11-02T13:01:45+09:00
draft = false
+++

-   tags: [🔖Lisp]({{< relref "20220114080415.md" >}})
-   up: [📝メタプログラミング]({{< relref "20221019145712.md" >}})
-   down.
    -   [📝Clojure Macros]({{< relref "20220302111024.md" >}})


## マクロとは {#4d32f4}

コードからコードへの変換を定義する関数.

強力なメタプログラミングツール.


### リーダーマクロ {#46a6a5}

Reader Macros.

リーダの振る舞いに手を加えてシンタックスシュガーを変更してしまうことが可能な機能.

-   links
    -   [#:g1: Lispのリーダーマクロとはなにか](https://g000001.cddddr.org/3563308738)
-   refs.
    -   [Clojure: リーダマクロ]({{< relref "20220302111024.md#29c96e8e-02b0-4883-a59e-b08b4b6a70fb" >}})


### シンタックスマクロ {#76d0c9}


## マクロTopics {#d93de5}


### Paul Grahamとマクロ {#091b14}

マクロを推している第一人者といえばこの人.

[👨Paul Graham]({{< relref "20211215145929.md" >}})

-   [📔オタク野郎の復讐 - ポール・グレアム]({{< relref "20211228135040.md#683a9808-fe87-429f-b775-881b5733ac96" >}})
    -   Lispの力についてのエッセイ.
-   [📔普通のやつらの上をいけ - ポール・グレアム]({{< relref "20211228135040.md#338943a2-b567-458b-aa35-6e43d20633a4" >}})
    -   [💡Viawebのコードの25%はマクロ]({{< relref "20211228135040.md#bf6e432b-1ec2-45ff-b0fc-96be6b5d93f6" >}})


### 💡マクロとはデザインパターンの自動化 {#9f346eca-562f-4f88-a283-513cb8613612}

[📚プログラミングClojure]({{< relref "20220307081341.md" >}}) p164からの要約.

各言語には, 特殊形式が存在する(コンパイラが解釈するsyntax). この特殊形式が何度も現れるパターンをカプセル化しようとするリファクタリングを邪魔する.

たとえばJavaのnewの書き方. これは同じような処理がたくさん現れるときに, コードを複雑化させる. これをJavaだと [📝デザインパターン]({{< relref "20220309184220.md" >}})などで解決する.

マクロはもう少し広義なデザインパターン. マクロは何度も現れるパターンならなんであれ, その共通部分をくくりだすための間接的な層を提供する. マクロはパターンをカプセル化しながら言語を再構築する.

[コードはデータである]({{< relref "20221019145712.md#b7b5b50e-9f88-4df9-ade6-47f5cd2611c6" >}})ということに慣れてしまうと, デザインパターンを自動化できるという力が手に入る.

---

そうするとオブジェクト指向のこころである流動性をカプセル化するという考え方も役に立つかもしれない.


### 💡人間コンパイラ {#29f867d2-b99a-48ad-83e7-ed7a1028cc13}

[📔オタク野郎の復讐 - ポール・グレアム]({{< relref "20211228135040.md#683a9808-fe87-429f-b775-881b5733ac96" >}})の付録より.

難しい問題を解こうとするときの選択肢.

1.  パワフルな言語を使うか
2.  パワフルな言語と等価なインタプリタを書くか
3.  自らがパワフルな言語の人間コンパイラとなるか

3をマンパワーという.


## マクロInsights {#a5d8f2}


### テンプレートエンジン/Atomic Designのアナロジー {#b4d1d4}

Webページを作成するときに, HTMLの中に変数を仕込んでテンプレートをつくるような技術をテンプレートエンジンといいよくあるライブラリだが, このイメージにマクロは似ている.

よくあるパターンをテンプレートしてマクロにまとめておくことはWebページを部品を組み合わせることによって動的に生成することに等しい.

[Rails]({{< relref "20221011172627.md" >}})で言えば, Viewを作る際にHTMLという言語にRubyを埋め込むようなものだ.

なるほど, Webサイトを作ろうとしたときに一つのページごとに同じようなHTMLを作り続けるのは辛いものがあり, テンプレートエンジンで圧倒的に記述量が少なくなることは納得できる.

ReactやVue開発でみられるようなAtomic Designというページを構成する部品をさらに細かく分解して管理する方法も, マクロのWeb領域における進化なのかもしれない.

---

[🔖テンプレートエンジン]({{< relref "20221019144930.md" >}})
[💭Reactを書くようにマクロを書きたい(2022/10/29)]({{< relref "2022-w43.md#0072236b-94f6-4fc4-9a6a-c5ebdeaea4f5" >}})


## References {#d95867}

-   [Lisp Reader Macro Advent Calendar 2012 - Qiita](https://qiita.com/advent-calendar/2012/lisp-reader-macro)
    -   ニッチすぎるw
